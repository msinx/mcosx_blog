<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Nginx判断域名并实现301重定向</title>
    <url>/post/nginx-judge-domain-names-and-to-achieve-301-redirect.html</url>
    <content><![CDATA[<p>Nginx实现功能：<br>1.Nginx将不带www域名301重定向为带www域名;<br>2.Nginx根据来访域名判断是否有访问权限并返回相应代码;</p>
<span id="more"></span>

<p>修改/usr/local/nginx/conf/nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>
<p>打开文件后寻找以下代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  _;</span><br></pre></td></tr></table></figure>

<p>在其后面添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if ( $host = &#x27;mchsinx.com&#x27; )&#123;</span><br><span class="line">        return 301 http://www.mchsinx.com$request_uri;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>可实现将不带www域名301转向带www的域名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if ( $host != &#x27;www.mchsinx.com&#x27; )&#123;</span><br><span class="line">        return 403;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>然后添加以上代码，可实现对不是<a href="http://www.mchsinx.com的域名访问返回http/">www.mchsinx.com的域名访问返回http</a> 403错误代码。<br>保存后重启nginx</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/init.d/nginx restart</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后台相关</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>SSH客户端-Bitvise SSH Client</title>
    <url>/post/bitvise-ssh-client.html</url>
    <content><![CDATA[<p>Bitvise SSH Client is an SSH and SFTP client for Windows. It is developed and supported professionally by Bitvise. The SSH Client is robust, easy to install, easy to use, and supports all features supported by PuTTY, as well as the following:</p>
<ul>
<li>  graphical SFTP file transfer;</li>
<li>  single-click Remote Desktop tunneling;</li>
<li>  auto-reconnecting capability;</li>
<li>  dynamic port forwarding through an integrated proxy;</li>
<li>  an FTP-to-SFTP protocol bridge.</li>
</ul>
<p>Bitvise SSH Client is <strong>free for personal use</strong>, as well as for individual commercial use inside organizations. You can <a href="http://www.bitvise.com/download-area">download Bitvise SSH Client here</a>.</p>
<p><img src="//st.mcosx.cn/blog/img/201507/20150705153604.png" alt="20150705153604"><br><img src="//st.mcosx.cn/blog/img/201507/20150705153727.png" alt="20150705153727"><br><img src="//st.mcosx.cn/blog/img/201507/20150705153639.png" alt="20150705153639"></p>
<p>Bitvise SSH Client可以同时打开sftp和ssh.并且对个人免费，仅用于windows.</p>
]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>题目1009：二叉搜索树</title>
    <url>/post/topic-1009-binary-search-tree.html</url>
    <content><![CDATA[<p>时间限制：<code>1 秒</code> 内存限制：<code>32 兆</code> 特殊判题：否 提交：4894 解决：2183</p>
<h2 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h2><p>判断两序列是否为同一二叉搜索树序列</p>
<h2 id="输入："><a href="#输入：" class="headerlink" title="输入："></a>输入：</h2><p>开始一个数n，(1&lt;=n&lt;=20) 表示有n个需要判断，n= 0 的时候输入结束。<br>接下去一行是一个序列，序列长度小于10，包含(0~9)的数字，没有重复数字，根据这个序列可以构造出一颗二叉搜索树。<br>接下去的n行有n个序列，每个序列格式跟第一个序列一样，请判断这两个序列是否能组成同一颗二叉搜索树。</p>
<h2 id="输出："><a href="#输出：" class="headerlink" title="输出："></a>输出：</h2><p>如果序列相同则输出YES，否则输出NO<br>样例输入：</p>
<blockquote>
<p>2<br>567432<br>543267<br>576342<br>0</p>
</blockquote>
<p>样例输出：</p>
<blockquote>
<p>YES<br>NO</p>
</blockquote>
<p>来源：<br>2010年浙江大学计算机及软件工程研究生机试真题<br>答疑：<br>解题遇到问题?分享解题心得?讨论本题请访问：<a href="http://t.jobdu.com/thread-7733-1-1.html">http://t.jobdu.com/thread-7733-1-1.html</a><br>来源： <a href="http://ac.jobdu.com/problem.php?pid=1009">http://ac.jobdu.com/problem.php?pid=1009</a></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">对输入数字序列构建二叉排序树，并对它们进行前序和中序遍历，</span><br><span class="line">依次比较两次遍历结果是否相同，若相同则说明两棵二叉排序树</span><br><span class="line">相同，否则不同</span><br><span class="line">*/</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">typedef struct Node</span><br><span class="line">&#123;</span><br><span class="line">    struct Node *lchild;</span><br><span class="line">    struct Node *rchild;</span><br><span class="line">    int c;</span><br><span class="line">&#125;Node;</span><br><span class="line">Node bTree[110];</span><br><span class="line">int loc;</span><br><span class="line">char str1[25],str2[25];</span><br><span class="line">int size1,size2;</span><br><span class="line">char *str;</span><br><span class="line">int *size;</span><br><span class="line">void preOrder(Node *T)</span><br><span class="line">&#123;</span><br><span class="line">    if(T!=NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        str[(*size)++]=T-&gt;c+&#x27;0&#x27;;</span><br><span class="line">        preOrder(T-&gt;lchild);</span><br><span class="line">        preOrder(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void inOrder(Node *T)</span><br><span class="line">&#123;</span><br><span class="line">    if(T!=NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        inOrder(T-&gt;lchild);</span><br><span class="line">        str[(*size)++]=T-&gt;c+&#x27;0&#x27;;</span><br><span class="line">        inOrder(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">struct Node* insert(Node* T,int x)</span><br><span class="line">&#123;</span><br><span class="line">    if(!T)</span><br><span class="line">    &#123;</span><br><span class="line">        T=&amp;bTree[loc++];</span><br><span class="line">        T-&gt;c=x;</span><br><span class="line">        T-&gt;lchild=T-&gt;rchild=NULL;</span><br><span class="line">        return T;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(x&lt;T-&gt;c) T-&gt;lchild=insert(T-&gt;lchild,x);</span><br><span class="line">    else if(x&gt;T-&gt;c) T-&gt;rchild=insert(T-&gt;rchild,x);</span><br><span class="line">    return T;</span><br><span class="line">&#125;;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">#ifndef ONLINE_JUDGE</span><br><span class="line">    freopen(&quot;E:\jsj\cprojects\docs\in.txt&quot;,&quot;r&quot;,stdin);</span><br><span class="line">    //freopen(&quot;E:\jsj\cprojects\docs\mout.txt&quot;,&quot;w&quot;,stdout);</span><br><span class="line">#endif</span><br><span class="line">    int n,i;</span><br><span class="line">    char tmp[12];</span><br><span class="line">    while(~scanf(&quot;%d&quot;,&amp;n)&amp;&amp;n!=0)</span><br><span class="line">    &#123;</span><br><span class="line">        Node *T=NULL;</span><br><span class="line">        scanf(&quot;%s&quot;,tmp);</span><br><span class="line">        for(loc=i=0;tmp[i]!=0;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            T=insert(T,tmp[i]-&#x27;0&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        size1=0;</span><br><span class="line">        str=str1;</span><br><span class="line">        size=&amp;size1;</span><br><span class="line">        preOrder(T);</span><br><span class="line">        inOrder(T);</span><br><span class="line">        str1[size1]=0;</span><br><span class="line">        while(n--!=0)</span><br><span class="line">        &#123;</span><br><span class="line">            scanf(&quot;%s&quot;,tmp);</span><br><span class="line">            Node *T2=NULL;</span><br><span class="line">            for(i=0;tmp[i]!=0;++i)</span><br><span class="line">            &#123;</span><br><span class="line">                T2=insert(T2,tmp[i]-&#x27;0&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">            size2=0;</span><br><span class="line">            str=str2;</span><br><span class="line">            size=&amp;size2;</span><br><span class="line">            preOrder(T2);</span><br><span class="line">            inOrder(T2);</span><br><span class="line">            str2[size2]=0;</span><br><span class="line">            puts(strcmp(str1,str2)==0?&quot;YES&quot;:&quot;NO&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>oj</tag>
      </tags>
  </entry>
  <entry>
    <title>题目1163：素数</title>
    <url>/post/topic-1163-prime.html</url>
    <content><![CDATA[<p>时间限制：<code>1 秒</code> 内存限制：<code>32 兆</code> 特殊判题：否  提交：<code>6479</code>  解决：<code>2176</code></p>
<h2 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h2><p>输入一个整数n(2&lt;=n&lt;=10000)，要求输出所有从1到这个整数之间(不包括1和这个整数)个位为1的素数，如果没有则输出-1。<br>输入：<br>输入有多组数据。<br>每组一行，输入n。<br>输出：<br>输出所有从1到这个整数之间(不包括1和这个整数)个位为1的素数(素数之间用空格隔开，最后一个素数后面没有空格)，如果没有则输出-1。<br>样例输入：</p>
<blockquote>
<p>100</p>
</blockquote>
<p>样例输出：</p>
<blockquote>
<p>11 31 41 61 71</p>
</blockquote>
<p>来源：<br>2008年北京航空航天大学计算机研究生机试真题<br>答疑：<br>解题遇到问题?分享解题心得?讨论本题请访问：<a href="http://t.jobdu.com/thread-7886-1-1.html">http://t.jobdu.com/thread-7886-1-1.html</a><br>来源： <a href="http://ac.jobdu.com/problem.php?pid=1163">http://ac.jobdu.com/problem.php?pid=1163</a></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int prime[10000];</span><br><span class="line">int primeSize;</span><br><span class="line">char mark[10001];</span><br><span class="line">void init()</span><br><span class="line">&#123;</span><br><span class="line">    int i=1;</span><br><span class="line">    for(; i&lt;=10000; ++i) mark[i]=0;</span><br><span class="line">    primeSize=0;</span><br><span class="line">    for(i=2; i&lt;=10000; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        if(mark[i]) continue;</span><br><span class="line">        prime[primeSize++]=i;</span><br><span class="line">        int j=i*i;  //注意：i*k，而当k&lt;i时其所有倍数已经被标记完了，所以从i*i开始</span><br><span class="line">        for(; j&lt;=10000; j+=i) mark[j]=1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">#ifndef ONLINE_JUDGE</span><br><span class="line">    freopen(&quot;E:\jsj\cprojects\docs\in.txt&quot;,&quot;r&quot;,stdin);</span><br><span class="line">    //freopen(&quot;E:\jsj\cprojects\docs\mout.txt&quot;,&quot;w&quot;,stdout);</span><br><span class="line">#endif</span><br><span class="line">    init();</span><br><span class="line">    int n,i;</span><br><span class="line">    while(~scanf(&quot;%d&quot;,&amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        char isOutput=0;</span><br><span class="line">        for(i=0; i&lt;primeSize; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            if(prime[i]&lt;n&amp;&amp;prime[i]%10==1)</span><br><span class="line">            &#123;</span><br><span class="line">                if(isOutput==0)</span><br><span class="line">                &#123;</span><br><span class="line">                    isOutput=1;</span><br><span class="line">                    printf(&quot;%d&quot;,prime[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                else printf(&quot; %d&quot;,prime[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(isOutput==0) printf(&quot;-1n&quot;);</span><br><span class="line">        else printf(&quot;n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>c语言</tag>
      </tags>
  </entry>
  <entry>
    <title>题目1207：质因数的个数</title>
    <url>/post/topic-1207-the-number-of-zhiyinshu.html</url>
    <content><![CDATA[<p>时间限制：<code>1 秒</code> 内存限制：<code>32 兆</code></p>
<h2 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h2><p>求正整数N(N&gt;1)的质因数的个数。<br>相同的质因数需要重复计算。如120=2<em>2</em>2<em>3</em>5，共有5个质因数。</p>
<h2 id="输入："><a href="#输入：" class="headerlink" title="输入："></a>输入：</h2><p>可能有多组测试数据，每组测试数据的输入是一个正整数N，(1&lt;N&lt;10^9)。</p>
<h2 id="输出："><a href="#输出：" class="headerlink" title="输出："></a>输出：</h2><p>对于每组数据，输出N的质因数的个数。</p>
<h2 id="样例输入："><a href="#样例输入：" class="headerlink" title="样例输入："></a>样例输入：</h2><blockquote>
<p>120</p>
</blockquote>
<h2 id="样例输出："><a href="#样例输出：" class="headerlink" title="样例输出："></a>样例输出：</h2><blockquote>
<p>5</p>
</blockquote>
<h2 id="提示："><a href="#提示：" class="headerlink" title="提示："></a>提示：</h2><p>注意：1不是N的质因数；若N为质数，N是N的质因数。</p>
<p><strong>来源：</strong><a href="http://ac.jobdu.com/problemset.php?search=2007%E5%B9%B4%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A0%94%E7%A9%B6%E7%94%9F%E6%9C%BA%E8%AF%95%E7%9C%9F%E9%A2%98"><em>2007年清华大学计算机研究生机试真题</em></a><br><strong>答疑：</strong>解题遇到问题?分享解题心得?讨论本题请访问：<a href="http://t.jobdu.com/thread-7930-1-1.html">http://t.jobdu.com/thread-7930-1-1.html</a><br>来源： <a href="http://ac.jobdu.com/problem.php?pid=1207">http://ac.jobdu.com/problem.php?pid=1207</a></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> prime[<span class="number">10000</span>];</span><br><span class="line"><span class="type">int</span> primeSize;</span><br><span class="line"><span class="type">char</span> mark[<span class="number">10001</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(; i&lt;=<span class="number">10000</span>; ++i) mark[i]=<span class="number">0</span>;</span><br><span class="line">    primeSize=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">2</span>; i&lt;=<span class="number">10000</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(mark[i]) <span class="keyword">continue</span>;</span><br><span class="line">        prime[primeSize++]=i;</span><br><span class="line">        <span class="type">int</span> j=i*i;  <span class="comment">//注意：i*k，而当k&lt;i时其所有倍数已经被标记完了，所以从i*i开始</span></span><br><span class="line">        <span class="keyword">for</span>(; j&lt;=<span class="number">10000</span>; j+=i) mark[j]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;E:\\jsj\\cprojects\\docs\\in.txt&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="comment">//freopen(&quot;E:\jsj\cprojects\docs\mout.txt&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="type">int</span> n,i;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//int ansPrime[30];</span></span><br><span class="line">        <span class="type">int</span> ansSize=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ansNum[<span class="number">30</span>];</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;primeSize;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(n%prime[i]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//ansPrime[ansSize]=prime[i];</span></span><br><span class="line">                ansNum[ansSize]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(n%prime[i]==<span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    ansNum[ansSize]++;</span><br><span class="line">                    n/=prime[i];</span><br><span class="line">                &#125;</span><br><span class="line">                ansSize++;</span><br><span class="line">                <span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(n!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ansPrime[ansSize]=n;</span></span><br><span class="line">            ansNum[ansSize++]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;ansSize;++i) ans+=ansNum[i];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%dn&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>oj</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:Reverse Integer</title>
    <url>/post/reverse-integer.html</url>
    <content><![CDATA[<p>Total Accepted: <code>100793</code> Total Submissions: <code>429248</code> Difficulty: <code>Easy</code><br>Reverse digits of an integer. Example1: x = 123, return 321 Example2: x = -123, return -321</p>
<p>Have you thought about this?Here are some good questions to ask before coding. Bonus points for you if you have already thought through this! If the integer’s last digit is 0, what should the output be? ie, cases such as 10, 100. Did you notice that the reversed integer might overflow? Assume the input is a 32-bit integer, then the reverse of 1000000003 overflows. How should you handle such cases? For the purpose of this problem, assume that your function returns 0 when the reversed integer overflows. Update (2014-11-10): Test cases had been added to test the overflow behavior.</p>
<p>Tags<br><code>Math</code></p>
<p>Hide Similar Problems<br>(E) String to Integer (atoi)</p>
<p> Discuss<br>来源： <a href="https://leetcode.com/problems/reverse-integer/">https://leetcode.com/problems/reverse-integer/</a></p>
<h2 id="代码-Accepted"><a href="#代码-Accepted" class="headerlink" title="代码(Accepted):"></a><strong>代码(Accepted):</strong></h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ret&gt;INT_MAX/<span class="number">10</span>||ret&lt;INT_MIN/<span class="number">10</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ret = ret*<span class="number">10</span> + x%<span class="number">10</span>;</span><br><span class="line">            x = x/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<div> 我感觉最准确的应该是下面这个</div>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ret&gt;INT_MAX/<span class="number">10</span>-x%<span class="number">10</span>/<span class="number">10</span>||ret&lt;INT_MIN/<span class="number">10</span>-x%<span class="number">10</span>/<span class="number">10</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ret = ret*<span class="number">10</span> + x%<span class="number">10</span>;</span><br><span class="line">            x = x/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h2><p>To check for overflow/underflow, we could check if ret &gt; 214748364 or ret &lt; –214748364 before multiplying by 10. On the other hand, we do not need to check if ret == 214748364, why?</p>
<h2 id="相关链接："><a href="#相关链接：" class="headerlink" title="相关链接："></a>相关链接：</h2><p><a href="http://blog.csdn.net/nomasp/article/details/48675979">http://blog.csdn.net/nomasp/article/details/48675979</a></p>
<p>int型整数的最小值和最大值 <a href="http://bbs.csdn.net/topics/340223320">http://bbs.csdn.net/topics/340223320</a></p>
<h2 id="本题解析："><a href="#本题解析：" class="headerlink" title="本题解析："></a>本题解析：</h2><p>本题一定要把判断加在while循环之中，并且要在乘10之前判断是否超出范围。</p>
<h2 id="遗留问题："><a href="#遗留问题：" class="headerlink" title="遗留问题："></a>遗留问题：</h2><p>1.两段代码更精确的感觉应该是下面那个。<br>2.运行时间8ms，比较长，有待优化。(your runtime beats 24.74% of cpp submissions.)</p>
<h2 id="相关知识点："><a href="#相关知识点：" class="headerlink" title="相关知识点："></a>相关知识点：</h2><ol>
<li>整数最大值和最小值<br>INT_MAX和INT_MIN定义在limits.h中。<br>INT_MAX   #define INT_MAX       2147483647<br>INT_MIN    #define INT_MIN     (-2147483647 – 1)<br>注意：其中INT_MIN最小值没有写成-2147483647，是因为-2147483648对于编译器而言是个表达式，而2147483648对于32-bit整数是无法表示的，所以经过这个表达式的结果是未定义的。在GCC上直接写-2147483648后，编译器给出了警告，说结果是unsigned。可参考 INT_MIN.<br>也可用以下写法(推荐)：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#define MAX_INT ((unsigned)(-1) &gt;&gt; 1)</span><br><span class="line">#define MIN_INT (int)(MAX_INT + 1)</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>题目1438：最小公倍数</title>
    <url>/post/topic-1438-lowest-common-multiple.html</url>
    <content><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给定两个正整数，计算这两个数的最小公倍数。</p>
<h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h2><p>输入包含多组测试数据，每组只有一行，包括两个不大于1000的正整数。</p>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>对于每个测试用例，给出这两个数的最小公倍数，每个实例输出一行。</p>
<h2 id="样例输入："><a href="#样例输入：" class="headerlink" title="样例输入："></a>样例输入：</h2><blockquote>
<p>10 14</p>
</blockquote>
<h2 id="样例输出："><a href="#样例输出：" class="headerlink" title="样例输出："></a>样例输出：</h2><blockquote>
<p>70</p>
</blockquote>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int gcd(int a,int b)</span><br><span class="line">&#123;</span><br><span class="line">    while(b!=0)</span><br><span class="line">    &#123;</span><br><span class="line">        int t=a%b;</span><br><span class="line">        a=b;</span><br><span class="line">        b=t;</span><br><span class="line">    &#125;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">#ifndef ONLINE_JUDGE</span><br><span class="line">    freopen(&quot;E:\\jsj\\cprojects\\docs\\in.txt&quot;,&quot;r&quot;,stdin);</span><br><span class="line">    //freopen(&quot;E:\\jsj\\cprojects\\docs\\mout.txt&quot;,&quot;w&quot;,stdout);</span><br><span class="line">#endif</span><br><span class="line">    int a,b;</span><br><span class="line">    while(~scanf(&quot;%d%d&quot;,&amp;a,&amp;b))</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;%d\n&quot;,a*b/gcd(a,b));</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>c语言</tag>
      </tags>
  </entry>
  <entry>
    <title>WordPress缓存插件： W3 Total Cache</title>
    <url>/post/w3-total-cache-in-wordpress.html</url>
    <content><![CDATA[<p>W3 Total Cache 插件 和WP Super Cache 插件类似，但是比后者设置更为详细，后者更适用于新手。</p>
<p>本文安装环境：nginx, memcached.</p>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><p>在插件库中搜索W3 Total Cache即可在线安装。</p>
<span id="more"></span>
<h2 id="2-General-Settings设置"><a href="#2-General-Settings设置" class="headerlink" title="2.General Settings设置"></a>2.General Settings设置</h2><h3 id="Page-Cache"><a href="#Page-Cache" class="headerlink" title="Page Cache"></a>Page Cache</h3><p><img src="//st.mcosx.cn/blog/img/201510/770.png" alt="W3 Total Cache|mlsinx"></p>
<h3 id="Minify"><a href="#Minify" class="headerlink" title="Minify"></a>Minify</h3><p><img src="//st.mcosx.cn/blog/img/201510/661.png" alt="W3 Total Cache|mlsinx"></p>
<p>注意：<strong>Minify mode 一定要改成Manual</strong>,否则会导致页面排版错乱。</p>
<h3 id="Database-Cache"><a href="#Database-Cache" class="headerlink" title="Database Cache"></a>Database Cache</h3><p><img src="//st.mcosx.cn/blog/img/201510/596.png" alt="W3 Total Cache|mlsinx"></p>
<h3 id="Object-Cache"><a href="#Object-Cache" class="headerlink" title="Object Cache"></a>Object Cache</h3><p><img src="//st.mcosx.cn/blog/img/201510/812.png" alt="W3 Total Cache|mlsinx"></p>
<h3 id="Browser-Cache"><a href="#Browser-Cache" class="headerlink" title="Browser Cache"></a>Browser Cache</h3><p><img src="//st.mcosx.cn/blog/img/201510/112.png" alt="W3 Total Cache|mlsinx"></p>
<h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p><img src="//st.mcosx.cn/blog/img/201510/823.png" alt="W3 Total Cache|mlsinx"></p>
<p>如果是七牛之类的CDN，则CDN Type选择Generic Mirror.</p>
<h2 id="3-Page-Cache"><a href="#3-Page-Cache" class="headerlink" title="3.Page Cache"></a>3.Page Cache</h2><p><img src="//st.mcosx.cn/blog/img/201510/128.png" alt="W3 Total Cache|mlsinx"></p>
<h2 id="4-Minify"><a href="#4-Minify" class="headerlink" title="4.Minify"></a>4.Minify</h2><p><img src="//st.mcosx.cn/blog/img/201510/342.png" alt="W3 Total Cache|mlsinx"><br><img src="//st.mcosx.cn/blog/img/201510/541.png" alt="W3 Total Cache|mlsinx"></p>
<p><img src="//st.mcosx.cn/blog/img/201510/216.png" alt="W3 Total Cache|mlsinx"></p>
<h2 id="5-CDN"><a href="#5-CDN" class="headerlink" title="5.CDN"></a>5.CDN</h2><p><img src="//st.mcosx.cn/blog/img/201510/396.png" alt="W3 Total Cache|mlsinx"></p>
<p>在红框处填入服务商提供的域名地址。</p>
<h2 id="6-清空缓存"><a href="#6-清空缓存" class="headerlink" title="6.清空缓存"></a>6.清空缓存</h2><p><img src="//st.mcosx.cn/blog/img/201510/135.png" alt="W3 Total Cache|mlsinx"></p>
<h2 id="7-更多设置参考"><a href="#7-更多设置参考" class="headerlink" title="7.更多设置参考"></a>7.更多设置参考</h2><p><a href="http://tieba.baidu.com/p/3160309040">http://tieba.baidu.com/p/3160309040</a></p>
<p><a href="http://www.mywpku.com/wordpress-ultimate-speed-up-course-second.html">http://www.mywpku.com/wordpress-ultimate-speed-up-course-second.html</a></p>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>wordpress插件</tag>
      </tags>
  </entry>
  <entry>
    <title>github pages + jekyll + markdown个人博客搭建</title>
    <url>/post/github-pages-jekyll-markdown-blog.html</url>
    <content><![CDATA[<h2 id="本文环境"><a href="#本文环境" class="headerlink" title="本文环境"></a>本文环境</h2><ul>
<li>windows 10 32位</li>
</ul>
<h2 id="前提准备"><a href="#前提准备" class="headerlink" title="前提准备"></a>前提准备</h2><h3 id="1、git"><a href="#1、git" class="headerlink" title="1、git"></a>1、git</h3><p>从<a href="http://git-scm.com/download/">git官网</a>下载git安装包并安装。建议将git添加进PATH中。</p>
<span id="more"></span>
<h3 id="2、Ruby"><a href="#2、Ruby" class="headerlink" title="2、Ruby"></a>2、Ruby</h3><p>从<a href="http://rubyinstaller.org/downloads/">官网</a>下载Ruby2.2.3和DevKit-mingw64-32-4.7.2-20130224-1151-sfx.exe并依次安装，安装路径中不能有空格。建议将ruby添加进PATH中。安装完后用Start Command Prompt with Ruby（在ruby程序项中可以找到）进DevKit的解压目录，运行以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; cd &lt;DEVKIT_DIR&gt; #&lt;DEVKIT_INSTALL_DIR&gt;为DevKit解压目录</span><br><span class="line">&gt; ruby dk.rb init</span><br><span class="line">#生成config.yml，这里会检查将要添加DevKit支持的Ruby列表，只支持通过RubyInstaller安装的Ruby</span><br><span class="line">#如果这里列出的Ruby与你的要求不符，可以手动修改</span><br><span class="line">&gt; ruby dk.rb review  #检查要添加DevKit支持的Ruby列表是否有误，可以略过</span><br><span class="line">&gt; ruby dk.rb install</span><br><span class="line">&gt; gem install rdiscount --platform=ruby</span><br></pre></td></tr></table></figure>
<p>这样 Ruby和DevKit就配置好了。<br>注：需要安装DevKit，否则在运行 <strong>bundle install</strong> 命令时(下面会提到)会出现</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Gem::InstallError: The &#x27;json&#x27; native gem requires installed build tools.</span><br><span class="line"></span><br><span class="line"> Please update your PATH to include build tools or download the DevKit</span><br><span class="line"> from &#x27;http://rubyinstaller.org/downloads&#x27; and follow the instructions</span><br><span class="line"> at &#x27;http://github.com/oneclick/rubyinstaller/wiki/Development-Kit&#x27;</span><br><span class="line"> An error occurred while installing json (1.8.3), and Bundler cannot continue.</span><br><span class="line"> Make sure that `gem install json -v &#x27;1.8.3&#x27;` succeeds before bundling.</span><br></pre></td></tr></table></figure>
<p><strong>参考网址:</strong>  <a href="http://rubyer.me/blog/134/">rubyer.me</a>  <a href="http://stackoverflow.com/questions/10694997/gem-install-json-v-1-7-3-gives-please-update-your-path-to-include-build-tools">stackoverflow</a></p>
<h3 id="3、github操作"><a href="#3、github操作" class="headerlink" title="3、github操作"></a>3、github操作</h3><p>申请github帐号并新建一个名为<strong>username</strong>.github.io的repository(其中<strong>username</strong>用申请的github账号名替换)。具体可参考<a href="https://pages.github.com/">github帮助</a>。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>1、在git bash或命令行中运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br></pre></td></tr></table></figure>
<p>在github中添加SSH key。 <a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001374385852170d9c7adf13c30429b9660d0eb689dd43a000">参考</a></p>
<p>2、在git bash或命令行中运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:username/username.github.io.git</span><br></pre></td></tr></table></figure>
<p>将之前创建的username.github.io复制到本地。</p>
<p>3、可用以下命令进行git提交</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git add --all</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>
<p>第一次推送master分支时，加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令。<br>从现在起，只要本地作了提交，就可以通过命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; git push origin master</span><br></pre></td></tr></table></figure>
<p>可参考:<br><a href="http://stackoverflow.com/questions/5561295/what-does-git-push-u-mean">http://stackoverflow.com/questions/5561295/what-does-git-push-u-mean</a><br><a href="http://stackoverflow.com/questions/5697750/what-exactly-does-the-u-do-git-push-u-origin-master-vs-git-push-origin-ma">http://stackoverflow.com/questions/5697750/what-exactly-does-the-u-do-git-push-u-origin-master-vs-git-push-origin-ma</a></p>
<p>4、搭建jekyll环境<br>大陆用户最好将ruby源更换为taobao源。<br>在Start Command Prompt with Ruby或命令行中运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gem sources --remove https://rubygems.org/</span><br><span class="line">gem sources -a https://ruby.taobao.org/</span><br><span class="line">gem sources -l</span><br></pre></td></tr></table></figure>
<p>然后在网站的根目录创建一个名为Gemfile的文件，并在里面添加以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source &#x27;https://ruby.taobao.org/&#x27;</span><br><span class="line">gem &#x27;github-pages&#x27;</span><br></pre></td></tr></table></figure>
<p>然后在Start Command Prompt with Ruby或命令行中运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gem install bundler</span><br><span class="line">gem install jekyll</span><br><span class="line">bundle install</span><br></pre></td></tr></table></figure>
<p>然后就可以创建一个jekyll文件夹。可以将”.”替换为目录名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jekyll new .</span><br></pre></td></tr></table></figure>
<p>就可以生成带样式的页面了。注意如果当前目录有文件，需要将其中文件备份删除。本文就是将原来生成的github pages默认文件(除.git外)全部删除，更换为jekyll目录文件并进行git提交的。<br>可以用以下命令进行本地查看调试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jekyll serve</span><br><span class="line"># =&gt; Now browse to http://localhost:4000</span><br></pre></td></tr></table></figure>
<p>修改后就可以通过步骤3中的命令进行提交。</p>
<p>参考：<br><a href="http://loshine.gitcafe.io/jekyll/2015/08/17/use-jekyll-to-build-personal-blog-on-github-pages/">http://loshine.gitcafe.io/jekyll/2015/08/17/use-jekyll-to-build-personal-blog-on-github-pages/</a><br><a href="http://cenalulu.github.io/jekyll/how-to-build-a-blog-using-jekyll-markdown/">http://cenalulu.github.io/jekyll/how-to-build-a-blog-using-jekyll-markdown/</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="修改jekyll主题"><a href="#修改jekyll主题" class="headerlink" title="修改jekyll主题"></a>修改jekyll主题</h3><p>可以在 <a href="http://jekyllthemes.org/">http://jekyllthemes.org/</a>  下载主题。</p>
<h3 id="添加评论功能"><a href="#添加评论功能" class="headerlink" title="添加评论功能"></a>添加评论功能</h3><h4 id="多说"><a href="#多说" class="headerlink" title="多说"></a>多说</h4><p>登录多说，创建一个项目，拷贝你的通用代码。<br>在_include文件夹里新建一个comment.html文件，将通用代码粘贴进去。<br>修改通用代码中需要配置的地方</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ds-thread&quot;</span> <span class="attr">data-thread-key</span>=<span class="string">&quot;请将此处替换成文章在你的站点中的ID&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-title</span>=<span class="string">&quot;请替换成文章的标题&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;请替换成文章的网址&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ds-thread&quot;</span> <span class="attr">data-thread-key</span>=<span class="string">&quot;&#123; page.id &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-title</span>=<span class="string">&quot;&#123; page.title &#125;&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;your web site&#123; page.url &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在_layout中的post.html中的底部加入</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% include comment.html %&#125;</span><br></pre></td></tr></table></figure>

<p>可参考：<br><a href="http://code4pub.github.io/tech/2014/05/04/integrate-with-duoshuo-comment/">http://code4pub.github.io/tech/2014/05/04/integrate-with-duoshuo-comment/</a></p>
<h4 id="Disqus"><a href="#Disqus" class="headerlink" title="Disqus"></a>Disqus</h4><p>Disqus支持使用Disqus、Facebook、Twitter以及Google帐号登录，如果你的博客不是主要面向国内普通用户的话，可以考虑使用Disqus。<br>登陆Disqus,创建一个项目，拷贝Universal Code。<br>在_include文件夹里新建一个comment.html文件，将通用代码粘贴进去。<br>在_layout中的post.html中的底部加入</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% include comment.html %&#125;</span><br></pre></td></tr></table></figure>

<p>参考：<br><a href="http://loshine.gitcafe.io/jekyll/2015/08/17/use-jekyll-to-build-personal-blog-on-github-pages/">http://loshine.gitcafe.io/jekyll/2015/08/17/use-jekyll-to-build-personal-blog-on-github-pages/</a><br><a href="http://justcoding.iteye.com/blog/1959737">http://justcoding.iteye.com/blog/1959737</a></p>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>github</tag>
        <tag>jekyll</tag>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>使用Jetpack时出现register_http_request_failed错误</title>
    <url>/post/jetpack-register-http-request-failed.html</url>
    <content><![CDATA[<p>使用Jetpack，连接wordpress.com时出现<strong>register_http_request_failed</strong>错误。<br>本文环境：vps+linux+nginx。</p>
<h2 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h2><p>修改php.ini文件中<strong>max_execution_time</strong>值<br>1. 寻找php.ini文件<br>linux下使用命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo find / -name &#x27;php.ini&#x27;</span><br></pre></td></tr></table></figure>

<p>本文中php.ini位置为<code>/usr/local/php/etc/php.ini</code>。<br>2. 将php.ini文件中max_execution_time的值修改为300.然后重启vps。连接jetpack后记得修改回去。</p>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>jetpack</tag>
        <tag>wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown使用技巧</title>
    <url>/post/markdown-use.html</url>
    <content><![CDATA[<h2 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h2><ol>
<li>Markdown不识别半角空格，当需要空格时，按<code>shift+Space</code>,然后再按空格键即可。</li>
<li>可直接输入HTML entities中的空格占位符：<ul>
<li>en space, U+2002 ISOpub<br>&ensp;半方大的空白<code>&amp;ensp;</code>或<code>&amp;#8194;</code>  </li>
<li>em space, U+2003 ISOpub<br>&emsp;全方大的空白<code>&amp;emsp;</code>或<code>&amp;#8195;</code>  </li>
<li>no-break space = non-breaking space, U+00A0 ISOnum<br>&nbsp;不断行的空白格&amp;nbsp;或&amp;#160;<span id="more"></span>
<h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2></li>
</ul>
</li>
</ol>
<ul>
<li><code>&lt;</code>和<code>&amp;</code>分别用<code>&amp;lt;</code>和<code>&amp;amp;</code>替换</li>
<li>Markdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：<ul>
<li>\   反斜线</li>
<li>`   反引号</li>
<li>*   星号</li>
<li>_   底线</li>
<li>{}  花括号</li>
<li>[]  方括号</li>
<li>()  括弧</li>
<li>#   井字号</li>
<li>+   加号</li>
<li>-   减号</li>
<li>.   英文句点</li>
<li>!   惊叹号</li>
</ul>
</li>
</ul>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>markdown支持两种形式链接语法：行内式和参考式。</p>
<ul>
<li>行内式：[]()</li>
<li>参考式: [][],然后是链接内容定义[]: url “title”</li>
</ul>
<blockquote>
<p>链接内容定义的形式为：</p>
</blockquote>
<blockquote>
<ul>
<li>方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字<br>接着一个冒号</li>
</ul>
</blockquote>
<ul>
<li>接着一个以上的空格或制表符</li>
<li>接着链接的网址</li>
<li>选择性地接着 title 内容，可以用单引号、双引号或是括弧包着</li>
</ul>
<p>链接其实也可以使用尖括号&lt;…&gt;包围起来。</p>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>使用方法:<code>![]()</code></p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>可以使用html注释:<code>&lt;\!--注释--&gt;</code></p>
<h2 id="html标签"><a href="#html标签" class="headerlink" title="html标签"></a>html标签</h2><ul>
<li>水平线: <code>&lt;hr&gt;</code></li>
<li>换行:<code>&lt;br /&gt;</code></li>
<li>段落: <code>&lt;p&gt;...&lt;/p&gt;</code></li>
<li>分区/节: <code>&lt;div&gt;...&lt;/div&gt;</code></li>
<li>上标: <code>&lt;sup&gt;...&lt;/sup&gt;</code></li>
<li>下标: <code>&lt;sub&gt;...&lt;/sub&gt;</code></li>
<li>下划线: <code>&lt;u&gt;...&lt;/u&gt;</code></li>
<li>删除线: <code>&lt;del&gt;...&lt;/del&gt;</code></li>
<li>斜体: <code>&lt;em&gt;...&lt;/em&gt;</code>,<code>&lt;i&gt;...&lt;/i&gt;</code>.markdown中使用<code>*</code>或者<code>_</code>包围.</li>
<li>突出显示: <code>&lt;mark&gt;...&lt;/mark&gt;</code>,<mark>测试</mark>,本文环境是加黄色背景。</li>
<li>加粗: <code>&lt;strong&gt;...&lt;/strong&gt;</code>,<code>&lt;b&gt;...&lt;/b&gt;</code>.markdown中使用<code>**</code>或<code>__</code>包围.</li>
<li>加大字号: <code>&lt;big&gt;...&lt;/big&gt;</code></li>
<li>减小字号: <code>&lt;small&gt;...&lt;/small&gt;</code></li>
</ul>
<p>参考:<br><a href="http://wowubuntu.com/markdown/">http://wowubuntu.com/markdown/</a><br><a href="http://www.w3school.com.cn/tags/tag_a.asp">http://www.w3school.com.cn/tags/tag_a.asp</a></p>
]]></content>
      <categories>
        <category>cs</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo之jacman主题修改记录</title>
    <url>/post/hexo-jacman.html</url>
    <content><![CDATA[<h2 id="config-yml修改"><a href="#config-yml修改" class="headerlink" title="config.yml修改"></a>config.yml修改</h2><ul>
<li>menu增加Resources: /userful-resources</li>
<li>widgets更改为[category, tag, links]</li>
<li>增加sitemap<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sitemap:</span><br><span class="line">    path: sitemap.xml</span><br></pre></td></tr></table></figure></li>
<li>更改主题颜色theme: ‘#3d85c6’</li>
<li>主页不展开expand: false</li>
<li>关闭文章边栏close_aside: true</li>
<li>creative_commons: by-nc-sa<span id="more"></span></li>
<li>更改作者信息<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">author:</span><br><span class="line">  intro_line1:  &quot;Hello&quot;    ## your introduction on the bottom of the page</span><br><span class="line">  intro_line2:  &quot;This is my blog!&quot;  ## the 2nd line</span><br><span class="line">  weibo: 5748426185     ## e.g. 5748426185 or 2176287895 for http://weibo.com/2176287895</span><br><span class="line">  weibo_verifier: cd4768ca    ## e.g. cd4768ca Your weibo-show widget verifier ,if you use weibo-show it is needed.</span><br><span class="line">  tsina: mchsinx     ## e.g. 2176287895  Your weibo ID,It will be used in share button.</span><br><span class="line">  douban:     ## e.g. wuchong1014 or your id for https://www.douban.com/people/wuchong1014</span><br><span class="line">  zhihu:      ## e.g. jark  for http://www.zhihu.com/people/jark</span><br><span class="line">  email:      ## e.g. imjark@gmail.com</span><br><span class="line">  twitter: mchsinx   ## e.g. jarkwu for https://twitter.com/jarkwu</span><br><span class="line">  github: mchsinx    ## e.g. wuchong for https://github.com/wuchong</span><br><span class="line">  facebook:   ## e.g. imjark for https://facebook.com/imjark</span><br><span class="line">  linkedin:   ## e.g. wuchong1014 for https://www.linkedin.com/in/wuchong1014</span><br><span class="line">  google_plus:    ## e.g. &quot;111190881341800841449&quot; for https://plus.google.com/u/0/111190881341800841449, the &quot;&quot; is needed!</span><br><span class="line">  stackoverflow:  ## e.g. 3222790 for http://stackoverflow.com/users/3222790/jark</span><br><span class="line">## if you set them, the corresponding  share button will show on the footer</span><br></pre></td></tr></table></figure></li>
<li>更改友情链接<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">links:</span><br><span class="line">  Mchsinx: http://www.mchsinx.com, 导航网站</span><br></pre></td></tr></table></figure></li>
<li>更改统计代码<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#### Analytics</span><br><span class="line">google_analytics:</span><br><span class="line">  enable: true</span><br><span class="line">  id: UA-64362927-1       ## e.g. UA-46321946-2 your google analytics ID.</span><br><span class="line">## You MUST upgrade to Universal Analytics first!</span><br><span class="line">## https://developers.google.com/analytics/devguides/collection/upgrade/?hl=zh_CN</span><br><span class="line">statcounter: # 需自行在analytics.ejs中配置参数</span><br><span class="line">  enable: true</span><br><span class="line">baidu_tongji:</span><br><span class="line">  enable: true</span><br><span class="line">  sitecode: 3d6283374c5e33764e4cf6c0b398f634 ## e.g. e6d1f421bbc9962127a50488f9ed37d1 your baidu tongji site code</span><br><span class="line">cnzz_tongji:</span><br><span class="line">  enable: true</span><br><span class="line">  siteid: 1255560261   ## e.g. 1253575964 your cnzz tongji site id</span><br><span class="line">  servername: s95</span><br><span class="line">ibruce_tongji: # 不蒜子计数</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure></li>
<li>增加swift_search搜索</li>
<li>增加百度推送</li>
</ul>
<h2 id="增加swiftype-search搜索和百度推送"><a href="#增加swiftype-search搜索和百度推送" class="headerlink" title="增加swiftype_search搜索和百度推送"></a>增加swiftype_search搜索和百度推送</h2><ul>
<li>在\layout_partial\after_footer.ejs中添加代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- swiftype search Begin(1/2)--&gt;</span><br><span class="line">&lt;% if(theme.swift_search.enable)&#123; %&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">  (function(w,d,t,u,n,s,e)&#123;w[&#x27;SwiftypeObject&#x27;]=n;w[n]=w[n]||function()&#123;</span><br><span class="line">  (w[n].q=w[n].q||[]).push(arguments);&#125;;s=d.createElement(t);</span><br><span class="line">  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);</span><br><span class="line">  &#125;)(window,document,&#x27;script&#x27;,&#x27;//s.swiftypecdn.com/install/v2/st.js&#x27;,&#x27;_st&#x27;);</span><br><span class="line"></span><br><span class="line">  _st(&#x27;install&#x27;,&#x27;B93BSEbFZoHzYDdVqWxH&#x27;,&#x27;2.0.0&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;!-- swiftype search End(1/2)--&gt;</span><br><span class="line"></span><br><span class="line">&lt;% if(theme.baidu_push.enable)&#123; %&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(function()&#123;</span><br><span class="line">    var bp = document.createElement(&#x27;script&#x27;);</span><br><span class="line">    bp.src = &#x27;//push.zhanzhang.baidu.com/push.js&#x27;;</span><br><span class="line">    var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">    s.parentNode.insertBefore(bp, s);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要在主题配置文件中添加开关</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">swift_seach:</span><br><span class="line">    enable: true</span><br><span class="line">baidu_push:</span><br><span class="line">    enable: true</span><br></pre></td></tr></table></figure>

<ul>
<li>在\layout_partial\header.ejs中增加代码，插入在<code>&lt;% &#125; else if(theme.baidu_search.enable)&#123; %&gt;</code>之前</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- swiftype search Begin(2/2)--&gt;</span><br><span class="line">&lt;% &#125;else if(theme.swift_search.enable)&#123; %&gt;</span><br><span class="line">&lt;form class=&quot;search&quot;  accept-charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;label&gt;Search&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; class=&quot;st-default-search-input&quot; maxlength=&quot;20&quot; placeholder=&quot;&lt;%= __(&#x27;search&#x27;) %&gt;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;!-- swiftype search End(2/2)--&gt;</span><br></pre></td></tr></table></figure>

<h2 id="修改百度统计和CNZZ统计-增加statcounter"><a href="#修改百度统计和CNZZ统计-增加statcounter" class="headerlink" title="修改百度统计和CNZZ统计,增加statcounter"></a>修改百度统计和CNZZ统计,增加statcounter</h2><ul>
<li>在\layout_partial\analytics.ejs中修改代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;% if (theme.google_analytics.enable)&#123; %&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    (function(i,s,o,g,r,a,m)&#123;i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function()&#123;</span><br><span class="line">    (i[r].q=i[r].q||[]).push(arguments)&#125;,i[r].l=1*new Date();a=s.createElement(o),</span><br><span class="line">    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)</span><br><span class="line">    &#125;)(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);</span><br><span class="line"></span><br><span class="line">    ga(&#x27;create&#x27;, &#x27;&lt;%= theme.google_analytics.id %&gt;&#x27;, &#x27;auto&#x27;);</span><br><span class="line">    ga(&#x27;send&#x27;, &#x27;pageview&#x27;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"></span><br><span class="line">&lt;% if (theme.baidu_tongji.enable)&#123; %&gt;</span><br><span class="line">  &lt;div style=&quot;display:none&quot;&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      var _hmt = _hmt || [];</span><br><span class="line">      (function() &#123;</span><br><span class="line">        var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">        hm.src = &quot;//hm.baidu.com/hm.js?&lt;%= theme.baidu_tongji.sitecode %&gt;&quot;;</span><br><span class="line">        var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">        s.parentNode.insertBefore(hm, s);</span><br><span class="line">      &#125;)();</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"></span><br><span class="line">&lt;% if (theme.statcounter.enable)&#123; %&gt;</span><br><span class="line">&lt;!-- Start of StatCounter Code for Default Guide --&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">var sc_project=10517493;</span><br><span class="line">var sc_invisible=1;</span><br><span class="line">var sc_security=&quot;a3203727&quot;;</span><br><span class="line">var scJsHost = ((&quot;https:&quot; == document.location.protocol) ?</span><br><span class="line">&quot;https://secure.&quot; : &quot;http://www.&quot;);</span><br><span class="line">document.write(&quot;&lt;sc&quot;+&quot;ript type=&#x27;text/javascript&#x27; src=&#x27;&quot; +</span><br><span class="line">scJsHost+</span><br><span class="line">&quot;statcounter.com/counter/counter.js&#x27;&gt;&lt;/&quot;+&quot;script&gt;&quot;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;noscript&gt;&lt;div class=&quot;statcounter&quot;&gt;&lt;a title=&quot;shopify visitor</span><br><span class="line">statistics&quot; href=&quot;http://statcounter.com/shopify/&quot;</span><br><span class="line">target=&quot;_blank&quot;&gt;&lt;img class=&quot;statcounter&quot;</span><br><span class="line">src=&quot;http://c.statcounter.com/10517493/0/a3203727/1/&quot;</span><br><span class="line">alt=&quot;shopify visitor statistics&quot;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/noscript&gt;</span><br><span class="line">&lt;!-- End of StatCounter Code for Default Guide --&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"></span><br><span class="line">&lt;% if (theme.cnzz_tongji.enable)&#123; %&gt;</span><br><span class="line">  &lt;div style=&quot;display:none&quot;&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;var cnzz_protocol = ((&quot;https:&quot; == document.location.protocol) ? &quot; https://&quot; : &quot; http://&quot;);document.write(unescape(&quot;%3Cspan id=&#x27;cnzz_stat_icon_&lt;%= theme.cnzz_tongji.siteid %&gt;&#x27;%3E%3C/span%3E%3Cscript src=&#x27;&quot; + cnzz_protocol + &quot;&lt;%= theme.cnzz_tongji.servername %&gt;.cnzz.com/stat.php%3Fid%3D&lt;%= theme.cnzz_tongji.siteid %&gt;&#x27; type=&#x27;text/javascript&#x27;%3E%3C/script%3E&quot;));&lt;/script&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="增加不蒜子统计"><a href="#增加不蒜子统计" class="headerlink" title="增加不蒜子统计"></a>增加不蒜子统计</h2><p>在\layout_partial\footer.ejs中修改代码，在最后一个<code>&lt;/p&gt;</code>之前增加代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 不蒜子统计 --&gt;</span><br><span class="line">&lt;% if (theme.ibruce_tongji.enable)&#123; %&gt;</span><br><span class="line">&lt;script async src=&quot;https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;span id=&quot;busuanzi_container_site_pv&quot; style=&#x27;display:none&#x27;&gt;</span><br><span class="line">&lt;/br&gt;本站总访问量&lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;,本站访客数&lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;，本文总阅读量&lt;span id=&quot;busuanzi_value_page_pv&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="修正谷歌搜索"><a href="#修正谷歌搜索" class="headerlink" title="修正谷歌搜索"></a>修正谷歌搜索</h2><p>在google.com之前加www</p>
<h2 id="增加百度自定义搜索"><a href="#增加百度自定义搜索" class="headerlink" title="增加百度自定义搜索"></a>增加百度自定义搜索</h2><p>在\layout_partial\hearder.ejs中添加代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;% &#125; else if(theme.baidu_search_my.enable)&#123; %&gt;</span><br><span class="line">&lt;form action=&quot;http://www.baidu.com/baidu&quot; method=&quot;get&quot; accept-charset=&quot;utf-8&quot; class=&quot;search&quot;&gt;</span><br><span class="line">&lt;label&gt;Search&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;search&quot; name=&quot;word&quot; maxlength=&quot;20&quot; class=&quot;search-input&quot; placeholder=&quot;&lt;%= __(&#x27;search&#x27;) %&gt;&quot;&gt;</span><br><span class="line">&lt;input name=tn type=hidden value=&quot;bds&quot;&gt;</span><br><span class="line">&lt;input name=cl type=hidden value=&quot;3&quot;&gt;</span><br><span class="line">&lt;input name=ct type=hidden value=&quot;2097152&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;si&quot; value=&quot;&lt;%- config.url.replace(/^https?:\/\//, &#x27;&#x27;) %&gt;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>在下面这段代码之前</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">&lt;form class=&quot;search&quot; action=&quot;//www.google.com/search&quot; method=&quot;get&quot; accept-charset=&quot;utf-8&quot;&gt;</span><br><span class="line">	&lt;label&gt;Search&lt;/label&gt;</span><br><span class="line">	&lt;input type=&quot;search&quot; id=&quot;search&quot; name=&quot;q&quot; autocomplete=&quot;off&quot; maxlength=&quot;20&quot; placeholder=&quot;&lt;%= __(&#x27;search&#x27;) %&gt;&quot; /&gt;</span><br><span class="line">	&lt;input type=&quot;hidden&quot; name=&quot;q&quot; value=&quot;site:&lt;%- config.url.replace(/^https?:\/\//, &#x27;&#x27;) %&gt;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="增加”更新时间”"><a href="#增加”更新时间”" class="headerlink" title="增加”更新时间”"></a>增加”更新时间”</h2><ul>
<li><p>将\layout_partial\post\hearder.ejs相应代码修改为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;p class=&quot;article-time&quot;&gt;</span><br><span class="line">  &lt;time datetime=&quot;&lt;%= date_xml(item.date) %&gt;&quot; itemprop=&quot;datePublished&quot;&gt; &lt;%= __(&#x27;datepublished&#x27;) %&gt; &lt;%= item.date.format(config.datetime_format) %&gt;&lt;/time&gt;</span><br><span class="line">  &lt;time postupdated=&quot;&lt;%= date_xml(item.updated) %&gt;&quot; itemprop=&quot;dateModified&quot;&gt; &lt;%= __(&#x27;dateModified&#x27;) %&gt; &lt;%= item.updated.format(config.datetime_format) %&gt;&lt;/time&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>更改站点配置文件<br>在<code>time_format: HH:mm:ss</code>下面添加<code>datetime_format: YYYY-MM-DD HH:mm:ss</code></p>
</li>
<li><p>在语言文件zh-CN.yml中增加<code>dateModified: 更新于</code><br>经测试，文章Front-matter部分也可以不写updated,hexo会自动记录更新时间</p>
</li>
</ul>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>jacman</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo通过git自动部署到vps</title>
    <url>/post/hexo-deploy-git-vps.html</url>
    <content><![CDATA[<blockquote>
<p>本文环境：<br>vps:centos 7 64位<br>本地: windows 10 32位</p>
</blockquote>
<span id="more"></span>
<h2 id="本地安装并配置git"><a href="#本地安装并配置git" class="headerlink" title="本地安装并配置git"></a>本地安装并配置git</h2><ul>
<li><p>安装git</p>
</li>
<li><p>创建SSH Key</p>
</li>
</ul>
<p>在git bash中运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;mcosx@example.com&quot;   //注意替换邮箱</span><br><span class="line">//ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot; 使用这个会出错(2015-12-28)</span><br></pre></td></tr></table></figure>
<p>生成<code>id_rsa</code>和<code>id_rsa.pub</code>或你自己命名的两个文件</p>
<ul>
<li>配置ssh key</li>
</ul>
<p>因为我将vps的ssh端口更改了，所以此处多一步<br>在<code>.ssh</code>目录config文件中增加以下配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host 00.00.00.00  //替换主机ip</span><br><span class="line">    HostName 00.00.00.00</span><br><span class="line">    port 56734   //替换端口号</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa  //替换id_rsa文件名</span><br></pre></td></tr></table></figure>
<p>据说也可以更改git地址为 ssh://<a href="mailto:&#x67;&#105;&#x74;&#x40;&#x30;&#x30;&#46;&#48;&#48;&#46;&#48;&#48;&#x2e;&#48;&#48;">&#x67;&#105;&#x74;&#x40;&#x30;&#x30;&#46;&#48;&#48;&#46;&#48;&#48;&#x2e;&#48;&#48;</a>:56734/home/git/hexo.git类似这样的(未测试)</p>
<h2 id="vps上git配置"><a href="#vps上git配置" class="headerlink" title="vps上git配置"></a>vps上git配置</h2><ul>
<li>安装git</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y git</span><br></pre></td></tr></table></figure>

<ul>
<li>创建git用户</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">useradd git   // 或 adduser git</span><br><span class="line">passwd git //修改密码</span><br></pre></td></tr></table></figure>

<ul>
<li>git服务器打开RSA认证</li>
</ul>
<p>在Git服务器上需要将/etc/ssh/sshd_config中的RSA认证打开，即</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#RSAAuthentication yes</span><br><span class="line">#PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile  .ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>然后将本地生成的公钥文件id_rsa.pub内容复制入/home/git/.ssh/authorized_keys文件中</p>
<ul>
<li>禁用git用户的shell登陆</li>
</ul>
<p>出于安全考虑，新创建的git用户不允许登陆shell,这可以通过编辑/etc/passwd文件完成。<br>将类似</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003:,,,:/home/git:/bin/bash</span><br></pre></td></tr></table></figure>
<p>这样的代码替换为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure>
<p>这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。</p>
<h2 id="在vps上部署hexo自动发布"><a href="#在vps上部署hexo自动发布" class="headerlink" title="在vps上部署hexo自动发布"></a>在vps上部署hexo自动发布</h2><ul>
<li>vps上初始化git仓库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /home  //注意，我开始试着用/root目录，出现错误，应该是git用户权限的问题</span><br><span class="line">//刚发现原来/etc/passwd/中git用户的目录对应着/home/git</span><br><span class="line">git init --bare hexo.git  //初始化</span><br><span class="line">chown -R git:git hexo.git //更改用户和用户组</span><br></pre></td></tr></table></figure>

<ul>
<li>vps配置hexo自动发布</li>
</ul>
<p>我们上一步建立的git仓库(相当于git服务器)位于/home/git/hexo.git，而vps上我设置的web对应目录为/home/wwwroot/blog.mcosx.cn,所以要再设置个git(相当于客户端)从git仓库中clone到对应的web目录.并且要让这一步骤自动进行可以通过git hook中的post-receive。<br>通过执行<code>vim /home/git/hexo.git/hooks/post-receive</code>新建文件并添加以下代码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PUBLIC_WWW=/data/wwwroot/mcosx_hexo</span></span><br><span class="line"><span class="comment">#cd $PUBLIC_WWW</span></span><br><span class="line"><span class="comment">#env -i git reset --hard</span></span><br><span class="line"><span class="comment">#env -i git pull</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#GIT_REPO=/home/git/mcosx_hexo.git</span></span><br><span class="line"><span class="comment">#TMP_GIT_CLONE=/tmp/blog</span></span><br><span class="line"><span class="comment">#PUBLIC_WWW=/data/wwwroot/mcosx_hexo</span></span><br><span class="line"><span class="comment">#rm -rf $&#123;TMP_GIT_CLONE&#125;</span></span><br><span class="line"><span class="comment">#git clone $GIT_REPO $TMP_GIT_CLONE</span></span><br><span class="line"><span class="comment">#rm -rf $&#123;PUBLIC_WWW&#125;/*</span></span><br><span class="line"><span class="comment">#cp -rf $&#123;TMP_GIT_CLONE&#125;/* $&#123;PUBLIC_WWW&#125;</span></span><br><span class="line"></span><br><span class="line">git --work-tree=/data/wwwroot/mcosx_hexo --git-dir=/home/git/mcosx_hexo.git checkout -f</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod +x /home/git/hexo.git/hooks/post-receive</span><br><span class="line">rm -fr /home/wwwroot/blog.mcosx.cn   #删除web文件夹，需要的话请提前备份</span><br><span class="line">git clone /home/git/hexo.git /home/wwwroot/blog.mcosx.cn</span><br><span class="line">chown -R git:git /home/wwwroot/blog.mcosx.cn  #增加权限</span><br><span class="line">cd /home/wwwroot/blog.mcosx.cn</span><br><span class="line">git config user.name &quot;mcosx&quot;</span><br><span class="line">git config user.email &quot;mcosx@example.com&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>hexo本地配置</li>
</ul>
<p>然后在本地站点hexo中添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line"> - type: git</span><br><span class="line">  message:</span><br><span class="line">  repo:</span><br><span class="line">    server: git@00.00.00.00:/home/git/hexo.git,master ##替换服务器地址</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>权限问题</li>
</ul>
<p>本文执行git操作的为git用户，所以上传的文件只能做git用户权限类的事。例如本文中就只能解析静态网页，因为git用户没有php的访问权限。<br>如果需要解析php动态页面，可以通过修改php-fpm的配置文件<a href="http://www.conf,让`user/">www.conf,让`user</a> = git`,甚至还可以修改nginx的nginx.conf文件,让user为git:git,使它成为nginx的操作用户。</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ul>
<li>./post-receive文件执行错误</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost hooks]# ./post-receive</span><br><span class="line">bash: ./post-receive: /bin/bash^M: bad interpreter: No such file or directory</span><br></pre></td></tr></table></figure>
<p>原来是文件格式问题，dos自动给行尾加^M,要将文件格式转为unix。<br>vim可以这样<code>:set fileformat=unix</code>,<br>通过<code>cat -v &lt;文件名&gt;</code>可以查看是否有^M.</p>
<blockquote>
<p>2015-12-28 更新</p>
</blockquote>
<ul>
<li><p>git连接问题<br>可以用<code>ssh -v git@00.00.00.00</code>测试并判断错误出处</p>
</li>
<li><p>remote: fatal: Not a git repository: ‘.’<br>检查hooks文件</p>
</li>
<li><p>目标文件夹空<br>post-receive必须接受到更新才会触发，没有更改不会执行</p>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://huifeng.me/2015/08/16/deploy-hexo-to-vps/">http://huifeng.me/2015/08/16/deploy-hexo-to-vps/</a><br><a href="https://isudox.com/2015/09/03/hexo-your-blog/">https://isudox.com/2015/09/03/hexo-your-blog/</a><br><a href="http://blog.csdn.net/u012345283/article/details/42970991">http://blog.csdn.net/u012345283/article/details/42970991</a></p>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>git</tag>
        <tag>vps</tag>
        <tag>centos</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx下通过Basic access authentication加密网站</title>
    <url>/post/encrypt-website-in-nginx-by-http-basis-access-auth.html</url>
    <content><![CDATA[<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><ul>
<li><a href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic access authentication</a></li>
</ul>
<h2 id="nginx下加密网站"><a href="#nginx下加密网站" class="headerlink" title="nginx下加密网站"></a>nginx下加密网站</h2><p>在nginx配置文件中添加以下代码即可实现网站加密</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    auth_basic           <span class="string">&quot;closed site&quot;</span>;   <span class="comment"># 提示信息</span></span><br><span class="line">    auth_basic_user_file /home/conf/htpasswd;  <span class="comment">#密钥文件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>密钥文件格式如下（每行对应一对用户名和密码）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">abc:XK/IBlWKzc4N2</span><br><span class="line">sfajo:uvvdZC313LC1Q</span><br></pre></td></tr></table></figure>
<p>可通过 <a href="http://tool.oschina.net/htpasswd">http://tool.oschina.net/htpasswd</a> 在线生成</p>
<p>经测试，用<a href="http://php.net/manual/zh/features.http-auth.php">php进行http认证</a>也可以在nginx下使用.</p>
<p>这种方法的缺点是在用户不退出浏览器的情况下，没有方法能让用户登出，并且用户在登入时密码错误时要重新打开浏览器输入密码，比较麻烦。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://php.net/manual/zh/features.http-auth.php">php官方文档-用 PHP 进行 HTTP 认证</a></li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html#auth_basic_user_file">nginx官方文档</a></li>
</ul>
]]></content>
      <categories>
        <category>后台相关</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>encrypt</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:ZigZag Conversion</title>
    <url>/post/zigzag-conversion.html</url>
    <content><![CDATA[<h2 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h2><p>Total Accepted: 65019 Total Submissions: 292477 Difficulty: Easy</p>
<blockquote>
<p>The string <code>&quot;PAYPALISHIRING&quot;</code> is written in a zigzag pattern on a given number of rows like this: (you may want to display this pattern in a fixed font for better legibility)</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">P   A   H   N</span><br><span class="line">A P L S I I G</span><br><span class="line">Y   I   R</span><br></pre></td></tr></table></figure>
<blockquote>
<p>And then read line by line: <code>&quot;PAHNAPLSIIGYIR&quot;</code><br>Write the code that will take a string and make this conversion given a number of rows:</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">string <span class="title">convert</span><span class="params">(string text, <span class="type">int</span> nRows)</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>convert(&quot;PAYPALISHIRING&quot;, 3)</code> should return <code>&quot;PAHNAPLSIIGYIR&quot;</code>.<br>Subscribe to see which companies asked this question</p>
</blockquote>
<span id="more"></span>

<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>大概思路都类似，我这个比较直接。<br>总数为2(numRows-1),除第一和最后一行外下面两个都是顺序加2(numRows-i-1)和2(numRows-1)-2(numRows-i-1)。<br>更好的可以参考<br><a href="http://bangbingsyb.blogspot.jp/2014/11/leetcode-zigzag-conversion.html">http://bangbingsyb.blogspot.jp/2014/11/leetcode-zigzag-conversion.html</a><br><a href="http://www.cnblogs.com/yuzhangcmu/p/4116668.html">http://www.cnblogs.com/yuzhangcmu/p/4116668.html</a><br><a href="http://boylee.me/development/2014/12/23/leetcode-zigzag-conversion/">http://boylee.me/development/2014/12/23/leetcode-zigzag-conversion/</a></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">convert</span><span class="params">(string s, <span class="type">int</span> numRows)</span> </span>&#123;</span><br><span class="line">        string ret;</span><br><span class="line">        <span class="keyword">if</span> (numRows &lt;= <span class="number">1</span> ) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numRows &amp;&amp; i &lt; s.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ret.<span class="built_in">push_back</span>(s[i]);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">2</span> * (numRows - <span class="number">1</span> - i) + i; j &lt; s.<span class="built_in">size</span>(); j += <span class="number">2</span> * (numRows - <span class="number">1</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">2</span> * (numRows - <span class="number">1</span> - i))</span><br><span class="line">                &#123;</span><br><span class="line">                    ret.<span class="built_in">push_back</span>(s[j]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">2</span> * i &amp;&amp; j+<span class="number">2</span>*i&lt;s.<span class="built_in">size</span>())</span><br><span class="line">                &#123;</span><br><span class="line">                    ret.<span class="built_in">push_back</span>(s[j + <span class="number">2</span> * i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Solution x;</span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; x.convert(&quot;PAYPALISHIRING&quot;, 3) &lt;&lt; endl;</span></span><br><span class="line">    std::cout &lt;&lt; x.<span class="built_in">convert</span>(<span class="string">&quot;123456789ABCD&quot;</span>, <span class="number">3</span>) &lt;&lt; endl;</span><br><span class="line">    std::cout &lt;&lt; x.<span class="built_in">convert</span>(<span class="string">&quot;123456789ABCD&quot;</span>, <span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">    std::cout &lt;&lt; x.<span class="built_in">convert</span>(<span class="string">&quot;A&quot;</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>需要注意当numRows==1的这种情况。</li>
<li>特别注意<code>(&quot;A&quot;,2)</code>这种情况，不能进入for语句执行ret.push_back(s[i]),所以需要在for中限制&amp;&amp; i &lt; s.size().</li>
</ul>
<h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><p>题意要求给定一个ZigZag形式的字符串，然后以行的形式重新遍历一遍。整个看来主要就是找规律，str代表字串，row代表要求的行数：</p>
<ul>
<li>第一行或最后一行：前一个数和后一个数之差为(row-1)*2</li>
<li>其他行，行数为：除了满足上一条之外，在这两个数中间还有一个数，和前一个数的差为(row-i-1)*2<br>规律找出来的就是逻辑实现了，外层循环遍历row边，内层循环直到到达字符串尾：代码如下：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">     string convert(string s, int nRows) &#123;</span><br><span class="line">         string res = &quot;&quot;;</span><br><span class="line">         if (nRows == 1) return s;</span><br><span class="line">         for (int i = 0; i &lt; nRows; ++i)</span><br><span class="line">         &#123;</span><br><span class="line">             int j = i;</span><br><span class="line">             while (j &lt; s.length())</span><br><span class="line">             &#123;</span><br><span class="line">                 res += s[j];</span><br><span class="line">                 if (i != 0 &amp;&amp; i != nRows - 1 &amp;&amp; j + (nRows - i) * 2 - 2 &lt; s.length())</span><br><span class="line">                     res += s[j + (nRows - i) * 2 - 2];</span><br><span class="line">                 j += (nRows - 1) * 2;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         return res;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
来源:<a href="http://boylee.me/development/2014/12/23/leetcode-zigzag-conversion/">http://boylee.me/development/2014/12/23/leetcode-zigzag-conversion/</a></li>
</ul>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu下用pptp搭建vpn服务器及相关上网配置</title>
    <url>/post/ubuntu-pptp-vpn-server.html</url>
    <content><![CDATA[<p>这次建立vpn服务器遇到的问题太多了，现在把基本流程和遇到问题总结一下，先说下遇到的问题</p>
<ul>
<li>vpn连上但上不了网</li>
<li>vpn电脑可以连上，但手机却连不上（iptables问题）</li>
<li>重启vpn连不上</li>
<li>crontab通过curl发送post上网登陆命令总是不成功</li>
<li>限制ssh登陆ip<br>以上问题都总结到以下流程中</li>
</ul>
<blockquote>
<p>本文环境<br>ubuntu 15.10 64位</p>
</blockquote>
<span id="more"></span>
<h2 id="安装配置PPTPServer"><a href="#安装配置PPTPServer" class="headerlink" title="安装配置PPTPServer"></a>安装配置PPTPServer</h2><ul>
<li>安装pptp服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install pptpd</span><br></pre></td></tr></table></figure>
<ul>
<li>修改/etc/pptpd.conf</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/pptpd.conf</span><br></pre></td></tr></table></figure>
<p>增加本地Ip和远程ip,此处ip与本机Ip及外网Ip没有关系，相当于路由器的网关Ip和内网Ip。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">localip 192.168.11.1</span><br><span class="line">remoteip 192.168.11.5-20,192.168.11.25  #格式</span><br></pre></td></tr></table></figure>
<ul>
<li>修改/etc/ppp/pptpd-options</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ppp/pptpd-options</span><br></pre></td></tr></table></figure>
<p>修改内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">name pptpd</span><br><span class="line"></span><br><span class="line">refuse-pap</span><br><span class="line">require-chap</span><br><span class="line">require-mschap</span><br><span class="line">require-mschap-v2</span><br><span class="line"></span><br><span class="line">ms-dns 223.5.5.5</span><br><span class="line">ms-dns 223.6.6.6</span><br><span class="line"></span><br><span class="line">proxyarp</span><br><span class="line">nodefaultroute</span><br><span class="line">lock</span><br><span class="line">nobsdcomp</span><br><span class="line">novj</span><br><span class="line">nologfd</span><br></pre></td></tr></table></figure>

<p>主要问题都出现在这个文件中，可以通过日志观察</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tail -f /var/log/syslog</span><br></pre></td></tr></table></figure>

<ul>
<li>修改/etc/ppp/chap-secrets</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/ppp/chap-secrets</span><br></pre></td></tr></table></figure>
<p>增加vpn连接的用户名密码，例如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vpn pptpd vpn *</span><br><span class="line">guest pptpd guest *</span><br></pre></td></tr></table></figure>
<p>重启pptp服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service pptpd restart</span><br></pre></td></tr></table></figure>
<ul>
<li>修改/etc/sysctl.conf</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>增加ipv4转发</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>
<p>配置生效</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>

<ul>
<li>iptables设置</li>
</ul>
<p>手机连不上，连上了vpn上不了网主要是因为iptables.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -A POSTROUTING -s 192.168.11.0/24 -o eno1 -j MASQUERADE </span><br><span class="line">sudo iptables -I INPUT -p tcp --dport 1723 -j ACCEPT </span><br><span class="line">sudo iptables -I INPUT --protocol 47 -j ACCEPT</span><br><span class="line"><span class="comment"># 以下两个任意一个即可</span></span><br><span class="line">sudo iptables -I FORWARD -s 192.168.11.0/24 -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j TCPMSS --set-mss 1356</span><br><span class="line"><span class="comment">#iptables -A FORWARD -p tcp --syn -s 192.168.11.0/24 -j TCPMSS --set-mss 1356</span></span><br></pre></td></tr></table></figure>
<p>注意，以上的eno1为网卡名，可以通过<code>ifconfig</code>来查看;ip段为客户端的ip端。<br>查看iptables规则</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">iptables -nvL --line-number</span><br></pre></td></tr></table></figure>
<p>更详细的可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">man iptables</span><br></pre></td></tr></table></figure>

<h2 id="设置开机启动定时任务等"><a href="#设置开机启动定时任务等" class="headerlink" title="设置开机启动定时任务等"></a>设置开机启动定时任务等</h2><ul>
<li>修改/etc/rc.local</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/rc.local</span><br></pre></td></tr></table></figure>
<p>增加启动项</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">service pptpd start</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.11.0/24 -o eno1 -j MASQUERADE</span><br><span class="line">iptables -I FORWARD -s 192.168.11.0/24 -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j TCPMSS --set-mss 1356</span><br><span class="line">#iptables -A FORWARD -p tcp --syn -s 192.168.11.0/24 -j TCPMSS --set-mss 1356</span><br></pre></td></tr></table></figure>
<p>注意，rc.local文件默认是以root权限运行程序的</p>
<ul>
<li>设置crontab定时任务</li>
</ul>
<p>学校的网页认证是早上定时断连，所以用curl定时post一个认证即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># crontab -l #列出当前用户定时任务</span><br><span class="line">crontab -e #进入编辑</span><br></pre></td></tr></table></figure>
<p>增加一行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 5,6,7,8 * * * /home/username/tools/usernamelogin</span><br></pre></td></tr></table></figure>
<p>然后在相应文件写入命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"> </span><br><span class="line">curl -d &quot;username=username&amp;password=password&amp;if_login=Y&amp;B2=%B5%C7%C2%BC%28Login%29&quot; http://89.23.00.00:5000/login/login1.jsp &gt;&gt; ./usernamelogin.log</span><br></pre></td></tr></table></figure>

<ul>
<li><p>限制ssh登陆ip<br>在/etc/hosts.allow输入<br>(其中192.168.10.88是你要允许登陆ssh的ip,或者是一个网段192.168.10.0/24)  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sshd:192.168.10.88:allow</span><br></pre></td></tr></table></figure>
<p>在/etc/hosts.deny输入(表示除了上面允许的，其他的ip   都拒绝登陆ssh)  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sshd:ALL</span><br></pre></td></tr></table></figure></li>
<li><p>更改ssh登陆端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="客户端设置"><a href="#客户端设置" class="headerlink" title="客户端设置"></a>客户端设置</h2><p>手机端连接时要需要取消ppp加密选项。电脑端要选择pptp加密选项</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.digitalocean.com/community/tutorials/how-to-setup-your-own-vpn-with-pptp">https://www.digitalocean.com/community/tutorials/how-to-setup-your-own-vpn-with-pptp</a><br><a href="https://help.ubuntu.com/community/PPTPServer">https://help.ubuntu.com/community/PPTPServer</a><br><a href="https://github.com/viljoviitanen/setup-simple-pptp-vpn/blob/master/setup.sh">https://github.com/viljoviitanen/setup-simple-pptp-vpn/blob/master/setup.sh</a><br><a href="http://www.dabu.info/centos6-4-structures-pptp-vpn.html">http://www.dabu.info/centos6-4-structures-pptp-vpn.html</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>vpn</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>使多说支持https</title>
    <url>/post/duoshuo-https.html</url>
    <content><![CDATA[<blockquote>
<p>本文环境： vps(centos+nginx+https)</p>
</blockquote>
<h2 id="配置nginx反向代理"><a href="#配置nginx反向代理" class="headerlink" title="配置nginx反向代理"></a>配置nginx反向代理</h2><ol>
<li><p>在<code>nginx.conf</code>中添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_cache_path    /usr/local/nginx/proxy_cache levels=1:2 keys_zone=pnc:300m inactive=30d max_size=10g;</span><br><span class="line">proxy_temp_path     /usr/local/nginx/proxy_temp;</span><br><span class="line">proxy_cache_key     $host$uri$is_args$args;</span><br></pre></td></tr></table></figure></li>
<li><p>在<code>blog.mcosx.cn.conf</code>中添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location ~ &quot;^/proxy/(.*)$&quot; &#123;</span><br><span class="line">    valid_referers blocked *.mcosx.cn;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line">    resolver 223.5.5.5;</span><br><span class="line">    proxy_connect_timeout    10s;</span><br><span class="line">    proxy_read_timeout       10s;</span><br><span class="line"></span><br><span class="line">    proxy_pass               http://$1;</span><br><span class="line">    proxy_redirect    off;</span><br><span class="line"></span><br><span class="line">    proxy_cache              pnc;</span><br><span class="line">    proxy_cache_valid        200 30d;</span><br><span class="line">    proxy_cache_lock         on;</span><br><span class="line">    proxy_cache_lock_timeout 5s;</span><br><span class="line">    proxy_cache_use_stale    updating error timeout invalid_header http_500 http_502;</span><br><span class="line"></span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line"></span><br><span class="line">    add_header               X-Cache &quot;$upstream_cache_status from cache.mcosx&quot;;</span><br><span class="line"></span><br><span class="line">    expires                  7d;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="修改多说embed-js文件"><a href="#修改多说embed-js文件" class="headerlink" title="修改多说embed.js文件"></a>修改多说<a href="https://static.duoshuo.com/embed.js">embed.js</a>文件</h2><ol>
<li><p>下载多说’embled.js’文件<br>写本文时(2016年1月5日 20:50:22)embed.js状态为ETag: “5648633e-f117”。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -I  https://static.duoshuo.com/embed.js</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.4.6 (Ubuntu)</span><br><span class="line">Date: Tue, 05 Jan 2016 12:49:43 GMT</span><br><span class="line">Content-Type: application/x-javascript; charset=utf-8</span><br><span class="line">Content-Length: 61719</span><br><span class="line">Last-Modified: Sun, 15 Nov 2015 10:49:34 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">ETag: &quot;5648633e-f117&quot;</span><br><span class="line">Expires: Tue, 12 Jan 2016 12:49:43 GMT</span><br><span class="line">Cache-Control: max-age=604800</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure></li>
<li><p>然后将embed.js文件放在本地,并修改(备注处为增加语句)<br>注意多说embed.js是压缩的，可以使用<a href="http://tool.css-js.com/">CSS-JS</a>进行解压。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">avatarUrl: function(e) &#123;</span><br><span class="line">                /*if (e.avatar_url) &#123;</span><br><span class="line">                    e.avatar_url = (document.location.protocol == &quot;https:&quot;) ? e.avatar_url.replace(/^http\:\/\//, &quot;https://blog.mcosx.cn/proxy/&quot;) : e.avatar_url;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    rt.data.default_avatar_url = &#x27;/img/noavatar_default.png&#x27;;</span><br><span class="line">                &#125;*/</span><br><span class="line">                return e.avatar_url || rt.data.default_avatar_url;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure></li>
<li><p>然后修改本地的多说代码，将ds.src更换为本地路径，本文更换为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ds.src=&#x27;/js/embed.js&#x27;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>本文使用的是反向代理的方法，也可以使用cdn的方式。详见参考</p>
</blockquote>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>巧用七牛HTTPS域名,无需反代让多说支持SSL和CDN加速 20151114 <a href="https://quericy.me/blog/788">https://quericy.me/blog/788</a></li>
<li>让多说评论框完美支持HTTPS 20150707 <a href="https://hack0nair.me/2015-07-07-duoshuo-plugin-support-https-prefectly/">https://hack0nair.me/2015-07-07-duoshuo-plugin-support-https-prefectly/</a></li>
<li>让多说评论框完美支持 HTTPS 20150927 <a href="https://imququ.com/post/duoshuo-and-https.html">https://imququ.com/post/duoshuo-and-https.html</a></li>
</ul>
<h2 id="2016年12月18日更新"><a href="#2016年12月18日更新" class="headerlink" title="2016年12月18日更新"></a>2016年12月18日更新</h2><p>&emsp;本站目前使用的是通过nginx反代<code>embed.js</code>,并对相应代码实时进行替换，替换https来源于<a href="https://github.com/rainwsy/duoshuo-https">Github@rainwsy</a>。最终代码参见<a href="https://st.mcosx.cn/blog/js/embed.js">本站embed.js代码</a></p>
]]></content>
      <categories>
        <category>前端相关</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>多说</tag>
        <tag>https</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:Power of Four</title>
    <url>/post/leetcode-power-of-four.html</url>
    <content><![CDATA[<blockquote>
<p>Given an integer (signed 32 bits), write a function to check whether it is a power of 4.<br>Example:<br>Given num = 16, return true. Given num = 5, return false.<br>Follow up: Could you solve it without loops/recursion?</p>
</blockquote>
<h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><ul>
<li>循环</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfFour</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span> ((num % <span class="number">4</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            num /= <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfFour</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span> ((num &amp; <span class="number">0x3</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            num /= <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><ul>
<li>位运算。<br>要求:</li>
</ul>
<ol>
<li>最高位为1，其余全部为0.num&amp;(num-1)可以判断出左边第一位为1，后面全为零的数。</li>
<li>1的位置在奇数位。用0 != (num &amp; 0x55555555)判断。注意$1=4^0$。<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPowerOfFour</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num &gt; <span class="number">0</span> &amp;&amp; <span class="number">0</span> == (num &amp; (num<span class="number">-1</span>)) &amp;&amp; <span class="number">0</span> != (num &amp; <span class="number">0x55555555</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:Power of Three</title>
    <url>/post/leetcode-power-of-three.html</url>
    <content><![CDATA[<blockquote>
<p>Given an integer, write a function to determine if it is a power of three.<br>Follow up:<br>Could you do it without using any loop / recursion?</p>
</blockquote>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路:"></a>解题思路:</h2><ol>
<li>用数学公式$\frac{log_{10}n}{log_{10}3}$为整数</li>
<li>更多参考:<a href="http://blog.csdn.net/ebowtang/article/details/50485622">http://blog.csdn.net/ebowtang/article/details/50485622</a><h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPowerOfThree</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> dtmp = <span class="built_in">log10</span>(n) / <span class="built_in">log10</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(dtmp) - dtmp == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:Power of Two</title>
    <url>/post/leetcode-power-of-two.html</url>
    <content><![CDATA[<blockquote>
<p>Given an integer, write a function to determine if it is a power of two.</p>
</blockquote>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><p>1,最高位为1，其余都为0.位运算判断方法为num&amp;(num-1)<br>2.循环</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span>(n%<span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        n /= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> == n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; <span class="number">0</span> == (n &amp; (n<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>谷歌分析优化加载和防止拦截</title>
    <url>/post/google-analytics-measurement-protocol-optimization-and-prevent-interception.html</url>
    <content><![CDATA[<p>关键词： <strong>谷歌分析</strong> <strong>“Google Analytics”</strong> <strong>“Measurement Protocol”</strong> <strong>服务端使用谷歌分析</strong><br>总结一下这次折腾<br>开始看到了<a href="https://imququ.com/">imququ</a>网站的beacon.html，通过这种方式来统计访问流量，感到挺好玩的，然后就查了一些东西，发现统计网站统计客户访问原理也差不多是这样，通过加载一个js文件来搜集浏览者信息，然后发送到自家服务器。<br>这样有两个好处:</p>
<ul>
<li>一是加快网页加载,谷歌统计经常还是加载很慢，并且发送collect信息时也需要很长时间</li>
<li>二是可以防止<code>uBlock Origin</code>等拦截,现在浏览网页基本都会用这东西了。<br>其实现原理为客户端统计信息=&gt;网站服务器=&gt;谷歌服务器。将用户客户端信息发送到自己的服务器也可以在服务器上自行处理统计，之所以能中转是因为谷歌服务器有提供<a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/reference">api</a>，可以通过参数<code>uip</code>来传递IP地址，其他的没有提供类似方法的就不能用了。</li>
</ul>
<span id="more"></span>
<h2 id="折腾1"><a href="#折腾1" class="headerlink" title="折腾1"></a>折腾1</h2><p>开始我的想法也是向imququ这个网站一样，简单统计浏览者信息然后发送到服务器进行处理。<br>网页中附加以下js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params">e, n, o, f</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> t = e.<span class="property">screen</span>,</span><br><span class="line">    a = <span class="built_in">encodeURIComponent</span>,</span><br><span class="line">    r = [<span class="string">&quot;dt=&quot;</span> + <span class="title function_">a</span>(<span class="title function_">a</span>(<span class="variable language_">document</span>.<span class="property">title</span>)), <span class="string">&quot;dl=&quot;</span> + <span class="title function_">a</span>(f.<span class="property">href</span>), <span class="string">&quot;dr=&quot;</span> + <span class="title function_">a</span>(<span class="title function_">a</span>(<span class="variable language_">document</span>.<span class="property">referrer</span>)), <span class="string">&quot;ul=&quot;</span> + (o.<span class="property">language</span> || o.<span class="property">browserLanguage</span>).<span class="title function_">toLowerCase</span>(), <span class="string">&quot;sd=&quot;</span> + t.<span class="property">colorDepth</span> + <span class="string">&quot;-bit&quot;</span>, <span class="string">&quot;sr=&quot;</span> + t.<span class="property">width</span> + <span class="string">&quot;x&quot;</span> + t.<span class="property">height</span>, <span class="string">&quot;vp=&quot;</span> + e.<span class="property">innerWidth</span> + <span class="string">&quot;x&quot;</span> + e.<span class="property">innerHeight</span>, <span class="string">&quot;de=&quot;</span> + (n.<span class="property">characterSet</span> || n.<span class="property">charset</span>), <span class="string">&quot;ua=&quot;</span> + <span class="title function_">a</span>(o.<span class="property">userAgent</span>), <span class="string">&quot;_&quot;</span> + +<span class="keyword">new</span> <span class="title class_">Date</span>],</span><br><span class="line">    i = <span class="string">&quot;?&quot;</span> + r.<span class="title function_">join</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">    img = <span class="keyword">new</span> <span class="title class_">Image</span>, img.<span class="property">src</span> = <span class="string">&quot;/stat&quot;</span> + i;</span><br><span class="line">&#125;)(<span class="variable language_">window</span>, <span class="variable language_">document</span>, navigator, location);</span><br></pre></td></tr></table></figure>
<p>开始我是想用 <a href="https://blog.alphatr.com/google-analytics-on-server.html">服务端使用 Google Analytics</a>这篇文章写的来折腾，不过不怎么会thinkjs，玩了半天不怎么会就放弃了，发送信息谷歌服务器老是识别不了。</p>
<blockquote>
<p>另备注下post测试工具:谷歌插件ARC(<a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo?utm_source=chrome-app-launcher-info-dialog">Advanced REST client</a>)挺好用的，感觉比那个postman好用多了。另外也可以通过curl来测试。</p>
</blockquote>
<p>然后就用php作为服务端,初步就仅仅记录访问信息，没有转发谷歌服务器,nginx用try_files内部重定向下。<br>关键代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">getIp</span>();</span><br><span class="line"><span class="variable">$dt</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dt&#x27;</span>];</span><br><span class="line"><span class="variable">$dr</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dr&#x27;</span>];</span><br><span class="line"><span class="variable">$ul</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ul&#x27;</span>];</span><br><span class="line"><span class="variable">$sd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sd&#x27;</span>];</span><br><span class="line"><span class="variable">$sr</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sr&#x27;</span>];</span><br><span class="line"><span class="variable">$sv</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sv&#x27;</span>];</span><br><span class="line"><span class="variable">$ti</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ti&#x27;</span>];</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="variable">$ip</span>,<span class="variable">$dt</span>,<span class="variable">$dr</span>,<span class="variable">$ul</span>,<span class="variable">$sd</span>,<span class="variable">$sr</span>,<span class="variable">$sv</span>,<span class="variable">$ti</span>);</span><br><span class="line"><span class="variable">$arrjson</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$arr</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;arr.json&#x27;</span>, <span class="string">&quot;$&#123;arrjson&#125;\n&quot;</span>, FILE_APPEND|LOCK_EX)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/plain&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;false&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="折腾2"><a href="#折腾2" class="headerlink" title="折腾2"></a>折腾2</h2><p>网页中加如上统计代码<br>修改服务端php，增加发送功能。记得要将php设为非阻塞方式，避免等待时间过长。<br>关键代码如下:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$v</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$t</span> =<span class="string">&#x27;pageview&#x27;</span>;</span><br><span class="line"><span class="variable">$tid</span> = <span class="string">&#x27;UA-000000-0&#x27;</span>;</span><br><span class="line"><span class="variable">$z</span> = <span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$uip</span> = <span class="title function_ invoke__">getIp</span>();</span><br><span class="line"><span class="variable">$dt</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dt&#x27;</span>];</span><br><span class="line"><span class="variable">$dl</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dl&#x27;</span>];</span><br><span class="line"><span class="variable">$dr</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;dr&#x27;</span>];</span><br><span class="line"><span class="variable">$ul</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ul&#x27;</span>];</span><br><span class="line"><span class="variable">$sd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sd&#x27;</span>];</span><br><span class="line"><span class="variable">$sr</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sr&#x27;</span>];</span><br><span class="line"><span class="variable">$vp</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;vp&#x27;</span>];</span><br><span class="line"><span class="variable">$de</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;de&#x27;</span>];</span><br><span class="line"><span class="variable">$ua</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ua&#x27;</span>];</span><br><span class="line"><span class="variable">$cid</span> = <span class="title function_ invoke__">clientId</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">send_post2</span>(<span class="string">&#x27;https://www.google-analytics.com/collect&#x27;</span>, <span class="variable">$post_data</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientId</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$cid</span> = <span class="variable">$_COOKIE</span>[<span class="string">&quot;statcid&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$cid</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$cid</span> = <span class="title class_">Uuid</span>::<span class="title function_ invoke__">uuid4</span>()-&gt;<span class="title function_ invoke__">toString</span>();   <span class="comment">//i.e. 25769c6c-d34d-4bfe-ba98-e0ee856f3e7a</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsatisfiedDependencyException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="comment">//TODO err log</span></span><br><span class="line">            <span class="variable">$cid</span> = <span class="title function_ invoke__">gen_uuid</span>();</span><br><span class="line">            <span class="comment">//echo &#x27;Caught exception: &#x27; . $e-&gt;getMessage() . &quot;\n&quot;;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;statcid&quot;</span>, <span class="variable">$cid</span>, <span class="title function_ invoke__">time</span>() + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">365</span> * <span class="number">2</span>); <span class="comment">//两年有效期</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cid</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//cid</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen_uuid</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">sprintf</span>( <span class="string">&#x27;%04x%04x-%04x-%04x-%04x-%04x%04x%04x&#x27;</span>,</span><br><span class="line">        // <span class="number">32</span> bits <span class="keyword">for</span> <span class="string">&quot;time_low&quot;</span></span><br><span class="line">        <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> ), <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> ),</span><br><span class="line"> </span><br><span class="line">        // <span class="number">16</span> bits <span class="keyword">for</span> <span class="string">&quot;time_mid&quot;</span></span><br><span class="line">        <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> ),</span><br><span class="line"> </span><br><span class="line">        // <span class="number">16</span> bits <span class="keyword">for</span> <span class="string">&quot;time_hi_and_version&quot;</span>,</span><br><span class="line">        // four most significant bits holds version number <span class="number">4</span></span><br><span class="line">        <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0x0fff</span> ) | <span class="number">0x4000</span>,</span><br><span class="line"> </span><br><span class="line">        // <span class="number">16</span> bits, <span class="number">8</span> bits <span class="keyword">for</span> <span class="string">&quot;clk_seq_hi_res&quot;</span>,</span><br><span class="line">        // <span class="number">8</span> bits <span class="keyword">for</span> <span class="string">&quot;clk_seq_low&quot;</span>,</span><br><span class="line">        // two most significant bits holds zero <span class="keyword">and</span> one <span class="keyword">for</span> variant DCE1.<span class="number">1</span></span><br><span class="line">        <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0x3fff</span> ) | <span class="number">0x8000</span>,</span><br><span class="line"> </span><br><span class="line">        // <span class="number">48</span> bits <span class="keyword">for</span> <span class="string">&quot;node&quot;</span></span><br><span class="line">        <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> ), <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> ), <span class="title function_ invoke__">mt_rand</span>( <span class="number">0</span>, <span class="number">0xffff</span> )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_post</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$post_data</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$postdata</span> = <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$post_data</span>);</span><br><span class="line">    <span class="variable">$options</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;method&#x27;</span> =&gt; <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;header&#x27;</span> =&gt; <span class="string">&#x27;Content-type:application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span> =&gt; <span class="variable">$postdata</span>,</span><br><span class="line">            <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">15</span> * <span class="number">60</span> <span class="comment">// 超时时间（单位:s）</span></span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    <span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>(<span class="variable">$options</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>, <span class="literal">false</span>, <span class="variable">$context</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_post2</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$post_data</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$postData</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$post_data</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="variable">$postData</span> .= <span class="variable">$k</span> . <span class="string">&#x27;=&#x27;</span> . <span class="variable">$v</span> . <span class="string">&#x27;&amp;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$postData</span> = <span class="title function_ invoke__">rtrim</span>(<span class="variable">$postData</span>, <span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POST, <span class="title function_ invoke__">count</span>(<span class="variable">$postData</span>));</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$postData</span>);</span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$output</span> === <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error Number:&quot;</span>.<span class="title function_ invoke__">curl_errno</span>(<span class="variable">$ch</span>).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error String:&quot;</span>.<span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="折腾3"><a href="#折腾3" class="headerlink" title="折腾3"></a>折腾3</h2><p>在谷歌统计的后台看到好像以上方法都没有体现出会话时间等一些参数，想着还不如就用它的统计文件，然后中转一下。就打算直接修改<code>analytics.js</code>文件，将收集的信息发送到我的统计服务器。</p>
<blockquote>
<p>这里本来想着用nginx反向代理直接获取文件并替换其中信息的，用nginx的’ngx_http_sub_module’和<a href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module"><code>ngx_http_substitutions_filter_module</code></a>都试了不知道为什么不行(用多说的embed.js文件测试的)。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: image/png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$a</span> . <span class="string">&quot;&amp;uip=&quot;</span> . <span class="title function_ invoke__">getIp</span>();</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>, <span class="variable">$aArray</span>);</span><br><span class="line"><span class="variable">$log</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;receive&#x27;</span>, <span class="variable">$aArray</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">send_post2</span>(<span class="string">&#x27;https://www.google-analytics.com/collect&#x27;</span>, <span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_post2</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$post_data</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POST, <span class="title function_ invoke__">count</span>(<span class="variable">$post_data</span>));</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$post_data</span>);</span><br><span class="line">    <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$output</span> === <span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error Number:&quot;</span>.<span class="title function_ invoke__">curl_errno</span>(<span class="variable">$ch</span>).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error String:&quot;</span>.<span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>谷歌分析</tag>
      </tags>
  </entry>
  <entry>
    <title>linux下自动禁用ip脚本</title>
    <url>/post/ipblock-in-linux.html</url>
    <content><![CDATA[<blockquote>
<p>本文环境: centos7 lnmp iptables</p>
</blockquote>
<h2 id="nginx动态黑名单"><a href="#nginx动态黑名单" class="headerlink" title="nginx动态黑名单"></a>nginx动态黑名单</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>nginx配置中可以使用<code>allow/deny ip</code>来禁止允许ip.<br>可创建一个blockip.conf,将需要屏蔽的ip保存在里面,再引入。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">allow 200.200.200.200;</span><br><span class="line">deny all;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：</p>
<ul>
<li>全站屏蔽。将<code>include blockip.conf</code>放到http{ }语句块。</li>
<li>单独站点屏蔽。将<code>include blockip.conf</code>放到相应站点的server{ }语句块。</li>
</ul>
</blockquote>
<span id="more"></span>

<h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><p>这里给blockip.conf文件加上了时间，和最后一个是否有效的参数1或者0,以配合iptables解封相应ip,之后可以根据时间解封Ip（未实现）。<br>nginx日志文件格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">log_format nginxlog2 &#x27;$remote_addr $http_x_forwarded_for $remote_user [$time_local] &#x27;</span><br><span class="line">                    &#x27;&quot;$request&quot; $status $body_bytes_sent &#x27;</span><br><span class="line">                    &#x27;&quot;$http_host&quot; &quot;$http_referer&quot; &quot;$http_user_agent&quot;&#x27;;</span><br></pre></td></tr></table></figure>
<p>具体代码是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">tail -n2000 /data/wwwlogs/access_nginx.log | awk &#x27;&#123;print $1,$6,$9,$11,$13&#125;&#x27;|awk &#x27;&#123;if($1!=&quot;200.200.200.200&quot; &amp;&amp; $1!=&quot;222.222.222.222&quot; &amp;&amp; ($2==&quot;\&quot;CONNECT&quot;||$5==&quot;\&quot;-\&quot;&quot;||$4!=&quot;\&quot;200.200.200.200\&quot;&quot;)) print $1&#125;&#x27;|sort|uniq -c|sort -rn |awk &#x27;&#123;if($1&gt;1) print &quot;deny &quot;$2 &quot;; # &quot; strftime(&quot;%Y%m%d%H%M%S&quot;,systime()) &quot; 1&quot; &#125;&#x27; &gt;&gt; /usr/local/nginx/conf/blockip.conf</span><br><span class="line"> </span><br><span class="line"># 去掉重复ip</span><br><span class="line">sort -t&#x27; &#x27; -k2,2 -k4,4 -k5,5 /usr/local/nginx/conf/blockip.conf | sort -t&#x27; &#x27; -k2,2 -u |awk &#x27;&#123;print $1,$2,$3,$4,$5&#125;&#x27;&gt; /usr/local/nginx/conf/blockiptmp.conf #这里直接写入blockip.conf会变成0kb，所以用个临时文件</span><br><span class="line"></span><br><span class="line"># 重启nginx</span><br><span class="line">#/usr/bin/systemctl reload nginx</span><br><span class="line">service nginx reload</span><br></pre></td></tr></table></figure>
<p>然后添加到定时任务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">27 */6 * * * root /usr/bin/sh /opt/shell/blockip.sh #service crond reload</span><br></pre></td></tr></table></figure>

<h2 id="通过iptables动态禁用ip"><a href="#通过iptables动态禁用ip" class="headerlink" title="通过iptables动态禁用ip"></a>通过iptables动态禁用ip</h2><p>读取blockip.conf文件（ip唯一）然后根据最后一个参数为1或者0进行增加或者取消限制。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tail -n2000 /usr/local/nginx/conf/blockip.conf | awk &#x27;&#123;split($2,a,&quot;;&quot;);print a[1],$4,$5&#125;&#x27; | awk &#x27;&#123;if($3==&quot;1&quot;) system(&quot;iptables -D INPUT -s &quot;$1&quot; -j DROP;iptables -I INPUT -s &quot;$1&quot; -j DROP&quot;)&#125;&#x27;</span><br><span class="line">tail -n2000 /usr/local/nginx/conf/blockip.conf | awk &#x27;&#123;split($2,a,&quot;;&quot;);print a[1],$4,$5&#125;&#x27; | awk &#x27;&#123;if($3==&quot;0&quot;) system(&quot;iptables -D INPUT -s &quot;$1&quot; -j DROP&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>注意：通过iptables也可以使用以下语句，前者只禁用80端口：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">iptables -I INPUT -p tcp --dport 80 -s 180.160.220.109 -j DROP</span><br><span class="line">iptables -I INPUT -s ***.***.***.*** -j DROP</span><br></pre></td></tr></table></figure>

<h2 id="总的脚本"><a href="#总的脚本" class="headerlink" title="总的脚本"></a>总的脚本</h2><p>文件名:blockip.sh</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">tail -n2000 /data/wwwlogs/access_nginx.log | awk &#x27;&#123;print $1,$6,$9,$11,$13&#125;&#x27;|awk &#x27;&#123;if($1!=&quot;200.200.200.200&quot; &amp;&amp; $1!=&quot;222.222.222.222&quot; &amp;&amp; ($2==&quot;\&quot;CONNECT&quot;||$5==&quot;\&quot;-\&quot;&quot;||$4!=&quot;\&quot;200.200.200.200\&quot;&quot;)) print $1&#125;&#x27;|sort|uniq -c|sort -rn |awk &#x27;&#123;if($1&gt;1) print &quot;deny &quot;$2 &quot;; # &quot; strftime(&quot;%Y%m%d%H%M%S&quot;,systime()) &quot; 1&quot; &#125;&#x27; &gt;&gt; /usr/local/nginx/conf/blockip.conf</span><br><span class="line">sort -t&#x27; &#x27; -k2,2 -k4,4 -k5,5 /usr/local/nginx/conf/blockip.conf | sort -t&#x27; &#x27; -k2,2 -u |awk &#x27;&#123;print $1,$2,$3,$4,$5&#125;&#x27;&gt; /usr/local/nginx/conf/blockiptmp.conf</span><br><span class="line">rm -f /usr/local/nginx/conf/blockip.conf</span><br><span class="line">mv /usr/local/nginx/conf/blockiptmp.conf /usr/local/nginx/conf/blockip.conf</span><br><span class="line">service nginx reload</span><br><span class="line"> </span><br><span class="line">tail -n2000 /usr/local/nginx/conf/blockip.conf | awk &#x27;&#123;split($2,a,&quot;;&quot;);print a[1],$4,$5&#125;&#x27; | awk &#x27;&#123;if($3==&quot;1&quot;) system(&quot;iptables -D INPUT -s &quot;$1&quot; -j DROP;iptables -I INPUT -s &quot;$1&quot; -j DROP&quot;)&#125;&#x27;</span><br><span class="line">tail -n2000 /usr/local/nginx/conf/blockip.conf | awk &#x27;&#123;split($2,a,&quot;;&quot;);print a[1],$4,$5&#125;&#x27; | awk &#x27;&#123;if($3==&quot;0&quot;) system(&quot;iptables -D INPUT -s &quot;$1&quot; -j DROP&quot;)&#125;&#x27;</span><br><span class="line">service iptables save</span><br><span class="line">service iptables reload</span><br></pre></td></tr></table></figure>
<p>定时任务crontab -e</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">27 */7 * * * /root/projects/mcosx/blockip.sh &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>iptables</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:8. String to Integer (atoi)</title>
    <url>/post/leetcode-string-to-integer-atoi.html</url>
    <content><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><a href="https://leetcode.com/problems/string-to-integer-atoi/">https://leetcode.com/problems/string-to-integer-atoi/</a></p>
<blockquote>
<p>Implement atoi to convert a string to an integer.<br>Hint: Carefully consider all possible input cases. If you want a challenge, please do not see below and ask yourself what are the possible input cases.<br>Notes: It is intended for this problem to be specified vaguely (ie, no given input specs). You are responsible to gather all the input requirements up front.<br>Update (2015-02-10):<br>The signature of the C++ function had been updated. If you still see your function signature accepts a const char * argument, please click the reload button  to reset your code definition.<br>spoilers alert… click to show requirements for atoi.<br>Requirements for atoi:<br>The function first discards as many whitespace characters as necessary until the first non-whitespace character is found. Then, starting from this character, takes an optional initial plus or minus sign followed by as many numerical digits as possible, and interprets them as a numerical value.<br>The string can contain additional characters after those that form the integral number, which are ignored and have no effect on the behavior of this function.<br>If the first sequence of non-whitespace characters in str is not a valid integral number, or if no such sequence exists because either str is empty or it contains only whitespace characters, no conversion is performed.<br>If no valid conversion could be performed, a zero value is returned. If the correct value is out of the range of representable values, INT_MAX (2147483647) or INT_MIN (-2147483648) is returned.</p>
</blockquote>
<span id="more"></span>
<h2 id="需要注意的"><a href="#需要注意的" class="headerlink" title="需要注意的"></a>需要注意的</h2><ul>
<li>去除之前的空格</li>
<li>+-用else</li>
<li>用long long,long在32位下最大值和int一样大</li>
<li>中间出现了非数字则停止并返回前面的数字</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">myAtoi</span><span class="params">(string str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (str[index] == <span class="string">&#x27; &#x27;</span>) ++index;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (str[index] == <span class="string">&#x27;+&#x27;</span> || str[index] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;+&#x27;</span> == str[index] ? flag = <span class="literal">true</span> : flag = <span class="literal">false</span>;</span><br><span class="line">            ++index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> size = str.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; size)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (str[index] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; str[index] &lt;= <span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sum = sum * <span class="number">10</span> + str[index] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span> (flag &amp;&amp; sum &gt; INT_MAX) <span class="keyword">return</span> INT_MAX;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!flag &amp;&amp; sum * (<span class="number">-1</span>) &lt; INT_MIN) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ++index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum * (flag ? <span class="number">1</span> : <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:9. Palindrome Number</title>
    <url>/post/leetcode-9-palindrome-number.html</url>
    <content><![CDATA[<h2 id="9-Palindrome-Number"><a href="#9-Palindrome-Number" class="headerlink" title="9. Palindrome Number"></a>9. Palindrome Number</h2><p>Determine whether an integer is a palindrome. Do this without extra space.</p>
<p>Some hints:<br>Could negative integers be palindromes? (ie, -1)</p>
<p>If you are thinking of converting the integer to string, note the restriction of using extra space.</p>
<p>You could also try reversing an integer. However, if you have solved the problem “Reverse Integer”, you know that the reversed integer might overflow. How would you handle such case?</p>
<p>There is a more generic way of solving this problem.</p>
<span id="more"></span>

<h2 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h2><ol>
<li>不能为负</li>
<li>最好不要转为string来判断</li>
<li>反转之后要注意int的容量</li>
<li>如果反转时overflow则一定不是回文</li>
</ol>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><h3 id="my"><a href="#my" class="headerlink" title="my"></a>my</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>, xori = x;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> rev = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            i = x % <span class="number">10</span>;</span><br><span class="line">            rev = (rev * <span class="number">10</span>) + i;</span><br><span class="line">            x /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rev == xori;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="喜刷刷"><a href="#喜刷刷" class="headerlink" title="@喜刷刷"></a><a href="http://bangbingsyb.blogspot.com/2014/11/leetcode-palindrome-number.html">@喜刷刷</a></h3><p>通过overflow判断，可以将rev类型降低为int</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">x</span>&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>, y=x;</span><br><span class="line">        <span class="keyword">while</span>(y) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(res)&gt;(INT_MAX/<span class="number">10</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            res = res * <span class="number">10</span> + y % <span class="number">10</span>;</span><br><span class="line">            y /= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res==x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="比较最高位和最低位"><a href="#比较最高位和最低位" class="headerlink" title="比较最高位和最低位"></a>比较最高位和最低位</h3><p>比较最高位与最低位的数字：如果不同则不是回文，如果相同，则去掉最高和最低位，继续判断。直到所有位数字都被去掉，则一定是回文。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> y = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(x/y&gt;=<span class="number">10</span>)</span><br><span class="line">            y *= <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(x/y != x%<span class="number">10</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            x = (x % y)/<span class="number">10</span>;</span><br><span class="line">            y /= <span class="number">100</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:13. Roman to Integer</title>
    <url>/post/leetcode-13-roman-to-integer.html</url>
    <content><![CDATA[<h2 id="13-Roman-to-Integer"><a href="#13-Roman-to-Integer" class="headerlink" title="13. Roman to Integer"></a>13. Roman to Integer</h2><p>Given a roman numeral, convert it to an integer.</p>
<p>Input is guaranteed to be within the range from 1 to 3999.</p>
<h2 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h2><ol>
<li><p>罗马数字字母<br>I = 1，V = 5，X = 10，L = 50，C = 100，D = 500，M = 1000</p>
</li>
<li><p>计数方式(<a href="https://zh.wikipedia.org/wiki/%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97">维基百科</a>)  </p>
<ul>
<li>重复数次：一个罗马数字重复几次，就表示这个数的几倍。</li>
<li>右加左减：<ul>
<li>在较大的罗马数字的右边记上较小的罗马数字，表示大数字加小数字。</li>
<li>在较大的罗马数字的左边记上较小的罗马数字，表示大数字减小数字。</li>
<li>左减的数字有限制，仅限于I、X、C。比如45不可以写成VL，只能是XLV</li>
<li>但是，左减时不可跨越一个位值。比如，99不可以用IC（ {\displaystyle 100-1} 100-1）表示，而是用XCIX（ {\displaystyle [100-10]+[10-1]} [100-10]+[10-1]     示。（等同于阿拉伯数字每位数字分别表示。）</li>
<li>左减数字必须为一位，比如8写成VIII，而非IIX。</li>
<li>右加数字不可连续超过三位，比如14写成XIV，而非XIIII。（见下方“数码限制”一项。）</li>
</ul>
</li>
<li>加线乘千：<ul>
<li>在罗马数字的上方加上一条横线或者加上下标的Ⅿ，表示将这个数乘以1000，即是原数的1000倍。</li>
<li>同理，如果上方有两条横线，即是原数的1000000（ {\displaystyle 1000^{2}} 1000^2）倍。</li>
</ul>
</li>
<li>数码限制：<ul>
<li>同一数码最多只能连续出现三次，如40不可表示为XXXX，而要表示为XL。</li>
<li>例外：由于IV是古罗马神话主神朱庇特（即IVPITER，古罗马字母里没有J和U）的首字，因此有时用IIII代替IV。</li>
</ul>
</li>
</ul>
</li>
</ol>
<span id="more"></span>

<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>&emsp;&emsp;由于仅从罗马数字转换为阿拉伯数字，给出的罗马数字肯定是正确的，所以主要规则是(1)左小于右则减,例如IV=5-1;(2)其他情况相加,例如III=3;VI=6;</p>
<h2 id="CPP代码"><a href="#CPP代码" class="headerlink" title="CPP代码"></a>CPP代码</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">romanToInt</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; m;</span><br><span class="line">        m[<span class="string">&#x27;I&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">        m[<span class="string">&#x27;V&#x27;</span>] = <span class="number">5</span>;</span><br><span class="line">        m[<span class="string">&#x27;X&#x27;</span>] = <span class="number">10</span>;</span><br><span class="line">        m[<span class="string">&#x27;L&#x27;</span>] = <span class="number">50</span>;</span><br><span class="line">        m[<span class="string">&#x27;C&#x27;</span>] = <span class="number">100</span>;</span><br><span class="line">        m[<span class="string">&#x27;D&#x27;</span>] = <span class="number">500</span>;</span><br><span class="line">        m[<span class="string">&#x27;M&#x27;</span>] = <span class="number">1000</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> rst = m[s[s.<span class="built_in">size</span>() - <span class="number">1</span>]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>() - <span class="number">1</span>; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m[s[i]] &lt; m[s[i + <span class="number">1</span>]])</span><br><span class="line">                rst -= m[s[i]];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                rst += m[s[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rst;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 反过来转换可参考：<a href="http://www.cnblogs.com/TenosDoIt/p/3793503.html">http://www.cnblogs.com/TenosDoIt/p/3793503.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode: 14. Longest Common Prefix</title>
    <url>/post/leetcode-14-longest-common-prefix.html</url>
    <content><![CDATA[<blockquote>
<p> <a href="https://leetcode.com/problems/longest-common-prefix/">https://leetcode.com/problems/longest-common-prefix/</a></p>
</blockquote>
<h2 id="14-Longest-Common-Prefix"><a href="#14-Longest-Common-Prefix" class="headerlink" title="14. Longest Common Prefix"></a>14. Longest Common Prefix</h2><p>Write a function to find the longest common prefix string amongst an array of strings.</p>
<h2 id="解题要点"><a href="#解题要点" class="headerlink" title="解题要点"></a>解题要点</h2><ol>
<li>注意题中要求的是前缀</li>
</ol>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">longestCommonPrefix</span><span class="params">(vector&lt;string&gt;&amp; strs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strs.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="built_in">string</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; strs[<span class="number">0</span>].<span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; strs.<span class="built_in">size</span>(); ++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (strs[j][i] != strs[<span class="number">0</span>][i])</span><br><span class="line">                    <span class="keyword">return</span> strs[<span class="number">0</span>].<span class="built_in">substr</span>(<span class="number">0</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strs[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode: Remove Nth Node From End of List</title>
    <url>/post/leetcode-remove-nth-node-from-end-of-list.html</url>
    <content><![CDATA[<blockquote>
<p><a href="https://leetcode.com/problems/remove-nth-node-from-end-of-list/">https://leetcode.com/problems/remove-nth-node-from-end-of-list/</a></p>
</blockquote>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>&emsp;Given a linked list, remove the n<sup>th</sup> node from the end of list and return its head.</p>
<p>For example,</p>
<p>   Given linked list: 1-&gt;2-&gt;3-&gt;4-&gt;5, and n = 2.</p>
<p>   After removing the second node from the end, the linked list becomes 1-&gt;2-&gt;3-&gt;5.<br>Note:<br>Given n will always be valid.<br>Try to do this in one pass.</p>
<span id="more"></span>

<h2 id="解题要点"><a href="#解题要点" class="headerlink" title="解题要点"></a>解题要点</h2><ol>
<li>设两个指针，间隔n，后面的指针p2-&gt;next为NULL时，前面的指针p1-&gt;next就是要删除的节点。</li>
<li>考虑到需要删除头节点的情况(传入[1],1或[1,2],2)，需要给其加个临时头，并且在用完后delete这个临时节点。</li>
</ol>
<h2 id="CODE"><a href="#CODE" class="headerlink" title="CODE"></a>CODE</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Definition for singly-linked list.</span></span><br><span class="line"><span class="comment">* struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment">* &#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">removeNthFromEnd</span><span class="params">(ListNode* head, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        ListNode *ph = <span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        ph-&gt;next = head;</span><br><span class="line">        ListNode *p1, *p2;</span><br><span class="line">        p1 = p2 = ph;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) p2 = p2-&gt;next;</span><br><span class="line">        <span class="keyword">for</span> (; p2 != <span class="literal">nullptr</span>; p1 = p1-&gt;next, p2 = p2-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (p2-&gt;next == <span class="literal">nullptr</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ListNode *tmp = p1-&gt;next;</span><br><span class="line">                p1-&gt;next = p1-&gt;next-&gt;next;</span><br><span class="line">                <span class="keyword">delete</span> tmp;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        p1 = ph;</span><br><span class="line">        ph = ph-&gt;next;</span><br><span class="line">        <span class="keyword">delete</span> p1;</span><br><span class="line">        <span class="keyword">return</span> ph;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>LeetCode:Two Sum</title>
    <url>/post/leetcode-two-sum.html</url>
    <content><![CDATA[<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    vector&lt;int&gt; twoSum(vector&lt;int&gt;&amp; nums, int target) &#123;</span><br><span class="line">        vector&lt;int&gt; rst;</span><br><span class="line">        for(int i = 0, j; i &lt; nums.size(); ++i) &#123;</span><br><span class="line">            for(j = i + 1; j &lt; nums.size() &amp;&amp; nums[j] != (target - nums[i]); ++j);</span><br><span class="line">            if(j != nums.size()) &#123;</span><br><span class="line">                rst.push_back(i);</span><br><span class="line">                rst.push_back(j);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return rst;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    Solution sol;</span><br><span class="line">    vector&lt;int&gt; vec = &#123;3, 2, 4&#125;;</span><br><span class="line">    vector&lt;int&gt; rstt = rstt = sol.twoSum(vec, 6);</span><br><span class="line">    for(unsigned i=0;i&lt;rstt.size();++i) &#123;</span><br><span class="line">        cout &lt;&lt; rstt[i] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; &quot;dadf&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>R笔记-神经网络</title>
    <url>/post/r-neural-network.html</url>
    <content><![CDATA[<h2 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h2><p>全称人工神经网络,即Artificial Neural Networks,简记为ANN.它是由大量类似于生物神经元的处理单元相互连接而成的非线性复杂网络系统.(<a href="https://en.wikipedia.org/wiki/Artificial_neural_network">维基百科英文解释</a>,<a href="https://zh.wikipedia.org/wiki/%E4%BA%BA%E5%B7%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C">维基百科中文解释</a>)<br>R中神经网络包有AMORE,NNET,Neuralnet,RSNNS.本文使用neuralnet.</p>
<h2 id="neuralnet"><a href="#neuralnet" class="headerlink" title="neuralnet"></a>neuralnet</h2><p><a href="https://github.com/cran/neuralnet">https://github.com/cran/neuralnet</a></p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">require(neuralnet)  # for neuralnet()</span><br><span class="line"># require(nnet) # for class.ind() 将分裂转为数值,比如1,0</span><br><span class="line">require(caret) # for train() ,可用来寻求最佳隐层组合,不过运行时间较长.</span><br></pre></td></tr></table></figure>
<p>其中,caret帮助文档见<a href="https://topepo.github.io/caret/available-models.html">https://topepo.github.io/caret/available-models.html</a>.</p>
<h2 id="R-code"><a href="#R-code" class="headerlink" title="R code"></a>R code</h2><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">normalize <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="built_in">return</span> <span class="punctuation">(</span><span class="punctuation">(</span>x<span class="operator">-</span><span class="built_in">min</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span><span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="operator">-</span><span class="built_in">min</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">neufun_f <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  datatr <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;/home/lm/projects/RProjects/train_f.csv&quot;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  datate <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;/home/lm/projects/RProjects/test_f.csv&quot;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  datatr.target <span class="operator">&lt;-</span> datatr<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">  datate.target <span class="operator">&lt;-</span> datate<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">  datatr<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>datatr<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">==</span><span class="string">&#x27;Y&#x27;</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span> <span class="comment"># 将分类Y,N转为1,0</span></span><br><span class="line">  datate<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>datate<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">==</span><span class="string">&#x27;Y&#x27;</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">  datatr<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">96</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span>datatr<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">96</span><span class="punctuation">]</span><span class="punctuation">,</span>normalize<span class="punctuation">)</span> <span class="comment"># 标准化</span></span><br><span class="line">  datate<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">96</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span>datate<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">96</span><span class="punctuation">]</span><span class="punctuation">,</span>normalize<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  library<span class="punctuation">(</span>neuralnet<span class="punctuation">)</span></span><br><span class="line">  set.seed<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">)</span></span><br><span class="line">  formula <span class="operator">&lt;-</span> as.formula<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;V1 ~&quot;</span><span class="punctuation">,</span>paste<span class="punctuation">(</span>setdiff<span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>datatr<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;V1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>collapse <span class="operator">=</span> <span class="string">&quot;+&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment">#datatr &lt;- as.matrix(datatr)</span></span><br><span class="line">  <span class="comment">#datate &lt;- as.matrix(datate)</span></span><br><span class="line">  neu.model <span class="operator">&lt;-</span> neuralnet<span class="punctuation">(</span>formula<span class="operator">=</span>formula<span class="punctuation">,</span>data<span class="operator">=</span>datatr<span class="punctuation">,</span>threshold<span class="operator">=</span><span class="number">1e-8</span><span class="punctuation">,</span>hidden<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">80</span><span class="punctuation">,</span><span class="number">50</span><span class="punctuation">,</span><span class="number">25</span><span class="punctuation">,</span><span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                         stepmax<span class="operator">=</span><span class="number">1e+08</span><span class="punctuation">,</span>err.fct<span class="operator">=</span><span class="string">&quot;ce&quot;</span><span class="punctuation">,</span>linear.output<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span>lifesign <span class="operator">=</span> <span class="string">&quot;full&quot;</span><span class="punctuation">,</span></span><br><span class="line">                         algorithm <span class="operator">=</span> <span class="string">&#x27;rprop+&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># plot(neu.model)</span></span><br><span class="line">  neu.com <span class="operator">&lt;-</span> neuralnet<span class="operator">::</span>compute<span class="punctuation">(</span>neu.model<span class="punctuation">,</span>datate<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">:</span><span class="number">96</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  neu.predicted <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>neu.com<span class="operator">$</span>net.result<span class="operator">&gt;</span><span class="number">0.5</span><span class="punctuation">,</span><span class="string">&quot;Y&quot;</span><span class="punctuation">,</span><span class="string">&quot;N&quot;</span><span class="punctuation">)</span> <span class="comment"># 将数值转为标签</span></span><br><span class="line">  <span class="comment"># datate[,1] &lt;- ifelse(datate[,1]==&quot;1&quot;,&quot;Y&quot;,&quot;N&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#neu.table &lt;- table(datate.target,neu.predicted,dnn=c(&quot;真实值&quot;,&quot;预测值&quot;))</span></span><br><span class="line">  neu.table <span class="operator">&lt;-</span> table<span class="punctuation">(</span>datate.target<span class="punctuation">,</span>neu.predicted<span class="punctuation">,</span>dnn<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;True values&quot;</span><span class="punctuation">,</span><span class="string">&quot;Predicted values&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span>caret<span class="punctuation">)</span></span><br><span class="line">  neu.cfMatrix <span class="operator">&lt;-</span> caret<span class="operator">::</span>confusionMatrix<span class="punctuation">(</span>neu.table<span class="punctuation">,</span>positive<span class="operator">=</span><span class="string">&quot;Y&quot;</span><span class="punctuation">)</span></span><br><span class="line">  neu.cfMatrix</span><br><span class="line"></span><br><span class="line">  neu.TP <span class="operator">&lt;-</span> neu.table<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">  neu.FN <span class="operator">&lt;-</span> neu.table<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">  neu.FP <span class="operator">&lt;-</span> neu.table<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">  neu.TN <span class="operator">&lt;-</span> neu.table<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">  e.ACC <span class="operator">&lt;-</span> <span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.TN<span class="punctuation">)</span><span class="operator">/</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.TN<span class="operator">+</span>neu.FP<span class="operator">+</span>neu.FN<span class="punctuation">)</span></span><br><span class="line">  e.SN <span class="operator">&lt;-</span> neu.TP<span class="operator">/</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.FN<span class="punctuation">)</span></span><br><span class="line">  e.SP <span class="operator">&lt;-</span> neu.TN<span class="operator">/</span><span class="punctuation">(</span>neu.TN<span class="operator">+</span>neu.FP<span class="punctuation">)</span></span><br><span class="line">  e.PPV <span class="operator">&lt;-</span> neu.TP<span class="operator">/</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.FP<span class="punctuation">)</span></span><br><span class="line">  e.FRP <span class="operator">&lt;-</span> neu.FP<span class="operator">/</span><span class="punctuation">(</span>neu.FP<span class="operator">+</span>neu.TN<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># Kappa</span></span><br><span class="line">  pe <span class="operator">&lt;-</span> <span class="punctuation">(</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.FN<span class="punctuation">)</span><span class="operator">*</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.FP<span class="punctuation">)</span><span class="operator">+</span><span class="punctuation">(</span>neu.FP<span class="operator">+</span>neu.TN<span class="punctuation">)</span><span class="operator">*</span><span class="punctuation">(</span>neu.FN<span class="operator">+</span>neu.TN<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span><span class="punctuation">(</span>neu.TP<span class="operator">+</span>neu.FN<span class="operator">+</span>neu.FP<span class="operator">+</span>neu.TN<span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span></span><br><span class="line">  e.Kappa <span class="operator">&lt;-</span> <span class="punctuation">(</span>e.ACC<span class="operator">-</span>pe<span class="punctuation">)</span><span class="operator">/</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">-</span>pe<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  library<span class="punctuation">(</span>ROCR<span class="punctuation">)</span></span><br><span class="line">  neu.pred <span class="operator">&lt;-</span> ROCR<span class="operator">::</span>prediction<span class="punctuation">(</span>predictions <span class="operator">=</span> neu.com<span class="operator">$</span>net.result<span class="punctuation">,</span> datate<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  neu.perf <span class="operator">&lt;-</span> ROCR<span class="operator">::</span>performance<span class="punctuation">(</span>neu.pred<span class="punctuation">,</span> measure<span class="operator">=</span><span class="string">&quot;tpr&quot;</span><span class="punctuation">,</span>x.measure <span class="operator">=</span> <span class="string">&quot;fpr&quot;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># plot(neu.perf,col=&quot;blue&quot;,add=T)</span></span><br><span class="line">  <span class="comment">#plot(neu.perf,col=&quot;blue&quot;,xlab=&quot;假正率&quot;,ylab=&quot;真正率&quot;,main=&quot;ROC曲线&quot;)</span></span><br><span class="line">  plot<span class="punctuation">(</span>neu.perf<span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span>main<span class="operator">=</span><span class="string">&quot;ROC Plot&quot;</span><span class="punctuation">,</span>xlab<span class="operator">=</span><span class="string">&quot;False Positive Rate(1-Specificity)&quot;</span><span class="punctuation">,</span>ylab<span class="operator">=</span><span class="string">&quot;True Positive Rate(Sensitivity)&quot;</span><span class="punctuation">)</span></span><br><span class="line">  neu.auc <span class="operator">&lt;-</span> ROCR<span class="operator">::</span>performance<span class="punctuation">(</span>neu.pred<span class="punctuation">,</span><span class="string">&quot;auc&quot;</span><span class="punctuation">)</span><span class="operator">@</span>y.values<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">  neu.auc</span><br><span class="line">  legend<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>legend<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;AUC=&quot;</span><span class="punctuation">,</span>neu.auc<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>xjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>yjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://rpubs.com/skydome20/R-Note8-ANN">R笔记-类神经网络(neuralnet)</a></li>
<li><a href="http://www.jianshu.com/p/824780e39401">R语言中神经网络算法的使用</a></li>
</ul>
]]></content>
      <categories>
        <category>cs</category>
      </categories>
      <tags>
        <tag>r</tag>
      </tags>
  </entry>
  <entry>
    <title>智能指针</title>
    <url>/post/smart-pointer.html</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>c++里面的四个智能指针: auto_ptr, shared_ptr, weak_ptr, unique_ptr 其中后三个是c++11支持，并且第一个已经被c++11弃用。都包含在头文件 <code>#include &lt;memory&gt;</code> 中.</p>
<ol>
<li>std::auto_ptr<br>其实现不是基于引用计数的，而是独占的，一个指针在同一时刻只能被一个对象拥有。因此，在出现复制操作时之前的对象内容会被销毁。<br>因此，使用时需注意：</li>
</ol>
<ul>
<li>尽量不要复制，如果赋值了则不能再使用之前的对象。</li>
<li>不要当成参数传递</li>
<li>不能放在 vector 等容器中。</li>
</ul>
<ol start="2">
<li><p>shared_ptr<br>允许多个指针指向同一个对象</p>
</li>
<li><p>unique_ptr<br>独占所指向的对象</p>
</li>
<li><p>weak_ptr<br>它是一种弱引用,指向shared_ptr所管理的对象.</p>
</li>
</ol>
<h2 id="智能指针的模拟实现"><a href="#智能指针的模拟实现" class="headerlink" title="智能指针的模拟实现"></a>智能指针的模拟实现</h2><ol>
<li><p>auto_ptr实现</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AutoPtr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AutoPtr</span>(T* ptr) :_ptr(ptr) &#123;&#125;</span><br><span class="line">    ~<span class="built_in">AutoPtr</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (_ptr) &#123;</span><br><span class="line">            <span class="keyword">delete</span> _ptr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">AutoPtr</span>(AutoPtr&lt;T&gt;&amp; ap) :_ptr(ap._ptr) &#123;</span><br><span class="line">        ap._ptr = <span class="literal">NULL</span>;<span class="comment">//管理权转移，原来ap的_ptr置空</span></span><br><span class="line">    &#125;</span><br><span class="line">    AutoPtr&lt;T&gt;&amp; <span class="keyword">operator</span>=(AutoPtr&lt;T&gt;&amp; ap) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;ap) &#123;</span><br><span class="line">            <span class="keyword">delete</span> _ptr;</span><br><span class="line">            _ptr = ap._ptr;</span><br><span class="line">            ap._ptr = <span class="literal">NULL</span>;<span class="comment">//管理权转移，原来ap的_ptr置空</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() &#123;</span><br><span class="line">        <span class="keyword">return</span> *_ptr;</span><br><span class="line">    &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() &#123;</span><br><span class="line">        <span class="keyword">return</span> _ptr;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* _ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>shared_ptr实现</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">U_Ptr</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">SmartPtr</span>&lt;T&gt;;</span><br><span class="line">    <span class="built_in">U_Ptr</span>(T *ptr) : <span class="built_in">p</span>(ptr), <span class="built_in">count</span>(<span class="number">1</span>) &#123; &#125;</span><br><span class="line">    ~<span class="built_in">U_Ptr</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count;</span><br><span class="line">    T *p;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SmartPtr</span>(T *ptr) : <span class="built_in">rp</span>(<span class="keyword">new</span> <span class="built_in">U_Ptr</span>&lt;T&gt;(ptr)) &#123; &#125;</span><br><span class="line">    <span class="built_in">SmartPtr</span>(<span class="type">const</span> SmartPtr&lt;T&gt; &amp;sp) : <span class="built_in">rp</span>(sp.rp) &#123;</span><br><span class="line">        ++rp-&gt;count;</span><br><span class="line">    &#125;</span><br><span class="line">    SmartPtr &amp;<span class="keyword">operator</span>=(<span class="type">const</span> SmartPtr&lt;T&gt; &amp;rhs) &#123;</span><br><span class="line">        ++rhs.rp-&gt;count;</span><br><span class="line">        <span class="keyword">if</span>(--rp-&gt;count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> rp;</span><br><span class="line">        &#125;</span><br><span class="line">        rp = rhs.rp;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    T &amp;<span class="keyword">operator</span>*() &#123;</span><br><span class="line">        <span class="keyword">return</span> *(rp-&gt;p);</span><br><span class="line">    &#125;</span><br><span class="line">    T *<span class="keyword">operator</span>-&gt;() &#123;</span><br><span class="line">        <span class="keyword">return</span> rp-&gt;p;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">SmartPtr</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span>(--rp-&gt;count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> rp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; rp-&gt;count &lt;&lt; endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    U_Ptr&lt;T&gt; *rp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>cs</category>
      </categories>
      <tags>
        <tag>c++</tag>
      </tags>
  </entry>
  <entry>
    <title>计数排序、基数排序、桶排序</title>
    <url>/post/countingsort-radixsorting-bucketsort.html</url>
    <content><![CDATA[<p>基于比较的排序算法的时间复杂度的下界一般是O(nlog(n))。而非基于比较的算法，如计数排序、基数排序和桶排序是可以突破这个下界的，但是限制也很多。</p>
<h2 id="计数排序-Counting-sort"><a href="#计数排序-Counting-sort" class="headerlink" title="计数排序(Counting sort)"></a>计数排序(Counting sort)</h2><ul>
<li><p>思路：计数排序(Counting sort)是一种<strong>稳定</strong>的排序算法。计数排序是最简单的特例，由于用来计数的数组C的长度取决于待排序数组中数据的范围（等于待排序数组的最大值与最小值的差加上1），这使得计数排序对于数据范围很大的数组，需要大量时间和内存，适用性不高。其基本思想是对每一个输入元素x，确定小于x的元素个数，利用这一信息，就可以直接把x放到它在输出数组中的位置上。<strong>计数排序经常会被用作计数排序算法的一个子过程</strong>。当输入的元素是n个0到k之间的整数时，它的时间复杂度是O(n+k)。</p>
</li>
<li><p>步骤：</p>
<ol>
<li>找出待排序数组A[0..n)中的最大和最小的元素</li>
<li>申请大小为n(由最大值-最小值+1得到的范围)的数组B和大小为k(待排序数组A的元素个数)的数组C[0..k]</li>
<li>统计数组中每个值的出现次数，存入到数组B的[0,n)范围中</li>
<li>在[0,n)范围中对所有的计数累加(每一项值+=前一项值)</li>
<li>反向遍历待排序数组A,将A中元素在B中对应的计数减1(防止重复)，然后A[i]存入此值作为下标的C数组中</li>
</ol>
</li>
</ul>
<span id="more"></span>

<ul>
<li>代码：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">countingSort</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> min = a[<span class="number">0</span>], max = a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; min) min = a[i];</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; max) max = a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原始数组值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;原始数组值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = max - min + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> *b = <span class="keyword">new</span> <span class="type">int</span>[n]; <span class="comment">//辅助数组</span></span><br><span class="line">    <span class="type">int</span> *c = <span class="keyword">new</span> <span class="type">int</span>[k]; <span class="comment">//结果数组</span></span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>)*n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        ++b[a[i] - min];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        b[i] += b[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 辅助数组累加后值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;辅助数组累加后值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; b[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        --b[a[i] - min];</span><br><span class="line">        c[b[a[i] - min]] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 辅助数组最终值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;辅助数组最终值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; b[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结果数组值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;结果数组值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; c[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(a, c, <span class="built_in">sizeof</span>(<span class="type">int</span>) * k);</span><br><span class="line">    <span class="keyword">delete</span> [] b;</span><br><span class="line">    <span class="keyword">delete</span> [] c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> *a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>] &#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">countingSort</span>(a, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">delete</span> [] a;</span><br><span class="line">    <span class="type">int</span> arr[] = &#123; <span class="number">2</span>, <span class="number">5</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span> &#125;;</span><br><span class="line">    <span class="built_in">countingSort</span>(arr, <span class="built_in">sizeof</span>(arr)/<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>计数排序仅适合于小范围的数据进行排序</li>
<li>不能对浮点数进行排序</li>
<li>时间复杂度为 O(n)</li>
<li>计数排序是稳定的</li>
</ul>
<h2 id="基数排序-radix-sorting"><a href="#基数排序-radix-sorting" class="headerlink" title="基数排序(radix sorting)"></a>基数排序(radix sorting)</h2><p>基数排序（radix sorting）将所有待比较数值(正整数)统一为同样的数位长度，数位较短的数前面补零。 然后从最低位开始，依次进行一次排序。这样从最低位排序一直到最高位排序完成以后， 数列就变成一个有序序列。</p>
<p>假设我们有一些二元组(a,b)，要对它们进行以a为首要关键字，b的次要关键字的排序。我们可以先把它们先按照首要关键字排序，分成首要关键字相同的若干堆。然后，在按照次要关键值分别对每一堆进行单独排序。最后再把这些堆串连到一起，使首要关键字较小的一堆排在上面。按这种方式的基数排序称为MSD(Most Significant Dight)排序。第二种方式是从最低有效关键字开始排序，称为LSD(Least Significant Dight)排序。首先对所有的数据按照次要关键字排序，然后对所有的数据按照首要关键字排序。要注意的是，<strong>使用的排序算法必须是稳定的</strong>，否则就会取消前一次排序的结果。由于不需要分堆对每堆单独排序，LSD方法往往比MSD简单而开销小。下文介绍的方法全部是基于LSD的。</p>
<p>基数排序的简单描述就是将数字拆分为个位十位百位，每个位依次排序。因为这对算法稳定要求高，所以我们对数位排序用到上一个排序方法计数排序。因为基数排序要经过d (数据长度)次排序， 每次使用计数排序， 计数排序的复杂度为 O(d*n)，所以基数排序也是 O(n)。基数排序虽然是线性复杂度， 即对n个数字处理了n次，但是每一次代价都比较高， 而且使用计数排序的基数排序不能进行原地排序，需要更多的内存， 并且快速排序可能更好地利用硬件的缓存， 所以比较起来，像快速排序这些原地排序算法更可取。对于一个位数有限的十进制数，我们可以把它看作一个多元组，从高位到低位关键字重要程度依次递减。可以使用基数排序对一些位数有限的十进制数排序。</p>
<p>代码：</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> k, <span class="type">int</span> index, <span class="type">int</span> maxIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index != maxIndex) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;按第&quot;</span> &lt;&lt; index &lt;&lt; <span class="string">&quot;位排序后，结果为：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;最终排序结果为：&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getBitNum</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (num != <span class="number">0</span> &amp;&amp; index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        num /= <span class="number">10</span>;</span><br><span class="line">        --index;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">countingSort</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> k, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> min = <span class="number">0</span>, max = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原始数组值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;原始数组值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = max - min + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> *b = <span class="keyword">new</span> <span class="type">int</span>[n]; <span class="comment">//辅助数组</span></span><br><span class="line">    <span class="type">int</span> *c = <span class="keyword">new</span> <span class="type">int</span>[k]; <span class="comment">//结果数组</span></span><br><span class="line">    <span class="built_in">memset</span>(b, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>)*n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        ++b[<span class="built_in">getBitNum</span>(a[i] - min, index)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        b[i] += b[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 辅助数组累加后值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;辅助数组累加后值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; b[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        --b[<span class="built_in">getBitNum</span>(a[i] - min, index)];</span><br><span class="line">        c[b[<span class="built_in">getBitNum</span>(a[i] - min, index)]] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 辅助数组最终值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;辅助数组最终值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; b[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结果数组值</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;结果数组值&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; c[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">memcpy</span>(a, c, <span class="built_in">sizeof</span>(<span class="type">int</span>) * k);</span><br><span class="line">    <span class="keyword">delete</span>[] b;</span><br><span class="line">    <span class="keyword">delete</span>[] c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">radixSorting</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> k, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; d; ++i) &#123;</span><br><span class="line">        <span class="built_in">countingSort</span>(arr, k, i);</span><br><span class="line">        <span class="built_in">print</span>(arr, k, i, d);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> arr[] = &#123; <span class="number">326</span>,<span class="number">453</span>,<span class="number">608</span>,<span class="number">835</span>,<span class="number">751</span>,<span class="number">435</span>,<span class="number">704</span>,<span class="number">690</span>,<span class="number">88</span>,<span class="number">79</span>,<span class="number">79</span> &#125;;</span><br><span class="line">    <span class="built_in">radixSorting</span>(arr, <span class="built_in">sizeof</span>(arr)/<span class="built_in">sizeof</span>(<span class="type">int</span>), <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(arr) / <span class="built_in">sizeof</span>(<span class="type">int</span>); ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>基数排序仅可排序非负整数</li>
<li>与计数排序不同的是，基数排序可以排序大整数</li>
<li>对每一位进行排序时，需要使用稳定的排序算法，保证在排序高位时低位的顺序不会变</li>
<li>时间复杂度为 O(n)</li>
</ul>
<h2 id="桶排序-bucket-sort"><a href="#桶排序-bucket-sort" class="headerlink" title="桶排序(bucket sort)"></a>桶排序(bucket sort)</h2><p>对于一组长度为k的待排序数组A，将这些数据划分为M个区间（即放入M个桶中）。根据某种映射函数，将这k个数据放入m个桶中。然后对每个桶中的数据进行排序，最后依次输出，得到已排序数据。桶排序要求待排序的元素都属于一个固定的且有限的区间范围内。桶排序步骤如下：</p>
<ul>
<li>扫描序列A，根据每个元素的值所属的区间，放入指定的桶中(顺序放置)。</li>
<li>对每个桶中的元素进行排序，例如插入排序。</li>
<li>依次收集每个桶中的元素，顺序放置到输出序列中。</li>
</ul>
<h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h3><ul>
<li>桶排序要求待排序数组的所有数据在某个指定的范围内</li>
<li>可以用来排序浮点数,而计数排序和基数排序则不能排序浮点数</li>
<li>桶排序是稳定的(桶内需使用插入排序等稳定排序算法)</li>
<li>速度快，耗空间</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>三种排序算法一般来说都是线性时间下的稳定排序(基数排序和桶排内部必须也使用稳定排序)，但这个三种排序对数据的要求都比较严格，计数排序仅能对集中在较小范围中的整数进行排序，且排序的规模不宜过大；基数排序可以对长整数进行排序，但是不适用于浮点数；桶排序则可以对浮点数进行排序。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://blog.csdn.net/zouliping123/article/details/8934856">线性排序算法（计数排序，基数排序，桶排序）分析及实现</a><br><a href="http://www.cnblogs.com/ttltry-air/archive/2012/08/04/2623302.html">计数排序，基数排序和桶排序</a></p>
]]></content>
      <categories>
        <category>algorithm</category>
      </categories>
      <tags>
        <tag>sort</tag>
      </tags>
  </entry>
  <entry>
    <title>实习面试知识点总结</title>
    <url>/post/shiximianshi-zhishidian-zongjie.html</url>
    <content><![CDATA[<h2 id="C-C-基础知识"><a href="#C-C-基础知识" class="headerlink" title="C/C++基础知识"></a>C/C++基础知识</h2><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><table>
<thead>
<tr>
<th>排序方式</th>
<th align="center">平均时间复杂度</th>
<th align="center">最坏时间复杂度</th>
<th align="center">最好时间复杂度</th>
<th align="center">空间复杂度</th>
<th align="center">稳定性</th>
</tr>
</thead>
<tbody><tr>
<td>插入排序</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n)</td>
<td align="center">O(1)</td>
<td align="center">稳定</td>
</tr>
<tr>
<td>希尔排序</td>
<td align="center">O(n<sup>1.3</sup>)</td>
<td align="center">–</td>
<td align="center">–</td>
<td align="center">O(1)</td>
<td align="center">不稳定</td>
</tr>
<tr>
<td>冒泡排序</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n)</td>
<td align="center">O(1)</td>
<td align="center">稳定</td>
</tr>
<tr>
<td>快速排序</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(log<sub>2</sub>n)</td>
<td align="center">不稳定</td>
</tr>
<tr>
<td>选择排序</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(n<sup>2</sup>)</td>
<td align="center">O(1)</td>
<td align="center">不稳定</td>
</tr>
<tr>
<td>堆排序</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(1)</td>
<td align="center">不稳定</td>
</tr>
<tr>
<td>归并排序</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(nlog<sub>2</sub>n)</td>
<td align="center">O(n)</td>
<td align="center">稳定</td>
</tr>
<tr>
<td>基数排序</td>
<td align="center">O(d(n+r))</td>
<td align="center">O(d(n+r))</td>
<td align="center">O(d(n+r))</td>
<td align="center">O(r)</td>
<td align="center">稳定</td>
</tr>
</tbody></table>
<blockquote>
<p> 希尔排序,快排，推排序问的比较多</p>
</blockquote>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p><a href="http://blog.csdn.net/hackbuteer1/article/details/7475622">浅谈C++多态性</a></p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="怎么理解socket"><a href="#怎么理解socket" class="headerlink" title="怎么理解socket"></a>怎么理解socket</h3><p><a href="http://www.cnblogs.com/dolphinX/p/3460545.html">简单理解Socket</a></p>
<h3 id="select和epoll的区别"><a href="#select和epoll的区别" class="headerlink" title="select和epoll的区别"></a>select和epoll的区别</h3><p><a href="http://www.cnblogs.com/Anker/p/3265058.html">select、poll、epoll之间的区别总结[整理]</a><br><a href="https://segmentfault.com/a/1190000003063859">Linux IO模式及 select、poll、epoll详解</a><br><a href="http://www.jianshu.com/p/dfd940e7fca2">聊聊IO多路复用之select、poll、epoll详解</a></p>
<h3 id="tcp三次握手四次挥手"><a href="#tcp三次握手四次挥手" class="headerlink" title="tcp三次握手四次挥手"></a>tcp三次握手四次挥手</h3><p><a href="https://segmentfault.com/a/1190000006885287">TCP三次握手四次挥手</a></p>
<h3 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h3><p><a href="https://my.oschina.net/xinxingegeya/blog/485650">TCP 滑动窗口（发送窗口和接收窗口）</a></p>
<h3 id="进程之间通信"><a href="#进程之间通信" class="headerlink" title="进程之间通信"></a>进程之间通信</h3><p><a href="http://blog.csdn.net/gatieme/article/details/50908749">Linux进程间通信的几种方式总结–linux内核剖析（七）</a></p>
<h3 id="线程之间通信"><a href="#线程之间通信" class="headerlink" title="线程之间通信"></a>线程之间通信</h3><p><a href="http://www.doc00.com/doc/1001009wg">linux基础——linux线程间通信及同步机制总结</a></p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><h3 id="虚拟地址"><a href="#虚拟地址" class="headerlink" title="虚拟地址"></a>虚拟地址</h3><p><a href="http://blog.csdn.net/yusiguyuan/article/details/9664887">linux内存管理—虚拟地址、逻辑地址、线性地址、物理地址的区别（一）</a></p>
<h3 id="中断分类"><a href="#中断分类" class="headerlink" title="中断分类"></a>中断分类</h3><p><a href="http://www.crifan.com/files/doc/docbook/interrupt_related/release/htmls/interrput_type.html">中断的分类</a></p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="sql基本命令"><a href="#sql基本命令" class="headerlink" title="sql基本命令"></a>sql基本命令</h3><p><a href="http://www.w3school.com.cn/sql/sql_syntax.asp">w3school</a></p>
]]></content>
      <categories>
        <category>cs</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>SSH通过跳板机登陆远程机器</title>
    <url>/post/ssh-proxycommand.html</url>
    <content><![CDATA[<p>公司登陆测试服务器使用的是先登陆跳板机,然后再登陆远程机器,使用secureCRT的rz,sz可以上传下载文件,但不是很方便.</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>在config文件中<br><code>vim ~/.ssh/config</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ControlMaster auto</span><br><span class="line">    ControlPath ~/.ssh/%h-%p-%r</span><br><span class="line">    ControlPersist yes</span><br><span class="line"></span><br><span class="line">Host d111</span><br><span class="line">    ProxyCommand ssh -p 10099 userdev@000.00.00.10 nc 10.10.000.000 22</span><br></pre></td></tr></table></figure>

<p>以后登陆远程机器时就可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh usename@d111</span><br></pre></td></tr></table></figure>

<p>以后就可以使用scp直接上传文件或下载文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp -r ~/dir username@d111:/data/username/tmp</span><br><span class="line">scp username@d111:/data/username/tmp/dir/test.txt ./</span><br></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://serverfault.com/questions/37629/how-do-i-do-multihop-scp-transfers">https://serverfault.com/questions/37629/how-do-i-do-multihop-scp-transfers</a><br><a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/scp.html">scp 跨机远程拷贝</a><br><a href="https://my.oschina.net/foreverich/blog/657075">ssh如何通过跳板机直接访问到后端服务器</a><br><a href="http://mingxinglai.com/cn/2015/07/ssh-proxycommand/">SSH穿越跳板机：一条命令跨越跳板机直接登陆远程计算机</a><br><a href="https://www.zhihu.com/question/20541129">Mac OS X 平台有哪些好用的 SSH 客户端？</a><br><a href="https://www.zhihu.com/question/38216180">scp如何跨过中转主机直接传输文件？</a></p>
]]></content>
      <categories>
        <category>cs</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>录制terminal工具asciinema</title>
    <url>/post/record-terminal-sessions-tool-asciinema.html</url>
    <content><![CDATA[<p><img src="//st.mcosx.cn/blog/img/201707/asciinema.png" alt="asciinema"></p>
<p>Asciinema 是一个轻量并且非常高效的终端会话录制器。使用它可以录制、回放和分享 JSON 格式的终端会话记录。与一些桌面录制器，比如 Recordmydesktop、Simplescreenrecorder、Vokoscreen 或 Kazam 相比，Asciinema 最主要的优点是，它能够以通过 ASCII 文本以及 ANSI 转义码编码来录制所有的标准终端输入、输出和错误信息。</p>
<ul>
<li>通过命令行一键进行录制，不再需要打开各种 GUI 程序进行复杂操作。</li>
<li>非常适合在 Github 上展示自己的程序，或者是录制教程等。</li>
<li>还可以一键上传到 asciinema 官网，命名保存自己的操作，会生成短 URL 便于随时访问、分享。</li>
<li>会自动识别系统和使用的 terminal 类型，比如bash。</li>
<li>录制产生的文件是一个 asciinema 自己格式的 json 文件，可以本地播放，也可以用官方的<asciinema-player></asciinema-player>组件嵌入到自己的 web 博客中。</li>
</ul>
<p>参考：<br><a href="https://linux.cn/article-8519-1.html">如何在 Linux 中使用 Asciinema 进行录制和回放终端会话</a></p>
]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>terminal</tag>
      </tags>
  </entry>
  <entry>
    <title>c++输入输出</title>
    <url>/post/cpp-input-and-output.html</url>
    <content><![CDATA[<h2 id="IO类"><a href="#IO类" class="headerlink" title="IO类"></a>IO类</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>c++中主要的IO类有三个:iostream,fstream,sstream.iostream定义了用于读写流的基本类型,fstream定义了读写命名文件的类型,sstream定义了读写内存string对象的类型.详细的继承对应关系如下图:<br><img src="//st.mcosx.cn/blog/img/201707/io.gif" alt="img"></p>
<h3 id="条件状态-condition-state"><a href="#条件状态-condition-state" class="headerlink" title="条件状态(condition state)"></a>条件状态(condition state)</h3><p>strm::iostate    strm指某一种IO类型,iostate是一种机器相关的类型,提供了表达条件状态的完整功能<br>strm::badbit    流已崩溃<br>strm::failbit      指出一个IO操作失败了<br>strm::eofbit     指出流到达了文件结束<br>strm::goodbit    用来指出流未处于错误状态.此值保证为零<br>s.eof()    若流s的eofbit置位,则返回true<br>s.fail()    若流s的failbit或badbit置位,则返回true<br>s.bad()    若流s的badbit置位,则返回true<br>s.good()    若流s处于有效状态,则返回true<br>s.clear()    将流s中所有条件状态位复位,将流的状态设置为有效.返回void<br>s.clear(flags)    根据给定的flags标志位,将流s中对应条件状态位复位.flags的类型为strm::iostate.返回void<br>s.setstate(flags)    根据给定的flags标志位,将流s中对应条件状态位置位.flags的类型为strm::iostate.返回void<br>s.rdstate()    返回流s的当前条件状态,返回值类型为strm::iostate</p>
<span id="more"></span>
<p>例:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> old_state = cin.<span class="built_in">rdstate</span>();  <span class="comment">// 记住cin的当前状态</span></span><br><span class="line">cin.<span class="built_in">clear</span>();  <span class="comment">// 使cin有效</span></span><br><span class="line"><span class="built_in">process_input</span>(cin);  <span class="comment">// 使用cin</span></span><br><span class="line">cin.<span class="built_in">setstate</span>(old_state);  <span class="comment">// 将cin置为原有状态</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cin.<span class="built_in">clear</span>(cin.<span class="built_in">rdstate</span>() &amp; ~cin.failbit &amp; ~cin.badbit);    <span class="comment">// 将failbit和badbit复位,且保持eofbit不变</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲"><a href="#缓冲" class="headerlink" title="缓冲"></a>缓冲</h3><p>导致缓冲刷新的原因可能有以下几种:</p>
<ul>
<li>程序正常结束,作为main函数的return操作的一部分,缓冲刷新被执行.</li>
<li>缓冲区满时.</li>
<li>使用操纵符如endl(不附加任何额外字符的flush,附加一个空字符的ends)来显式刷新缓冲区<blockquote>
<p>使用fflush(cout)也可刷新缓冲区</p>
</blockquote>
</li>
<li>在每个输出操作之后,我们可以用操纵符unitbuf设置流的内部状态,来清空缓冲区.默认情况下,对cerr是设置unitbuf的,因此写到cerr的内容都是立即刷新的.例:<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">std::ios_base&amp; unitbuf( std::ios_base&amp; str );</span></span><br><span class="line"><span class="comment">std::ios_base&amp; nounitbuf( std::ios_base&amp; str );</span></span><br><span class="line"><span class="comment">std::cout &lt;&lt; std::unitbuf;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// modify unifbuf flag</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ios&gt;</span>         <span class="comment">// std::unitbuf</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span>     <span class="comment">// std::ofstream</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function">std::ofstream <span class="title">outfile</span> <span class="params">(<span class="string">&quot;test.txt&quot;</span>)</span></span>;</span><br><span class="line">  outfile &lt;&lt; std::unitbuf &lt;&lt;  <span class="string">&quot;Test &quot;</span> &lt;&lt; <span class="string">&quot;file&quot;</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;  <span class="comment">// flushed three times</span></span><br><span class="line">  outfile.<span class="built_in">close</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>一个输出流可能被关联到另一个流.在这种情况下,当读写被关联的流时,关联到的流的缓冲区会被刷新.例如,默认清空下,cin和cerr都关联到cout.因此,读cin或写cerr都会导致cout的缓冲区被刷新.例x.tie(&amp;o)将流x关联到输出流o.</li>
</ul>
<blockquote>
<p>注:程序崩溃时,输出缓冲区不会被刷新</p>
</blockquote>
<h3 id="同步关系"><a href="#同步关系" class="headerlink" title="同步关系"></a>同步关系</h3><p>c++中cin、cout，cerr和c的stdin、stdout、stderr都是同步的，即iostream 对象和cstdio流是同步的，同步关系如下<br>|C stream |iostream|<br>|————-|————|<br>|stdin        | cin,wcin |<br>|stdout      |cout,wcout|<br>|stderr       |cerr,wcerr,clog,wclog|<br>可以使用</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> std::ios_base::<span class="built_in">sync_with_stdio</span> (<span class="type">bool</span> sync = <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>参数为false来取消同步来加快输出速度.(参考:<a href="https://www.byvoid.com/zhs/blog/fast-readfile">探寻C++最快的读取文件的方案</a>)</p>
<h3 id="设置缓冲区大小"><a href="#设置缓冲区大小" class="headerlink" title="设置缓冲区大小"></a>设置缓冲区大小</h3><p>我们可以通过函数setbuf 和 setvbuf 自己设置输入输出流的缓冲区，需要注意的是不管程序中申请的的缓冲区实际大小为多少，setbuf都将缓冲区设置的大小为BUFSIZ(这个宏在windows下是512，ubuntu下是1024), setvbuf则可以设置缓冲区大小以及缓冲区的模式(行缓冲、全缓冲、无缓冲),需要注意的是这两个函数设置的是c的输入输出缓冲区，因为c++和c的缓冲区是同步的，所有该函数会对c++有影响  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setbuf</span> <span class="params">( FILE * stream, <span class="type">char</span> * buffer )</span></span>;</span><br><span class="line"><span class="comment">// mode:_IOFBF(Full buffering),_IOLBF(Line buffering),_IONBF(No buffering)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">setvbuf</span> <span class="params">( FILE * stream, <span class="type">char</span> * buffer, <span class="type">int</span> mode, <span class="type">size_t</span> size )</span></span>;</span><br><span class="line"><span class="comment">//例: setvbuf ( pFile , NULL , _IOFBF , 1024 );</span></span><br></pre></td></tr></table></figure>
<h3 id="提升IO速度"><a href="#提升IO速度" class="headerlink" title="提升IO速度"></a>提升IO速度</h3><p>可参考<a href="https://stackoverflow.com/questions/1924530/mixing-cout-and-printf-for-faster-output?answertab=votes">mixing cout and printf for faster output</a> [翻译:<a href="https://gxnotes.com/article/83418.html">混合cout和printf以更快的输出</a>]和<a href="https://www.byvoid.com/zhs/blog/fast-readfile">探寻C++最快的读取文件的方案</a><br>总之:</p>
<ul>
<li>取消同步可以使c++中cin或cout快很多</li>
<li>尽量在io上少些格式化输出,如果必要可以先格式化输出到自己的缓冲区,然后再写入流中.如:<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*puts(&quot;Hello World\n&quot;) is much faster than printf(&quot;%s&quot;, &quot;Hellow World\n&quot;). (Primarily due to the formatting overhead). Once you have isolated the formatted from plain text, you can do tricks like:</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> hello[] = <span class="string">&quot;Hello World\n&quot;</span>;</span><br><span class="line">cout.<span class="built_in">write</span>(hello, <span class="built_in">sizeof</span>(hello) - <span class="built_in">sizeof</span>(<span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> MAX_BUFFER_SIZE = <span class="number">256</span>;</span><br><span class="line"><span class="type">char</span> buffer[MAX_BUFFER_SIZE];</span><br><span class="line"><span class="built_in">sprintf</span>(buffer, <span class="string">&quot;%d times is a charm.\n&quot;</span>, <span class="number">5</span>);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> text_length = <span class="built_in">strlen</span>(buffer) - <span class="built_in">sizeof</span>(<span class="string">&#x27;\0&#x27;</span>);</span><br><span class="line"><span class="built_in">fwrite</span>(buffer, <span class="number">1</span>, text_length, stdout);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>C++ Primer 5th<br><a href="http://www.cnblogs.com/TenosDoIt/p/3733243.html">c/c++ 输入输出缓冲区</a><br><a href="https://www.byvoid.com/zhs/blog/fast-readfile">探寻C++最快的读取文件的方案</a><br><a href="http://blog.csdn.net/yhl_leo/article/details/47734479">C++ 输出缓冲区的管理</a><br><a href="https://github.com/xuelangZF/CS_Offer/blob/master/C%2B%2B/InputOutput.md">C++ 输入输出流</a><br><a href="https://zh.wikipedia.org/wiki/Iostream">维基百科-iostream</a></p>
]]></content>
      <categories>
        <category>cpp</category>
      </categories>
      <tags>
        <tag>io</tag>
      </tags>
  </entry>
  <entry>
    <title>C++中的nan和inf</title>
    <url>/post/nan-and-inf-in-cpp.html</url>
    <content><![CDATA[<h2 id="nan和inf的产生"><a href="#nan和inf的产生" class="headerlink" title="nan和inf的产生"></a>nan和inf的产生</h2><p>nan 代表不是一个数字(not a number), inf代表无穷大(infinity)</p>
<p>IEEE 754 的一些规定：</p>
<h3 id="‘Invalid-Operation’"><a href="#‘Invalid-Operation’" class="headerlink" title="‘Invalid Operation’"></a>‘Invalid Operation’</h3><p>This exception is raised if the given operands are invalid for the operation to be performed. Examples are (see IEEE 754, section 7):</p>
<p>Addition or subtraction: &infin; - &infin;. (But &infin; + &infin; = &infin;).<br>Multiplication: 0 &middot; &infin;.<br>Division: 0/0 or &infin;/&infin;.<br>Remainder: x REM y, where y is zero or x is infinite.<br>Square root if the operand is less than zero. More generally, any mathematical function evaluated outside its domain produces this exception.<br>Conversion of a floating-point number to an integer or decimal string, when the number cannot be represented in the target format (due to overflow, infinity, or NaN).<br>Conversion of an unrecognizable input string.<br>Comparison via predicates involving &lt; or &gt;, when one or other of the operands is NaN. You can prevent this exception by using the unordered comparison functions instead; see FP Comparison Functions.<br>If the exception does not trap, the result of the operation is NaN.</p>
<h3 id="‘Division-by-Zero’"><a href="#‘Division-by-Zero’" class="headerlink" title="‘Division by Zero’"></a>‘Division by Zero’</h3><p>This exception is raised when a finite nonzero number is divided by zero. If no trap occurs the result is either +&infin; or -&infin;, depending on the signs of the operands.</p>
<h3 id="‘Overflow’"><a href="#‘Overflow’" class="headerlink" title="‘Overflow’"></a>‘Overflow’</h3><p>This exception is raised whenever the result cannot be represented as a finite value in the precision format of the destination. If no trap occurs the result depends on the sign of the intermediate result and the current rounding mode (IEEE 754, section 7.3):</p>
<p>Round to nearest carries all overflows to &infin; with the sign of the intermediate result.<br>Round toward 0 carries all overflows to the largest representable finite number with the sign of the intermediate result.<br>Round toward -&infin; carries positive overflows to the largest representable finite number and negative overflows to -&infin;.<br>Round toward &infin; carries negative overflows to the most negative representable finite number and positive overflows to &infin;.<br>Whenever the overflow exception is raised, the inexact exception is also raised.</p>
<h3 id="‘Underflow’"><a href="#‘Underflow’" class="headerlink" title="‘Underflow’"></a>‘Underflow’</h3><p>The underflow exception is raised when an intermediate result is too small to be calculated accurately, or if the operation’s result rounded to the destination precision is too small to be normalized.</p>
<p>When no trap is installed for the underflow exception, underflow is signaled (via the underflow flag) only when both tininess and loss of accuracy have been detected. If no trap handler is installed the operation continues with an imprecise small value, or zero if the destination precision cannot hold the small exact result.</p>
<h3 id="‘Inexact’"><a href="#‘Inexact’" class="headerlink" title="‘Inexact’"></a>‘Inexact’</h3><p>This exception is signalled if a rounded result is not exact (such as when calculating the square root of two) or a result overflows without an overflow trap.</p>
<h2 id="nan和inf的运算"><a href="#nan和inf的运算" class="headerlink" title="nan和inf的运算"></a>nan和inf的运算</h2><p>n + inf = inf;    // 任意数 + 无穷大 = 无穷大<br>n / inf = 0;        // 任意数 / 无穷大 = 0<br>atan(inf) = π     // 对无穷大取反正切，结果为π<br>任意数和nan运算结果都为nan<br>nan不大于，不小于，也不等于任意数(包括自身)<br>inf除了自身及nan,正无穷大大于一切,负无穷大小于一切<br>​</p>
<h2 id="nan和inf的判断"><a href="#nan和inf的判断" class="headerlink" title="nan和inf的判断"></a>nan和inf的判断</h2><p>c++可以使用<cmath>中的std::isinf(x)和std::isnan(x)来分别判断inf和nan。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.gnu.org/software/libc/manual/html_node/FP-Exceptions.html">http://www.gnu.org/software/libc/manual/html_node/FP-Exceptions.html</a><br><a href="http://www.gnu.org/software/libc/manual/html_node/Infinity-and-NaN.html">http://www.gnu.org/software/libc/manual/html_node/Infinity-and-NaN.html</a><br><a href="https://stackoverflow.com/questions/570669/checking-if-a-double-or-float-is-nan-in-c">https://stackoverflow.com/questions/570669/checking-if-a-double-or-float-is-nan-in-c</a><br><a href="https://stackoverflow.com/questions/4095337/how-to-check-for-inf-and-or-nan-in-a-double-variable">https://stackoverflow.com/questions/4095337/how-to-check-for-inf-and-or-nan-in-a-double-variable</a><br><a href="https://stackoverflow.com/questions/16691207/c-c-nan-constant-literal">https://stackoverflow.com/questions/16691207/c-c-nan-constant-literal</a></p>
]]></content>
      <categories>
        <category>cpp</category>
      </categories>
      <tags>
        <tag>double</tag>
      </tags>
  </entry>
  <entry>
    <title>shell守护进程之踩坑记录</title>
    <url>/post/shell-daemon-record.html</url>
    <content><![CDATA[<p>今天在写一个进程守护shell文件时，发现判断字符串为空时的一个坑，先记录下来。<br>在watch函数中，用 if [ ! -z ${pid} ];判断是正常的。<br>当把watch函数写成以下时(第一个程序正在运行，第二个未运行)，</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function watch() &#123;</span><br><span class="line">    pid=&quot;$(ps aux|grep -v grep|grep &quot;$&#123;1&#125;&quot; |awk &#x27;&#123;print $2&#125;&#x27;|head -n 1)&quot;</span><br><span class="line">    date=&quot;[$(date &#x27;+%Y%m%d %H:%M:%S&#x27;)]&quot;</span><br><span class="line">    echo &quot;1:$&#123;1&#125;&quot;</span><br><span class="line">    echo &quot;abc:$(ps aux|grep -v grep|grep &quot;$&#123;1&#125;&quot;)&quot;</span><br><span class="line">    echo &quot;pid:$&#123;pid&#125;&quot;</span><br><span class="line"></span><br><span class="line">    if [ $&#123;2&#125; == &quot;daemon&quot; ]; then</span><br><span class="line">        if [ -n $&#123;pid&#125; ]; then</span><br><span class="line">            echo &quot;nnnnnnnnnnnnnnnnnnnnnnnn-n&quot;</span><br><span class="line">        fi</span><br><span class="line">        if [ -z $&#123;pid&#125; ]; then</span><br><span class="line">            echo &quot;zzzzzzzzzzzzzzzzzzzzzzzz-z&quot;</span><br><span class="line">        fi</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            echo &quot;$&#123;date&#125;$&#123;1&#125;(pid:$&#123;pid&#125;) is running&quot;</span><br><span class="line">        else</span><br><span class="line">            nohup $&#123;1&#125; 1&gt;$&#123;3&#125; 2&gt;&amp;1 &amp;</span><br><span class="line">            echo &quot;$&#123;date&#125;启动进程$&#123;1&#125;(pid:&quot;$!&quot;)成功&quot;</span><br><span class="line">        fi</span><br><span class="line">    elif [ $&#123;2&#125; == &quot;restart&quot; ]; then</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            kill -9 $&#123;pid&#125;</span><br><span class="line">        fi</span><br><span class="line">        nohup $&#123;1&#125; 1&gt;$&#123;3&#125; 2&gt;&amp;1 &amp;</span><br><span class="line">        echo &quot;$&#123;date&#125;重启进程$&#123;1&#125;(pid:&quot;$!&quot;)成功&quot;</span><br><span class="line">    elif [ $&#123;2&#125; == &quot;kill&quot; ]; then</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            kill -9 $&#123;pid&#125;</span><br><span class="line">        fi</span><br><span class="line">        echo &quot;$&#123;date&#125;结束进程$&#123;1&#125;(pid:$&#123;pid&#125;)成功&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>输出为：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1:/usr/local/bin/python3 /search/offline/PPCityMoniter/ppcity_scripts/main.py -T web</span><br><span class="line">abc:mali      7537  0.0  0.2 227712 22356 pts/3    S    18:36   0:00 /usr/local/bin/python3 /search/offline/PPCityMoniter/ppcity_scripts/main.py -T web</span><br><span class="line">mali      7567  0.6  0.2 305592 22468 pts/3    Sl   18:36   0:37 /usr/local/bin/python3 /search/offline/PPCityMoniter/ppcity_scripts/main.py -T web</span><br><span class="line">pid:7537</span><br><span class="line">nnnnnnnnnnnnnnnnnnnnnnnn-n</span><br><span class="line">[20170720 20:15:51]/usr/local/bin/python3 /search/offline/PPCityMoniter/ppcity_scripts/main.py -T web(pid:7537) is running</span><br><span class="line">1:sh /search/offline/PPCityMoniter/ppcity_scripts/utils/pull_logs.sh</span><br><span class="line">abc:</span><br><span class="line">pid:</span><br><span class="line">nnnnnnnnnnnnnnnnnnnnnnnn-n</span><br><span class="line">zzzzzzzzzzzzzzzzzzzzzzzz-z</span><br><span class="line">[20170720 20:15:51]启动进程sh /search/offline/PPCityMoniter/ppcity_scripts/utils/pull_logs.sh(pid:13848)成功</span><br></pre></td></tr></table></figure>
<p>也就是说当pid为”空”时，程序既进入了<code> if [ -n $&#123;pid&#125; ];</code>，也进入了<code>if [ -z $&#123;pid&#125; ];</code>,有点不懂了，-n代表非空字符串，-z代表空字符串</p>
<p>最后可以正常执行的脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">set -o errexit</span><br><span class="line">set -o nounset</span><br><span class="line"></span><br><span class="line">cur_file=$(basename $0)</span><br><span class="line">cur_dir=$(cd $(dirname $0) &amp;&amp; pwd -P)    # 绝对目录地址</span><br><span class="line">cur_full_file=&quot;$&#123;cur_dir&#125;/$&#123;cur_file&#125;&quot;</span><br><span class="line">cd $&#123;cur_dir&#125;</span><br><span class="line">run_dir=&quot;$(pwd)&quot;</span><br><span class="line"></span><br><span class="line">readonly p_file=&quot;../conf/p.list&quot;</span><br><span class="line"></span><br><span class="line">p_list=()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">读文件</span></span><br><span class="line">function readfile() &#123;</span><br><span class="line">    if [ -f $&#123;1&#125; ]; then</span><br><span class="line">        declare -i x=0</span><br><span class="line">        while read -r line;</span><br><span class="line">        do</span><br><span class="line">            if [ &quot;$&#123;line:0:1&#125;&quot; == &quot;#&quot; ]; then</span><br><span class="line">                continue</span><br><span class="line">            elif [ -z &quot;$&#123;line&#125;&quot; ]; then</span><br><span class="line">                continue</span><br><span class="line">            else</span><br><span class="line">                p_list[$&#123;x&#125;]=$&#123;line&#125;;</span><br><span class="line">                x+=1</span><br><span class="line">            fi</span><br><span class="line">        done &lt; $&#123;1&#125;</span><br><span class="line">        return 0</span><br><span class="line">    else</span><br><span class="line">        echo $&#123;1&#125;&quot;不存在&quot; 1&gt;&gt;&quot;$&#123;3:-/dev/null&#125;&quot; 2&gt;&amp;1</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">传入3个参数:监控程序(p_list中项),命令参数,日志名</span></span><br><span class="line">function watch() &#123;</span><br><span class="line">    pid=&quot;$(ps aux|grep -v grep|grep &quot;$&#123;1&#125;&quot; |awk &#x27;&#123;print $2&#125;&#x27;|head -n 1)&quot;</span><br><span class="line">    date=&quot;[$(date &#x27;+%Y%m%d %H:%M:%S&#x27;)]&quot;</span><br><span class="line"></span><br><span class="line">    if [ $&#123;2&#125; == &quot;daemon&quot; ]; then</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            echo &quot;$&#123;date&#125;$&#123;1&#125;(pid:$&#123;pid&#125;) is running&quot;</span><br><span class="line">        else</span><br><span class="line">            (nohup $&#123;1&#125; &gt;&gt;$&#123;3&#125; 2&gt;&amp;1) &amp;</span><br><span class="line">            echo &quot;$&#123;date&#125;启动进程$&#123;1&#125;(pid:&quot;$!&quot;)成功&quot;</span><br><span class="line">        fi</span><br><span class="line">    elif [ $&#123;2&#125; == &quot;restart&quot; ]; then</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            kill -9 $&#123;pid&#125;</span><br><span class="line">        fi</span><br><span class="line">        (nohup $&#123;1&#125; &gt;&gt;$&#123;3&#125; 2&gt;&amp;1) &amp;</span><br><span class="line">        echo &quot;$&#123;date&#125;重启进程$&#123;1&#125;(pid:&quot;$!&quot;)成功&quot;</span><br><span class="line">    elif [ $&#123;2&#125; == &quot;kill&quot; ]; then</span><br><span class="line">        if [ ! -z $&#123;pid&#125; ]; then</span><br><span class="line">            kill -9 $&#123;pid&#125;</span><br><span class="line">        fi</span><br><span class="line">        echo &quot;$&#123;date&#125;结束进程$&#123;1&#125;(pid:$&#123;pid&#125;)成功&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第1个参数是命令参数(<span class="string">&quot;daemon,restart,kill&quot;</span>),第2个参数是进程启动的日志输出文件名</span></span><br><span class="line">function daemon() &#123;</span><br><span class="line">    type nohup &gt;/dev/null 2&gt;&amp;1 || &#123; echo &gt;&amp;2 &quot;缺少nohup&quot; 1&gt;&quot;$&#123;3:-/dev/null&#125;&quot; 2&gt;&amp;1; return -1; &#125;</span><br><span class="line">    declare -i x=0</span><br><span class="line">    while(( x &lt; $&#123;#p_list[*]&#125; ))</span><br><span class="line">    do</span><br><span class="line">        watch &quot;$&#123;p_list[$&#123;x&#125;]&#125;&quot; &quot;$&#123;1&#125;&quot; &quot;$&#123;2&#125;&quot;</span><br><span class="line">        x+=1</span><br><span class="line">    done</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readfile $&#123;p_file&#125;</span><br><span class="line">daemon &quot;$&#123;1:-daemon&#125;&quot; &quot;$&#123;2:-$&#123;cur_full_file&#125;.log&#125;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.tutorialspoint.com/unix/unix-basic-operators.htm">Unix - Shell Basic Operators</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu安装L2TP</title>
    <url>/post/ubuntu-install-l2tp.html</url>
    <content><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote>
<p>ubuntu 16.04 64</p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>有ppa源<a href="https://launchpad.net/~nm-l2tp/+archive/ubuntu/network-manager-l2tp">https://launchpad.net/~nm-l2tp/+archive/ubuntu/network-manager-l2tp</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:nm-l2tp/network-manager-l2tp  </span><br><span class="line">sudo apt-get update  </span><br><span class="line">sudo apt-get install network-manager-l2tp  </span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>可能会提示错误:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Could not load editor VPN plugin for &#x27;org.freedesktop.NetworkManager.l2tp&#x27; (missing plugin file &quot;/usr/lib/x86_64-linux-gnu/NetworkManager/libnm-vpn-plugin-l2tp-editor.so&quot;).</span><br></pre></td></tr></table></figure>
<p>解决办法:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install network-manager-l2tp-gnome</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://askubuntu.com/questions/762355/xerus-missing-l2tp-plugin-for-network-manager/840306">Xerus - missing L2TP plugin for Network-Manager?</a><br><a href="https://www.questarter.com/q/connect-to-l2tp-over-ipsec-3_934350.html">Connect to L2TP over IPsec</a><br><a href="https://launchpad.net/~nm-l2tp/+archive/ubuntu/network-manager-l2tp">network-manager-l2tp</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
        <tag>L2TP</tag>
      </tags>
  </entry>
  <entry>
    <title>C++内存分配</title>
    <url>/post/cpp-memory-allocation.html</url>
    <content><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote>
<p>ubuntu 16.04 64<br>g++ 6.3</p>
</blockquote>
<h2 id="实例文件"><a href="#实例文件" class="headerlink" title="实例文件"></a>实例文件</h2><p>tes.cpp</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> global_a; <span class="comment">//.bss</span></span><br><span class="line"><span class="type">int</span> global_b = <span class="number">0</span>; <span class="comment">//.bss</span></span><br><span class="line"><span class="type">int</span> global_c = <span class="number">3</span>; <span class="comment">//.data</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> static_global_a; <span class="comment">//.bss</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> static_global_b = <span class="number">3</span>; <span class="comment">//.data</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> const_global_a = <span class="number">0</span>; <span class="comment">//.rodata</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> const_global_b = <span class="number">1</span>; <span class="comment">//.rodata</span></span><br><span class="line"><span class="type">const</span> <span class="type">static</span> <span class="type">int</span> const_static_global_a = <span class="number">0</span>; <span class="comment">//.rodata</span></span><br><span class="line"><span class="type">const</span> <span class="type">static</span> <span class="type">int</span> const_static_global_b = <span class="number">1</span>; <span class="comment">//.rodata</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> local_static_a; <span class="comment">//.bss</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> local_static_b = <span class="number">3</span>; <span class="comment">//.data</span></span><br><span class="line">	<span class="type">const</span> <span class="type">static</span> <span class="type">int</span> local_const_static_a = <span class="number">0</span>; <span class="comment">//.rodata</span></span><br><span class="line">	<span class="type">const</span> <span class="type">static</span> <span class="type">int</span> local_const_static_b = <span class="number">1</span>; <span class="comment">//.rodata</span></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> local_const_a = <span class="number">0</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> local_const_b = <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> local_a;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">g++-6 -c tes.cpp -o tes.o</span><br><span class="line">size tes.o</span><br><span class="line">objdump -CS -s -j .data tes.o</span><br><span class="line">readelf -all tes.o</span><br><span class="line">nm ./a.out</span><br></pre></td></tr></table></figure>

<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="编译单个tes-cpp文件"><a href="#编译单个tes-cpp文件" class="headerlink" title="编译单个tes.cpp文件"></a>编译单个tes.cpp文件</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">g++<span class="number">-6</span> -c tes.cpp -o tes.o</span><br><span class="line">g++<span class="number">-6</span> tes.cpp</span><br></pre></td></tr></table></figure>

<h3 id="查看大小"><a href="#查看大小" class="headerlink" title="查看大小"></a>查看大小</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X@DESKTOP-LMTTY:~/test$ size tes.o</span><br><span class="line">   text	   data	    bss	    dec	    hex	filename</span><br><span class="line">    105	      12	     16	    129	     81	tes.o</span><br></pre></td></tr></table></figure>

<h3 id="反编译查看各分区"><a href="#反编译查看各分区" class="headerlink" title="反编译查看各分区"></a>反编译查看各分区</h3><p>.data</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">X@DESKTOP-LMTTY:~/test$ objdump -CS -s -j .data tes.o</span><br><span class="line"></span><br><span class="line">tes.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Contents of section .data:</span><br><span class="line"> 0000 03000000 03000000 03000000           ............    </span><br><span class="line"></span><br><span class="line">Disassembly of section .data:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;global_c&gt;:</span><br><span class="line">   0:	03 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000004 &lt;static_global_b&gt;:</span><br><span class="line">   4:	03 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000008 &lt;main::local_static_b&gt;:</span><br><span class="line">   8:	03 00 00 00                                         ....</span><br></pre></td></tr></table></figure>

<p>.bss</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">X@DESKTOP-LMTTY:~/test$ objdump -CS -s -j .bss tes.o</span><br><span class="line"></span><br><span class="line">tes.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .bss:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;global_a&gt;:</span><br><span class="line">   0:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000004 &lt;global_b&gt;:</span><br><span class="line">   4:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000008 &lt;static_global_a&gt;:</span><br><span class="line">   8:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">000000000000000c &lt;main::local_static_a&gt;:</span><br><span class="line">   c:	00 00 00 00                                         ....</span><br></pre></td></tr></table></figure>

<p>.rodata</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">X@DESKTOP-LMTTY:~/test$ objdump -CS -s -j .rodata tes.o</span><br><span class="line"></span><br><span class="line">tes.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Contents of section .rodata:</span><br><span class="line"> 0000 00000000 01000000 00000000 01000000  ................</span><br><span class="line"> 0010 00000000 01000000                    ........        </span><br><span class="line"></span><br><span class="line">Disassembly of section .rodata:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;const_global_a&gt;:</span><br><span class="line">   0:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000004 &lt;const_global_b&gt;:</span><br><span class="line">   4:	01 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000008 &lt;const_static_global_a&gt;:</span><br><span class="line">   8:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">000000000000000c &lt;const_static_global_b&gt;:</span><br><span class="line">   c:	01 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000010 &lt;main::local_const_static_a&gt;:</span><br><span class="line">  10:	00 00 00 00                                         ....</span><br><span class="line"></span><br><span class="line">0000000000000014 &lt;main::local_const_static_b&gt;:</span><br><span class="line">  14:	01 00 00 00                                         ....</span><br></pre></td></tr></table></figure>

<h3 id="查看符号表"><a href="#查看符号表" class="headerlink" title="查看符号表"></a>查看符号表</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">X@DESKTOP-LMTTY:~/test$ nm tes.o</span><br><span class="line">0000000000000000 B global_a</span><br><span class="line">0000000000000004 B global_b</span><br><span class="line">0000000000000000 D global_c</span><br><span class="line">0000000000000000 T main</span><br><span class="line">0000000000000000 r _ZL14const_global_a</span><br><span class="line">0000000000000004 r _ZL14const_global_b</span><br><span class="line">0000000000000008 b _ZL15static_global_a</span><br><span class="line">0000000000000008 r _ZL21const_static_global_a</span><br><span class="line">000000000000000c r _ZL21const_static_global_b</span><br><span class="line">000000000000000c b _ZZ4mainE14local_static_a</span><br><span class="line">0000000000000004 d _ZZ4mainE14local_static_b</span><br><span class="line">0000000000000010 r _ZZ4mainE20local_const_static_a</span><br><span class="line">0000000000000014 r _ZZ4mainE20local_const_static_b</span><br></pre></td></tr></table></figure>

<p>nm解释参考<a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/nm.html">http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/nm.html</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>C++中内存从低地址到高地址分别为:</p>
<ol>
<li>.text segment: 代码段</li>
<li>.rodata segment: 存储常量，例如字符串常量，const修饰的变量。</li>
<li>.data segment: 又称GVAR.存储已经初始化的非零全局变量和静态变量(全局/局部)</li>
<li>.bss segment: BSS segment也称为未初始化的数据段，包含全局或静态未初始化的变量，该部分数据中的值会在程序启动时直接初始为0，BSS是Block Started by Symbol的简写</li>
<li>heap: 堆,动态内存区域，使用malloc或new申请的内存.向地址变大的方向增长.</li>
<li>自由存储区: 未使用的内存</li>
<li>stack: 栈,局部变量、参数、返回值都存在这里，函数调用开始会参数入栈、局部变量入栈；调用结束依次出栈。向地址变小的方向增长.</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://notes.maxwi.com/2016/06/11/cpp-memory-layout/">实例分析C++内存布局</a><br><a href="https://www.polarxiong.com/archives/C-C-%E4%B8%AD%E5%B7%B2%E5%88%9D%E5%A7%8B%E5%8C%96-%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%E5%85%A8%E5%B1%80-%E9%9D%99%E6%80%81-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F-%E5%B8%B8%E9%87%8F%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE.html">C/C++中已初始化/未初始化全局/静态/局部变量/常量在内存中的位置</a><br><a href="https://en.wikipedia.org/wiki/Data_segment">https://en.wikipedia.org/wiki/Data_segment</a></p>
]]></content>
      <categories>
        <category>cpp</category>
      </categories>
      <tags>
        <tag>memory</tag>
      </tags>
  </entry>
  <entry>
    <title>gdb调试的一些技巧</title>
    <url>/post/gdb-tips.html</url>
    <content><![CDATA[<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="列出函数名"><a href="#列出函数名" class="headerlink" title="列出函数名"></a>列出函数名</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">info <span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持正则</span></span><br><span class="line">info <span class="built_in">functions</span> &lt;regex&gt;</span><br></pre></td></tr></table></figure>

<h3 id="进入函数"><a href="#进入函数" class="headerlink" title="进入函数"></a>进入函数</h3><p>使用gdb调试遇到函数时，使用step命令（缩写为s）可以进入函数（函数必须有调试信息,没有调试信息可以执行<code>set step-mode on</code>）<br>可以使用next命令（缩写为n）不进入函数，gdb会等函数执行完<br>当单步调试一个函数时，如果不想继续跟踪下去了，可以有两种方式退出:(1)<code>finish</code>,函数会执行完并打印返回值，然后等待输入(2)<code>return</code>,函数不会继续执行下面的语句，而是直接返回,也可以用<code>return &lt;expression&gt;</code>指定返回值</p>
<p>参考:<a href="https://sourceware.org/gdb/onlinedocs/gdb/Continuing-and-Stepping.html">gdb手册</a></p>
<h3 id="直接执行函数"><a href="#直接执行函数" class="headerlink" title="直接执行函数"></a>直接执行函数</h3><p>使用gdb调试程序时，可以使用“call”或“print”命令直接调用函数执行</p>
<p>参考:<a href="https://sourceware.org/gdb/onlinedocs/gdb/Calling.html">gdb手册</a></p>
<h3 id="打印函数堆栈帧信息"><a href="#打印函数堆栈帧信息" class="headerlink" title="打印函数堆栈帧信息"></a>打印函数堆栈帧信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">i frame</span><br><span class="line"></span><br><span class="line">i registers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看func函数汇编代码</span></span><br><span class="line">disassemble &lt;func&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出尾调用的相关信息(设置`debug entry-values`选项为非0值)</span></span><br><span class="line"><span class="comment"># 尾调用gdb(https://sourceware.org/gdb/onlinedocs/gdb/Tail-Call-Frames.html)</span></span><br><span class="line"><span class="built_in">set</span> debug entry-values 1</span><br></pre></td></tr></table></figure>

<p>参考:<a href="https://sourceware.org/gdb/onlinedocs/gdb/Frame-Info.html">gdb手册</a></p>
<span id="more"></span>

<h2 id="断点"><a href="#断点" class="headerlink" title="断点"></a>断点</h2><h3 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置函数断点</span></span><br><span class="line">b Foo::foo</span><br><span class="line"><span class="comment"># 设置匿名空间断点</span></span><br><span class="line">b (anonymous namespace)::bar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在程序地址上设置断点</span></span><br><span class="line"><span class="comment"># 当调试汇编程序，或者没有调试信息的程序时，经常需要在程序地址上打断点，方法为`b *address`</span></span><br><span class="line"><span class="comment"># 可使用`readelf -h a.out`或gdb中`info files`获得入口地址</span></span><br><span class="line">b *0x400522</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在行号上设置断点</span></span><br><span class="line">b file.cc:123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置临时断点</span></span><br><span class="line"><span class="comment"># tb a.c:15</span></span><br><span class="line">tbreak a.c:15</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置条件断点</span></span><br><span class="line">b aa.cc:10 <span class="keyword">if</span> i == 101</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注:几个有用的命令:<code>file a.out</code>;<code>nm a.out</code>;<code>readelf -h a.out</code>;<code>strip a.out</code>除去行号信息、重定位信息、符号表、调试段、typchk 段和注释段</p>
</blockquote>
<h3 id="忽略断点"><a href="#忽略断点" class="headerlink" title="忽略断点"></a>忽略断点</h3><p>在设置断点以后，可以忽略断点，命令是“ignore bnum count”：意思是接下来count次编号为bnum的断点触发都不会让程序中断，只有第count + 1次断点触发才会让程序中断</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">b aa.cc:15</span><br><span class="line">ignore 1 5</span><br></pre></td></tr></table></figure>

<h3 id="保存设置断点"><a href="#保存设置断点" class="headerlink" title="保存设置断点"></a>保存设置断点</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">save breakpoints file-name-to-save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件恢复断点</span></span><br><span class="line"><span class="built_in">source</span> file-name-to-save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看断点信息</span></span><br><span class="line"><span class="comment"># i b</span></span><br><span class="line">info breakpoints</span><br></pre></td></tr></table></figure>

<h2 id="观察点"><a href="#观察点" class="headerlink" title="观察点"></a>观察点</h2><p>gdb可以使用<code>watch</code>命令设置观察点，也就是当一个变量值发生变化时，程序会停下来</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch a</span><br><span class="line">watch *(data <span class="built_in">type</span>*)address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看观察点</span></span><br><span class="line">info watchpoints</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特定线程观察点</span></span><br><span class="line"><span class="comment"># gdb可以使用“watch expr thread threadnum”命令设置观察点只针对特定线程生效，也就是只有编号为threadnum的线程改变了变量的值，程序才会停下来，其它编号线程改变变量的值不会让程序停住</span></span><br><span class="line">i threads</span><br><span class="line">wa a thread 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb可以使用“rwatch”命令设置读观察点，也就是当发生读取变量行为时，程序就会暂停住;只对硬件观察点才生效</span></span><br><span class="line"><span class="comment"># 缩写是rw</span></span><br><span class="line">rwatch a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读写观察点</span></span><br><span class="line"><span class="comment"># 所写是aw</span></span><br><span class="line">awatch a</span><br></pre></td></tr></table></figure>

<p>如果系统支持硬件观测的话，当设置观测点是会打印如下信息： Hardware watchpoint num: expr</p>
<p>如果不想用硬件观测点的话可如下设置： set can-use-hw-watchpoints</p>
<p>参考:<a href="https://sourceware.org/gdb/onlinedocs/gdb/Set-Watchpoints.html">gdb手册</a></p>
<h2 id="Catchpoint"><a href="#Catchpoint" class="headerlink" title="Catchpoint"></a>Catchpoint</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">catch fork</span><br><span class="line">catch vfork</span><br><span class="line">catch <span class="built_in">exec</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只触发一次</span></span><br><span class="line">tcatch fock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以使用catch syscall [name | number]为关注的系统调用设置catchpoint</span></span><br><span class="line">catch syscall mmap</span><br><span class="line"><span class="comment"># 可以使用系统调用的编号</span></span><br><span class="line"><span class="comment"># 系统调用和编号可以参考/usr/local/share/gdb/syscalls/adm64-linux.xml</span></span><br><span class="line">catch syscall 9</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为所有系统调用设置catchpoint</span></span><br><span class="line">catch syscall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过为ptrace调用设置catchpoint破解anti-debugging的程序</span></span><br><span class="line"><span class="comment"># 破解这类程序的办法就是为ptrace调用设置catchpoint，通过修改ptrace的返回值，达到目的</span></span><br><span class="line">catch syscall ptrace</span><br><span class="line">r</span><br><span class="line">c</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$rax</span> = 0</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>参考:<a href="https://sourceware.org/gdb/onlinedocs/gdb/Set-Catchpoints.html">gdb手册</a></p>
<h2 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h2><h3 id="打印ASCII和宽字符串"><a href="#打印ASCII和宽字符串" class="headerlink" title="打印ASCII和宽字符串"></a>打印ASCII和宽字符串</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用gdb调试程序时，可以使用“x/s”命令打印ASCII字符串</span></span><br><span class="line">x/s str1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印宽字符串</span></span><br><span class="line"><span class="comment"># 4字节</span></span><br><span class="line">x/ws str2</span><br><span class="line"><span class="comment"># 2字节</span></span><br><span class="line">x/hs str2</span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://sourceware.org/gdb/onlinedocs/gdb/Memory.html">gdb手册</a></p>
<h3 id="打印数组"><a href="#打印数组" class="headerlink" title="打印数组"></a>打印数组</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打印数组中任意连续元素的值，可以使用“p array[index]@num”命令（p是print命令的缩写）。其中index是数组索引（从0开始计数），num是连续多少个元素。</span></span><br><span class="line">p array</span><br><span class="line">p array[60]@10</span><br><span class="line"><span class="comment"># 打印从数组开头连续元素值</span></span><br><span class="line">p *array@10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制大数组的打印数,默认不设置最多显示200</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> elements number-of-elements</span><br><span class="line"><span class="comment"># 设置为0或unlimited为不限制</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> elements unlimited</span><br><span class="line">p array</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印数组索引下标</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array-indexes on</span><br></pre></td></tr></table></figure>

<h3 id="打印函数局部变量值"><a href="#打印函数局部变量值" class="headerlink" title="打印函数局部变量值"></a>打印函数局部变量值</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bt</span><br><span class="line"><span class="comment"># backtrace缩写是bt</span></span><br><span class="line">backtrace full</span><br><span class="line"></span><br><span class="line"><span class="comment"># `bt full n`,意思是从内向外显示n个栈桢，及其局部变量</span></span><br><span class="line">bt full 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># `bt full -n`，意思是从外向内显示n个栈桢，及其局部变量</span></span><br><span class="line">bt full -2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印当前函数局部变量值</span></span><br><span class="line">info locals</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看变量类型</span></span><br><span class="line">whatis val</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看变量详细类型</span></span><br><span class="line">ptype val</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看该变量的文件</span></span><br><span class="line">i variables val</span><br><span class="line">i variables ^val$</span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://sourceware.org/gdb/onlinedocs/gdb/Backtrace.html">gdb手册</a></p>
<h3 id="打印进程内存信息"><a href="#打印进程内存信息" class="headerlink" title="打印进程内存信息"></a>打印进程内存信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看进程的内存映射信息，可以使用“i proc mappings”命令（i是info命令缩写）</span></span><br><span class="line">i proc mappings</span><br><span class="line"><span class="comment"># 可以更详细地输出进程的内存信息</span></span><br><span class="line">i files</span><br><span class="line">i target</span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://sourceware.org/gdb/onlinedocs/gdb/Files.html">gdb手册</a></p>
<h3 id="打印内存值"><a href="#打印内存值" class="headerlink" title="打印内存值"></a>打印内存值</h3><p>例子</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> a[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">sizeof</span>(a); i++)</span><br><span class="line">    &#123;</span><br><span class="line">            a[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gdb中使用“<code>x</code>”命令来打印内存的值，格式为“<code>x/nfu addr</code>”。含义为以<code>f</code>格式打印从<code>addr</code>开始的<code>n</code>个长度单元为<code>u</code>的内存值。参数具体含义如下：<br>a）n：输出单元的个数。<br>b）f：是输出格式。比如<code>x</code>是以16进制形式输出，<code>o</code>是以8进制形式输出,等等。<br>c）u：标明一个单元的长度。<code>b</code>是一个<code>byte</code>，<code>h</code>是两个<code>byte</code>（halfword），<code>w</code>是四个<code>byte</code>（word），<code>g</code>是八个<code>byte</code>（giant word）。  </p>
<p>以上面程序为例：<br>（1） 以16进制格式打印数组前<code>a</code>16个byte的值：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) x/16xb a</span><br><span class="line">0x7fffffffe4a0: 0x00    0x01    0x02    0x03    0x04    0x05    0x06    0x07</span><br><span class="line">0x7fffffffe4a8: 0x08    0x09    0x0a    0x0b    0x0c    0x0d    0x0e    0x0f</span><br></pre></td></tr></table></figure>

<p>（2） 以无符号10进制格式打印数组<code>a</code>前16个byte的值：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) x/16ub a</span><br><span class="line">0x7fffffffe4a0: 0       1       2       3       4       5       6       7</span><br><span class="line">0x7fffffffe4a8: 8       9       10      11      12      13      14      15</span><br></pre></td></tr></table></figure>

<p>（3） 以2进制格式打印数组前16个<code>a</code>byte的值：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) x/16tb a</span><br><span class="line">0x7fffffffe4a0: 00000000        00000001        00000010        00000011        00000100        00000101        00000110        00000111</span><br><span class="line">0x7fffffffe4a8: 00001000        00001001        00001010        00001011        00001100        00001101        00001110        00001111</span><br></pre></td></tr></table></figure>

<p>（4）  以16进制格式打印数组<code>a</code>前16个word（4个byte）的值：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) x/16xw a</span><br><span class="line">0x7fffffffe4a0: 0x03020100      0x07060504      0x0b0a0908      0x0f0e0d0c</span><br><span class="line">0x7fffffffe4b0: 0x13121110      0x17161514      0x1b1a1918      0x1f1e1d1c</span><br><span class="line">0x7fffffffe4c0: 0x23222120      0x27262524      0x2b2a2928      0x2f2e2d2c</span><br><span class="line">0x7fffffffe4d0: 0x33323130      0x37363534      0x3b3a3938      0x3f3e3d3c</span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://sourceware.org/gdb/onlinedocs/gdb/Memory.html">gdb手册</a>.</p>
<h3 id="打印源代码行号"><a href="#打印源代码行号" class="headerlink" title="打印源代码行号"></a>打印源代码行号</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">list 25</span><br><span class="line">l 24</span><br><span class="line">l main</span><br><span class="line">l-</span><br><span class="line">l+</span><br><span class="line">l 1,10</span><br></pre></td></tr></table></figure>

<h3 id="其他打印技巧"><a href="#其他打印技巧" class="headerlink" title="其他打印技巧"></a>其他打印技巧</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pretty打印</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照派生类型打印</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> object on</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;x&quot;命令会把最后检查的内存地址值存在“$_”这个“convenience variable”中，并且会把这个地址中的内容放在“$__”这个“convenience variable”</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Convenience-Vars.html</span></span><br><span class="line">p <span class="variable">$_</span></span><br><span class="line">p <span class="variable">$__</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印程序动态分配内存信息</span></span><br><span class="line">define mallocinfo</span><br><span class="line">  <span class="built_in">set</span> <span class="variable">$__f</span> = fopen(<span class="string">&quot;/dev/tty&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">  call malloc_info(0, <span class="variable">$__f</span>)</span><br><span class="line">  call fclose(<span class="variable">$__f</span>)</span><br><span class="line">end</span><br><span class="line">mallocinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印函数中变量,c++函数名需要使用单引号括起来</span></span><br><span class="line">p <span class="string">&#x27;(anonymous namespace)::SSAA::handleStore&#x27;</span>::n-&gt;pi-&gt;inst-&gt;dump()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印寄存器值</span></span><br><span class="line">i registers</span><br><span class="line">i all-gegisters</span><br><span class="line">i register eax</span><br><span class="line">p <span class="variable">$eax</span></span><br></pre></td></tr></table></figure>

<h2 id="改变程序执行"><a href="#改变程序执行" class="headerlink" title="改变程序执行"></a>改变程序执行</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 改变字符串的值</span></span><br><span class="line"><span class="comment"># https://stackoverflow.com/questions/19503057/in-gdb-how-can-i-write-a-string-to-memory</span></span><br><span class="line"><span class="built_in">set</span> main::p1=<span class="string">&quot;Bill&quot;</span></span><br><span class="line">p &amp;p1</span><br><span class="line"><span class="built_in">set</span> &#123;char[4]&#125; 0x80477a4 = <span class="string">&quot;Ace&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置变量的值,set var variable=expr</span></span><br><span class="line"><span class="built_in">set</span> var i = 8</span><br><span class="line"><span class="comment"># set &#123;type&#125;address=expr,通过地址给变量赋值</span></span><br><span class="line">p &amp;i</span><br><span class="line"><span class="built_in">set</span> &#123;int&#125;0x8047a54 = 8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改PC寄存器的值</span></span><br><span class="line">disassemble main</span><br><span class="line">info line 6</span><br><span class="line">info line 7</span><br><span class="line">p <span class="variable">$pc</span></span><br><span class="line"><span class="built_in">set</span> var <span class="variable">$pc</span>=0x08050949</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳转到制定位置执行</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Jumping.html#Jumping</span></span><br><span class="line">j 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用断点命令改变程序的执行</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Break-Commands.html#Break-Commands</span></span><br><span class="line">b fun</span><br><span class="line"><span class="built_in">command</span> 1</span><br><span class="line">&gt;silent</span><br><span class="line">&gt;<span class="built_in">set</span> variable n = 0</span><br><span class="line">&gt;<span class="built_in">continue</span></span><br><span class="line">&gt;end</span><br><span class="line">r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改被调试程序的二进制文件</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Patching.html#Patching</span></span><br><span class="line">gcc-write ./a.out  <span class="comment"># 命令后选项</span></span><br><span class="line"><span class="built_in">set</span> write on</span><br><span class="line">file ./a.out</span><br><span class="line">disassemble /mr fun</span><br><span class="line"><span class="built_in">set</span> variable *(short*)0x400651=0x0ceb</span><br><span class="line">disassemble /mr fun</span><br></pre></td></tr></table></figure>

<h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看gdb如何处理信号</span></span><br><span class="line">i signals</span><br><span class="line">i handle</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以用“handle signal stop/nostop”命令设置当信号发生时，是否暂停程序的执行</span></span><br><span class="line">handle SIGHUP nostop</span><br><span class="line"><span class="comment"># handle signal print/noprint设置是否打印信息</span></span><br><span class="line">handle SIGHUP noprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># handle signal pass(noignore)/nopass(ignore) 设置信号是否丢给程序处理</span></span><br><span class="line">handle SIGHUP nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接发送信号给调试的程序</span></span><br><span class="line">signal SIGHUP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使程序重新运行，但不发送任何信号</span></span><br><span class="line">signal 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读信号信息</span></span><br><span class="line">ptype <span class="variable">$_siginfo</span></span><br><span class="line">ptype <span class="variable">$_siginfo</span>._sifields._sigfault</span><br><span class="line">p <span class="variable">$_siginfo</span>._sifields._sigfault.si_addr</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考: <a href="https://sourceware.org/gdb/onlinedocs/gdb/Signals.html">gdb手册-signals</a></p>
<h2 id="gdb配置文件"><a href="#gdb配置文件" class="headerlink" title="gdb配置文件"></a>gdb配置文件</h2><p>当gdb启动时，会读取HOME目录和当前目录下的的配置文件，执行里面的命令。这个文件通常为“.gdbinit”</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># gdb配置文件`.gdbinit`</span></span><br><span class="line"><span class="comment"># 打印STL容器中的内容</span></span><br><span class="line">python</span><br><span class="line">import sys</span><br><span class="line">sys.path.insert(0, <span class="string">&quot;/home/xmj/project/gcc-trunk/libstdc++-v3/python&quot;</span>)</span><br><span class="line">from libstdcxx.v6.printers import register_libstdcxx_printers</span><br><span class="line">register_libstdcxx_printers (None)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存历史命令</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">history</span> filename ~/.gdb_history</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">history</span> save on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出时不显示提示信息</span></span><br><span class="line"><span class="built_in">set</span> confirm off</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照派生类型打印对象</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> object on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印数组的索引下标</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array-indexes on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每行打印一个结构体成员</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br></pre></td></tr></table></figure>

<h2 id="其他gdb技巧"><a href="#其他gdb技巧" class="headerlink" title="其他gdb技巧"></a>其他gdb技巧</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 调试已经运行的进程</span></span><br><span class="line">gdb program -p=10210</span><br><span class="line">gdb program processID</span><br><span class="line">gdb program --pid=10210</span><br><span class="line"></span><br><span class="line"><span class="comment"># attach已经运行的进程</span></span><br><span class="line">attach 10210</span><br><span class="line">detash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试多进程程序时，gdb默认会追踪父进程，以下命令可是其追踪子进程</span></span><br><span class="line"><span class="built_in">set</span> follow-fork-mode child</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试多进程程序，同时调试父进程和子进程</span></span><br><span class="line"><span class="built_in">set</span> detach-on-fork off</span><br><span class="line">i inferior</span><br><span class="line">inferior 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试多进程程序，让父进程和子进程同时运行</span></span><br><span class="line"><span class="built_in">set</span> schedule-multiple on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看线程信息</span></span><br><span class="line">i threads</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印所有线程堆栈信息</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Threads.html</span></span><br><span class="line">thread apply all bt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不显示线程启动和退出信息</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> thread-events off</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用gdb调试多线程程序时，一旦程序断住，所有的线程都处于暂停状态。此时当你调试其中一个线程时（比如执行“step”，“next”命令），所有的线程都会同时执行</span></span><br><span class="line"><span class="comment"># 如果想在调试一个线程时，让其它线程暂停执行，可以使用“set scheduler-locking on”命令</span></span><br><span class="line"><span class="built_in">set</span> scheduler-locking on</span><br><span class="line"></span><br><span class="line"><span class="comment"># `$_thread`变量表示线程号</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Threads.html</span></span><br><span class="line">wa a</span><br><span class="line"><span class="built_in">command</span> 2</span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;thread id=%d\n&quot;</span>, <span class="variable">$_thread</span></span><br><span class="line"> end</span><br><span class="line">c</span><br><span class="line"></span><br><span class="line"><span class="comment"># `$_exitcode`程序退出时的exit code</span></span><br><span class="line">p <span class="variable">$_exitcode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为调试进程产生core dump文件</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Core-File-Generation.html</span></span><br><span class="line">generate-core-file</span><br><span class="line">gcore</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试core文件,也可gdb启动后用`file`命令来读取可执行文件的符号表信息,而`core`命令制定core dump文件的位置</span></span><br><span class="line">gdb path/to/the/executable path/to/the/coredump</span><br><span class="line"><span class="comment"># 其他调试用到的命令</span></span><br><span class="line">readelf -S mainO3  <span class="comment"># 查看段</span></span><br><span class="line">objcopy --only-keep-debug mainO3 mainO3.symbol  <span class="comment"># 拷贝出一个符号表文件</span></span><br><span class="line">objcopy --strip-debug mainO3 mainO3.bin  <span class="comment"># 拷贝出一个执行文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># on为反汇编后面要执行的代码,off关闭</span></span><br><span class="line"><span class="built_in">set</span> disassemble-next-line on</span><br><span class="line"><span class="comment"># auto为后面的代码没有源码的情况下才反汇编</span></span><br><span class="line"><span class="built_in">set</span> disassemble-next-line auto</span><br><span class="line">si</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源程序和汇编指令映射起来,disas为disassemble命令缩写</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Machine-Code.html</span></span><br><span class="line">disas /m fun</span><br><span class="line"><span class="comment"># 只想看某一行对应的地址范围</span></span><br><span class="line">i line 13</span><br><span class="line"><span class="comment"># 只看这一条语句对应的汇编代码</span></span><br><span class="line">disassemble 0x4004e9, 0x40050c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示将要执行的汇编指令</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Auto-Display.html</span></span><br><span class="line">display /i <span class="variable">$pc</span></span><br><span class="line">display /3i <span class="variable">$pc</span></span><br><span class="line">undisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示程序原始机器码</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Machine-Code.html</span></span><br><span class="line">disassemble /r main</span><br><span class="line">disassemble /r 0x0000000000400534,+4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示共享链接库信息`info sharedlibrary regex`，gerex为正则或空</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/current/onlinedocs/gdb/Files.html#index-shared-libraries</span></span><br><span class="line">info sharedlibrary</span><br><span class="line">info sharedlibrary hiredi*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置源文件查找路径</span></span><br><span class="line">directory ../ki/</span><br><span class="line">gdb -q a.out -d /search/code/some</span><br><span class="line"></span><br><span class="line"><span class="comment"># 图形化调试</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/TUI-Commands.html</span></span><br><span class="line"><span class="comment"># 输入以下命令启动，或gdb中使用&quot;crtl+X+A&quot;,退出也是此快捷键</span></span><br><span class="line"><span class="comment"># layout asm显示汇编代码窗口</span></span><br><span class="line"><span class="comment"># layout regs显示寄存器窗口</span></span><br><span class="line">gdb -tui program</span><br><span class="line">tui reg <span class="built_in">float</span></span><br><span class="line">tui reg system</span><br><span class="line">tui reg general</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用`gcc -g`编译的程序不包含预处理宏信息,可使用`gcc -g3`编译</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Macros.html#Macros</span></span><br><span class="line">p NAME</span><br><span class="line"><span class="comment"># gcc debug相关:https://gcc.gnu.org/onlinedocs/gcc/Debugging-Options.html#Debugging-Options</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb启动参数</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Arguments.html#Arguments</span></span><br><span class="line">gdb -args ./a.out a b c</span><br><span class="line"><span class="built_in">set</span> args a b c</span><br><span class="line">r a b c</span><br><span class="line"><span class="built_in">set</span> args</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置被调试程序的环境变量</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">env</span> LD_PRELOAD=/lib/x86_64-linux-gnu/libpthread.so.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录执行gdb过程</span></span><br><span class="line"><span class="comment"># https://sourceware.org/gdb/onlinedocs/gdb/Logging-Output.html</span></span><br><span class="line"><span class="comment"># 用gdb调试程序时，可以使用“set logging on”命令把执行gdb的过程记录下来，方便以后自己参考或是别人帮忙分析。默认的日志文件是“gdb.txt”，也可以用“set logging file file”改成别的名字</span></span><br><span class="line"><span class="comment"># set logging overwrite on可以让输出覆盖之前的日志文件</span></span><br><span class="line"><span class="comment"># set logging redirect on让gdb的日志不会打印在终端</span></span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/hellogcc/100-gdb-tips/blob/master/src/index.md">https://github.com/hellogcc/100-gdb-tips/blob/master/src/index.md</a></p>
]]></content>
      <categories>
        <category>c++</category>
      </categories>
      <tags>
        <tag>gdb</tag>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title>在新加坡工作</title>
    <url>/post/singapore.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">
  <script id="hbeData" type="hbeData" data-hmacdigest="f1caaf1d26688fbeedd7d9b213e5f4fa0cd8f096cef5d9dfd3378c8da6f21425">2202f32e819b4e0a4cf8e116c084c52cfeee65d63b9770d83830c1e669a1588395fe2a74419699d926569ff5158de9cefe220f6d4da49d0a0dce6d1e9211ef9dfd3f0041448a7e347eed1b8903425e520c7b193d200782b4b1d234a9e120db9b1b5ce0bb91821c30af4bb81c714c4d4e9c1345c45c3543a28b8c1d2baae86fec33379baf20c5e15a022eaa93bb4feba404e655c05243992421fd8eb4667ec193aab68757234b253032c276f780ac9c5d6a941e753d0b13b6b58f2035c796362d8554dd752cfbc979ed7289ccca8700b7fcb739a6bf8e322d59ae119eec7a90f68ecabdf245c0404d43e944de72191f3b680d564432713906c22d2e81790a195fdbf14bf0af838dfa465d20b46efdc424b1cd9c9a8a350d08a2dfc768035b6cf5dd7b93bf99fa7936dfa482fcb155e395bd9f79c63d63f6cde5c5cd63cac2dd6fe5c40444b2e39e5ffefcbdb567fbdd9bf97d1501f3567ad70358aa8e0de759bc569837ce0a2e45d0f1b09d33f669df2a7d1c808b5571aeb765dade13c5fd6aec1f6f94ee602bf8e7d7b01cb0caf9c35ff5cb5c4d695d6fd851055b162b0023f122761737b4f0bdc42b2853210a1a643cc0fa4499aff85dfcbeae664bdf7c54c202b85eb91d699b678403402ba25ff5e8754fabe1f370b2d045733bbde101b7e97c370f8c5c76b4b550a971ea99c91e193bfbea804394cb359630285b72316279164e3a97a66633377ac91325e5488cd02e74e4773762e89090922a7e2201f79b53281e178e507ef83a107af5ff72ecbbf39c476b4116378744f726f8daacdb6d65e9e13885de2b8a38fb2f097c81770cb0b6a4284207f7cf01a4960b1ff4b857305b2c6461a15a8e7b43c4ea3d5b05c497f3ccdb73d49b4223468fd101638b99a492fbc9987db244a448658bace4608da39e3e25ef3814dc385df7e24f6a3421272893196c88e5e351dde94360bcfab2b27a1eac4e7dd7550bbca7a53b0974ede1e41440b0dd59b792db51cfe78a01192272faa04b5b54cf1e9c736419ec6ea42b3a452a9c21c0f66fe215beba0f681cc76abf5ba4e768cba0ceb1fec02d84dd8fb0eab6365a318c10c972ebca5fd932952da5bb2e885fb03a080aac9b82010c624b2c4a1e446831f38a4d4c8f701e79581eef2c551e3169e7eb0401018911fb9ce1398571df7140e6a233c15ea643dfc6c07182c23895394cdbd3676ecd9db6bf628f5f77a9e29507cdb3d9f12ae8710ff2a415cadf372ced8f4d6f561abfc633576e8257550f385f53b4910de68aa30dd47a278dcb756611fb19b338ca4d0b4314a3d2e98932192a57db590e92e95f173767d293d37a460bafa1c841509aac3169690c78447a28a16b214b3fc2b27ff7b4b6291ef8c792b953f0197f3701200028ceadfced34c7866bbf5eaaab4a02d8a9b5ff9af7a0562dbfaa714c1b473ba0a310078cb909ca81279cb4b6d88b17867753b9f11b2474d339c94e1a6d9bcde2444771f40f92507ca6fd70612d9348c676facb02d5346179d213847a26347b8e9c195b127d1ccb9ae13a377935e7c724ccfc50e6fa0c20fe90a7ee7e48fcbb85bc9a640f9f2bc1dfd6cb3f879be632cc92e9220933a77cb58f5770ae8f64ce</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">这里需要密码才能查看.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>life</category>
      </categories>
  </entry>
</search>
